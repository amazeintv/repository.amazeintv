import base64;exec base64.b64decode('IyAtKi0gY29kaW5nOiB1dGYtOCAtKi0NCmltcG9ydCB1cmxsaWINCmltcG9ydCB1cmxsaWIyDQppbXBvcnQgZGF0ZXRpbWUNCmltcG9ydCByZQ0KaW1wb3J0IG9zDQppbXBvcnQgYmFzZTY0DQppbXBvcnQgeGJtY3BsdWdpbg0KaW1wb3J0IHhibWNndWkNCmltcG9ydCB4Ym1jYWRkb24NCmltcG9ydCB4Ym1jdmZzDQppbXBvcnQgdHJhY2ViYWNrDQppbXBvcnQgY29va2llbGliDQpmcm9tIG1vZHVsZXMuanN1bnBhY2sgaW1wb3J0IHVucGFjayBhcyBwYWNrZXRzDQpmcm9tIG1vZHVsZXMuY29tbW9uIGltcG9ydCByYW5kb21fYWdlbnQNCmZyb20gQmVhdXRpZnVsU291cCBpbXBvcnQgQmVhdXRpZnVsU3RvbmVTb3VwLCBCZWF1dGlmdWxTb3VwLCBCZWF1dGlmdWxTT0FQDQp0cnk6DQogICAgaW1wb3J0IGpzb24NCmV4Y2VwdDoNCiAgICBpbXBvcnQgc2ltcGxlanNvbiBhcyBqc29uDQppbXBvcnQgdGltZQ0KaW1wb3J0IHJlcXVlc3RzDQppbXBvcnQgX0VkaXQNCgkNCnJlc29sdmVfdXJsPVsnMWZpY2hpZXIuY29tJywgJ2FsbGRlYnJpZC5jb20nLCAnYWxsbXl2aWRlb3MubmV0JywgJ2FsbHZpZC5jaCcsICdhdWVuZ2luZS5jb20nLCAnYmVzdHN0cmVhbXMubmV0JywgJ2JyaXNrZmlsZS5jb20nLCAnY2FzdGFtcC5jb20nLCAnY2xpY2tudXBsb2FkLmNvbScsICdjbGlja251cGxvYWQubWUnLCAnY2xpY2tudXBsb2FkLmxpbmsnLCAnY2xvdWR5LmVjJywgJ2Nsb3VkemlsbGEudG8nLCAnbmVvZHJpdmUuY28nLCAnY3J1bmNoeXJvbGwuY29tJywgJ2RhY2xpcHMuaW4nLCAnZGFjbGlwcy5jb20nLCAnZGFpbHltb3Rpb24uY29tJywgJ2RpdnhzdGFnZS5ldScsICdkaXZ4c3RhZ2UubmV0JywgJ2RpdnhzdGFnZS50bycsICdjb3VsZHRpbWUudG8nLCAnZWNvc3RyZWFtLnR2JywgJ2V4YXNoYXJlLmNvbScsICdlc3RyZWFtLnRvJywgJ2ZhY2Vib29rLmNvbScsICdmYXN0cGxheS5jYycsICdmYXN0cGxheS50bycsICdmYXN0cGxheS5zeCcsICdmaWxlaG9vdC5jb20nLCAnZmlsZW51a2UuY29tJywgJ2ZpbGVwdXAubmV0JywgJ2ZpbG1zaG93b25saW5lLm5ldCcsICdmbGFzaHgudHYnLCAncGx1cy5nb29nbGUuY29tJywgJ2dvb2dsZXZpZGVvLmNvbScsICdwaWNhc2F3ZWIuZ29vZ2xlLmNvbScsICdnb29nbGV1c2VyY29udGVudC5jb20nLCAnZ29vZ2xlZHJpdmUuY29tJywgJ2dvcmlsbGF2aWQuaW4nLCAnZ29yaWxsYXZpZC5jb20nLCAnZ29yaWxsYXZpZC5pbicsICdncmlmdGhvc3QuY29tJywgJ2h1Z2VmaWxlcy5uZXQnLCAnaWRvd2F0Y2gubmV0JywgJ2luZGF2aWRlby5odScsICdpc2hhcmVkLmV1JywgJ2pldGxvYWQudHYnLCAna2luZ2ZpbGVzLm5ldCcsICdsZXR3YXRjaC51cycsICdsZXR3YXRjaC50bycsICd2aWRzaGFyZS51cycsICdtYWlsLnJ1JywgJ215Lm1haWwucnUnLCAndmlkZW9hcGkubXkubWFpbC5ydScsICdhcGkudmlkZW8ubWFpbC5ydScsICdtZWdhLWRlYnJpZC5ldScsICdtZWdhbXA0Lm5ldCcsICdtZXJzYWxhYXlpdHRlbi5jb20nLCAnbW92ZGl2eC5jb20nLCAnbW92cG9kLm5ldCcsICdtb3Zwb2QuaW4nLCAnbW92c2hhcmUubmV0JywgJ3dob2xlY2xvdWQubmV0JywgJ21wNGVuZ2luZS5jb20nLCAnbXA0c3RyZWFtLmNvbScsICdtcDR1cGxvYWQuY29tJywgJ215dmlkc3RyZWFtLm5ldCcsICdub3N2aWRlby5jb20nLCAnbm9zbG9ja2VyLmNvbScsICdhdXJvcmF2aWQudG8nLCAnbm92YW1vdi5jb20nLCAnbm93dmlkZW8uc3gnLCAnbm93dmlkZW8uZXUnLCAnbm93dmlkZW8uY2gnLCAnbm93dmlkZW8uc3gnLCAnbm93dmlkZW8uY28nLCAnbm93dmlkZW8ubGknLCAnbm93dmlkZW8uZWMnLCAnbm93dmlkZW8uYXQnLCAnbm93dmlkZW8uZm8nLCAnb2sucnUnLCAnb2Rub2tsYXNzbmlraS5ydScsICdvcGVubG9hZC5pbycsICdvcGVubG9hZC5jbycsICdwbGF5NDQubmV0JywgJ3BsYXllZC50bycsICdwbGF5aGQudmlkZW8nLCAncGxheWhkLmZvJywgJ3BsYXl1Lm5ldCcsICdwbGF5dS5tZScsICdwbGF5d2lyZS5jb20nLCAnUHJlbWl1bWl6ZS5tZScsICdwcmltZXNoYXJlLnR2JywgJ3Byb21wdGZpbGUuY29tJywgJ3B1cmV2aWQuY29tJywgJ3JhcGlkdmlkZW8ud3MnLCAncmFwaWR2aWRlby5jb20nLCAnYXBpLnJlYWwtZGVicmlkLmNvbScsICdwcmVtaXVtLnJwbmV0LmJpeicsICdydXR1YmUucnUnLCAnc2hhcmVkMi5tZScsICdzaGFyZWQuc3gnLCAnc2hhcmVyZXBvLmNvbScsICdzaGFyZXNpeC5jb20nLCAnc2ltcGx5LWRlYnJpZC5jb20nLCAnc3BlZWRwbGF5Lnh5eicsICdzcGVlZHBsYXkudXMnLCAnc3BlZWRwbGF5My5wdycsICdzcGVlZHZpZGVvLm5ldCcsICdzdGFnZXZ1LmNvbScsICdzdHJlYW1jbG91ZC5ldScsICdzdHJlYW1pbi50bycsICdzdHJlYW0ubW9lJywgJ3N0cmVhbWFuZ28uY29tJywgJ3N0cmVhbWNoZXJyeS5jb20nLCAndGVyYW1peGVyLmNvbScsICd0aGV2aWRlby5tZScsICd0aGV2aWRlb3MudHYnLCAndG9sdHNkLWZlbC50aycsICd0cm9sbHZpZC5uZXQnLCAndHVuZS5waycsICd0dXNmaWxlcy5uZXQnLCAndHdpdGNoLnR2JywgJ3VwMnN0cmVhbS5jb20nLCAndXBsb2FkLmFmJywgJ3VwbG9hZGMuY29tJywgJ3VwbG9hZGMuY2gnLCAnemFsYWEuY29tJywgJ3VwbG9hZHgub3JnJywgJ3VwdG9ib3guY29tJywgJ3VwdG9zdHJlYW0uY29tJywgJ3VzZXJmaWxlcy5jb20nLCAndXNlcnNjbG91ZC5jb20nLCAndmVlaGQuY29tJywgJ3Zlb2guY29tJywgJ3ZpZC5hZycsICd2aWRidWxsLmNvbScsICd2aWRjcmF6eS5uZXQnLCAndXBsb2FkY3JhenkubmV0JywgJ3RoZXZpZGVvYmVlLnRvJywgJ3ZpZGVvYm94ZXIuY28nLCAndmlkZ2cudG8nLCAndmlkLmdnJywgJ3ZpZGVvaHV0LnRvJywgJ3ZpZGVvbWVnYS50dicsICd2aWRlb3Jhai50bycsICd2aWRlb3Jldi5jYycsICd2aWRlb3NreS50bycsICd2aWRlby50dCcsICd2aWRlb3dlZWQuZXMnLCAnYml0dmlkLnN4JywgJ3ZpZGVvd2VlZC5jb20nLCAndmlkZW93b29kLnR2JywgJ2J5em9vLm9yZycsICdwbGF5cGFuZGEubmV0JywgJ3ZpZGVvem9vLm1lJywgJ3ZpZGVvd2luZy5tZScsICd2aWRlb3dpbmcubWUnLCAnZWFzeXZpZGVvLm1lJywgJ3BsYXk0NC5uZXQnLCAncGxheWJiLm1lJywgJ3ZpZGVvNDQubmV0JywgJ3ZpZGlvLnN4JywgJ3ZpZGxveC50dicsICd2aWQubWUnLCAndmlkc3BvdC5uZXQnLCAndmlkdG8ubWUnLCAndmlkdXAubWUnLCAndmlkdXAub3JnJywgJ3ZpZHppLnR2JywgJ3ZpbWVvLmNvbScsICd2aXZvLnN4JywgJ3ZrLmNvbScsICd2a3Bhc3MuY29tJywgJ3ZvZGxvY2tlci5jb20nLCAndnNoYXJlLmlvJywgJ3ZzaGFyZS5ldScsICd3YXRjaGVycy50bycsICd3YXRjaG9ubGluZS50bycsICd3YXRjaHZpZGVvLnVzJywgJ3dhdGNodmlkZW8yLnVzJywgJ3dhdGNodmlkZW8zLnVzJywgJ3dhdGNodmlkZW80LnVzJywgJ3dhdGNodmlkZW81LnVzJywgJ3dhdGNodmlkZW82LnVzJywgJ3dhdGNodmlkZW83LnVzJywgJ3dhdGNodmlkZW84LnVzJywgJ3dhdGNodmlkZW85LnVzJywgJ3dlc2hhcmUubWUnLCAneHZpZHN0YWdlLmNvbScsICd5b3Vsb2wuYml6JywgJ3NoaXRtb3ZpZS5jb20nLCAneW91cnVwbG9hZC5jb20nLCAneW91dHViZS5jb20nLCAneW91dHUuYmUnLCAneW91d2F0Y2gub3JnJywgJ2FwaS56ZXZlcmEuY29tJywgJ3pldHRhaG9zdC50dicsICd6c3RyZWFtLnRvJ10NCmdfaWdub3JlU2V0UmVzb2x2ZWQ9WydwbHVnaW4udmlkZW8uZHJhbWFzb25saW5lJywncGx1Z2luLnZpZGVvLmY0bVRlc3RlcicsJ3BsdWdpbi52aWRlby5zaGFoaWRtYmNuZXQnLCdwbHVnaW4udmlkZW8uU3BvcnRzRGV2aWwnLCdwbHVnaW4uc3RyZWFtLnZhdWdobmxpdmUudHYnLCdwbHVnaW4udmlkZW8uWmVtVFYtc2hhbmknXQ0KDQpjbGFzcyBOb1JlZGlyZWN0aW9uKHVybGxpYjIuSFRUUEVycm9yUHJvY2Vzc29yKToNCiAgIGRlZiBodHRwX3Jlc3BvbnNlKHNlbGYsIHJlcXVlc3QsIHJlc3BvbnNlKToNCiAgICAgICByZXR1cm4gcmVzcG9uc2UNCiAgIGh0dHBzX3Jlc3BvbnNlID0gaHR0cF9yZXNwb25zZQ0KICAgICAgIA0KYWRkb24gPSBfRWRpdC5hZGRvbg0KYWRkb25fdmVyc2lvbiA9IGFkZG9uLmdldEFkZG9uSW5mbygndmVyc2lvbicpDQpwcm9maWxlID0geGJtYy50cmFuc2xhdGVQYXRoKGFkZG9uLmdldEFkZG9uSW5mbygncHJvZmlsZScpLmRlY29kZSgndXRmLTgnKSkNCmhvbWUgPSB4Ym1jLnRyYW5zbGF0ZVBhdGgoYWRkb24uZ2V0QWRkb25JbmZvKCdwYXRoJykuZGVjb2RlKCd1dGYtOCcpKQ0KZmF2b3JpdGVzID0gb3MucGF0aC5qb2luKHByb2ZpbGUsICdmYXZvcml0ZXMnKQ0KaGlzdG9yeSA9IG9zLnBhdGguam9pbihwcm9maWxlLCAnaGlzdG9yeScpDQpEZWNvZGUgPSBiYXNlNjQuZGVjb2Rlc3RyaW5nDQpSRVYgPSBvcy5wYXRoLmpvaW4ocHJvZmlsZSwgJ2xpc3RfcmV2aXNpb24nKQ0KaWNvbiA9IG9zLnBhdGguam9pbihob21lLCAnaWNvbi5wbmcnKQ0KRkFOQVJUID0gb3MucGF0aC5qb2luKGhvbWUsICdmYW5hcnQuanBnJykNCnNvdXJjZV9maWxlID0gb3MucGF0aC5qb2luKHByb2ZpbGUsICdzb3VyY2VfZmlsZScpDQpmdW5jdGlvbnNfZGlyID0gcHJvZmlsZQ0KQWR1bHRfUGFzcyA9IGFkZG9uLmdldFNldHRpbmcoJ0FkdWx0JykNCkFkdWx0X0RlZmF1bHQgPSBhZGRvbi5nZXRTZXR0aW5nKCdQb3JuX1Bhc3MnKQ0KZGVidWcgPSBhZGRvbi5nZXRTZXR0aW5nKCdkZWJ1ZycpDQppZiBvcy5wYXRoLmV4aXN0cyhmYXZvcml0ZXMpPT1UcnVlOg0KICAgIEZBViA9IG9wZW4oZmF2b3JpdGVzKS5yZWFkKCkNCmVsc2U6IEZBViA9IFtdDQppZiBvcy5wYXRoLmV4aXN0cyhzb3VyY2VfZmlsZSk9PVRydWU6DQogICAgU09VUkNFUyA9IG9wZW4oc291cmNlX2ZpbGUpLnJlYWQoKQ0KZWxzZTogU09VUkNFUyA9IFtdDQpDSEVDSyA9ICdwbHVnaW4udmlkZW8uU2t5bmV0Jw0KDQpkZWYgYWRkb25fbG9nKHN0cmluZyk6DQogICAgaWYgZGVidWcgPT0gJ3RydWUnOg0KICAgICAgICB4Ym1jLmxvZygiW2FkZG9uLmxpdmUuU2t5bmV0IExpc3RzLSVzXTogJXMiICUoYWRkb25fdmVyc2lvbiwgc3RyaW5nKSkNCg0KDQpkZWYgbWFrZVJlcXVlc3QodXJsLCBoZWFkZXJzPU5vbmUpOg0KICAgICAgICB0cnk6DQogICAgICAgICAgICBpZiBoZWFkZXJzIGlzIE5vbmU6DQogICAgICAgICAgICAgICAgaGVhZGVycyA9IHsnVXNlci1hZ2VudCcgOiAnTW96aWxsYS81LjAgKFdpbmRvd3MgTlQgNi4xOyBXT1c2NDsgcnY6MTkuMCkgR2Vja28vMjAxMDAxMDEgRmlyZWZveC8xOS4wJ30NCiAgICAgICAgICAgIHJlcSA9IHVybGxpYjIuUmVxdWVzdCh1cmwsTm9uZSxoZWFkZXJzKQ0KICAgICAgICAgICAgcmVzcG9uc2UgPSB1cmxsaWIyLnVybG9wZW4ocmVxKQ0KICAgICAgICAgICAgZGF0YSA9IHJlc3BvbnNlLnJlYWQoKQ0KICAgICAgICAgICAgcmVzcG9uc2UuY2xvc2UoKQ0KICAgICAgICAgICAgcmV0dXJuIGRhdGENCiAgICAgICAgZXhjZXB0IHVybGxpYjIuVVJMRXJyb3IsIGU6DQogICAgICAgICAgICBhZGRvbl9sb2coJ1VSTDogJyt1cmwpDQogICAgICAgICAgICBpZiBoYXNhdHRyKGUsICdjb2RlJyk6DQogICAgICAgICAgICAgICAgYWRkb25fbG9nKCdXZSBmYWlsZWQgd2l0aCBlcnJvciBjb2RlIC0gJXMuJyAlIGUuY29kZSkNCiAgICAgICAgICAgICAgICB4Ym1jLmV4ZWN1dGVidWlsdGluKCJYQk1DLk5vdGlmaWNhdGlvbihTa3luZXQsV2UgZmFpbGVkIHdpdGggZXJyb3IgY29kZSAtICIrc3RyKGUuY29kZSkrIiwxMDAwMCwiK2ljb24rIikiKQ0KICAgICAgICAgICAgZWxpZiBoYXNhdHRyKGUsICdyZWFzb24nKToNCiAgICAgICAgICAgICAgICBhZGRvbl9sb2coJ1dlIGZhaWxlZCB0byByZWFjaCBhIHNlcnZlci4nKQ0KICAgICAgICAgICAgICAgIGFkZG9uX2xvZygnUmVhc29uOiAlcycgJWUucmVhc29uKQ0KICAgICAgICAgICAgICAgIHhibWMuZXhlY3V0ZWJ1aWx0aW4oIlhCTUMuTm90aWZpY2F0aW9uKFNreW5ldCxXZSBmYWlsZWQgdG8gcmVhY2ggYSBzZXJ2ZXIuIC0gIitzdHIoZS5yZWFzb24pKyIsMTAwMDAsIitpY29uKyIpIikNCg0KCQkJCQ0KZGVmIFNLaW5kZXgoKToNCiAgICBhZGRvbl9sb2coIlNLaW5kZXgiKQ0KICAgIGFkZERpcignW0NPTE9SIHdoaXRlXVN1cHJlbWFjeSBUdiBTaG93c1svQ09MT1JdJywnJyw0MDAsJ2h0dHA6Ly9zdGVwaGVuLWJ1aWxkcy51ay9hcnQvVFYlMjBTSE9XUyUyMFNDUkFQUEVSLnBuZycsRkFOQVJULCcnLCcnLCcnLCcnLCcnKQ0KICAgIGdldERhdGEoX0VkaXQuTWFpbkJhc2UsJycpDQogICAgaWYgQWR1bHRfUGFzcyA9PSBBZHVsdF9EZWZhdWx0Og0KCQkJYWRkRGlyKCdbQ09MT1IgcmVkXTE4IG9ubHlbL0NPTE9SXScsJycsNjksJ2h0dHA6Ly9zdGVwaGVuLWJ1aWxkcy51ay9hcnQvMTglMjBvbmx5LnBuZycgLCAgRkFOQVJULCcnLCcnLCcnLCcnKQ0KICAgIHhibWNwbHVnaW4uZW5kT2ZEaXJlY3RvcnkoaW50KHN5cy5hcmd2WzFdKSkNCg0KDQpkZWYgZ2V0X3Bvcm5fZGF0YSh1cmwpOg0KICAgIGFkZG9uX2xvZygiZ2V0X3Bvcm5fZGF0YSIpDQogICAgZ2V0RGF0YShfRWRpdC5Qb3JuQmFzZSwnJykNCmRlZiBPcGVuX1VybCh1cmwpOg0KICAgIHJlcSA9IHVybGxpYjIuUmVxdWVzdCh1cmwpDQogICAgcmVxLmFkZF9oZWFkZXIoJ1VzZXItQWdlbnQnLCAnTW96aWxsYS81LjAgKFdpbmRvd3M7IFU7IFdpbmRvd3MgTlQgNS4xOyBlbi1HQjsgcnY6MS45LjAuMykgR2Vja28vMjAwODA5MjQxNyBGaXJlZm94LzMuMC4zJykNCiAgICByZXNwb25zZSA9ICcnDQogICAgbGluayA9ICcnDQogICAgdHJ5OiANCiAgICAgICAgcmVzcG9uc2UgPSB1cmxsaWIyLnVybG9wZW4ocmVxKQ0KICAgICAgICBsaW5rPXJlc3BvbnNlLnJlYWQoKQ0KICAgICAgICByZXNwb25zZS5jbG9zZSgpDQogICAgZXhjZXB0OiBwYXNzDQogICAgaWYgbGluayAhPSAnJzoNCiAgICAgICAgcmV0dXJuIGxpbmsNCiAgICBlbHNlOg0KICAgICAgICBsaW5rID0gJ09wZW5lZCcNCiAgICAgICAgcmV0dXJuIGxpbmsNCicnJw0KZGVmIG5hbl9tZW51KHVybCk6DQogICAgaHRtbCA9IHJlcXVlc3RzLmdldCh1cmwpLmNvbnRlbnQNCiAgICBtYXRjaCA9IHJlLmNvbXBpbGUoJzxpdGVtPi4rPzx0aXRsZT4oLis/KTwvdGl0bGU+Lis/PGxpbms+KC4rPyk8L2xpbms+Lis/PHN1Ymxpbms+KC4rPyk8L3N1Ymxpbms+Lis/PHRodW1ibmFpbD4oLis/KTwvdGh1bWJuYWlsPi4rPzxwbG90PiguKz8pPC9wbG90Pi4rPzxmYW5hcnQ+KC4rPyk8L2ZhbmFydD4uKz88L2l0ZW0+JyxyZS5ET1RBTEwpLmZpbmRhbGwoaHRtbCkNCglmb3IgdGl0bGUsbWVudSxsaW5rLHRodW1iLHBsb3QsDQonJycNCg0KZGVmIE1vdl9zYygpOg0KICAgIE1lbnUoJ1tDT0xPUndoaXRlXU5FVyBNT1ZJRVNbL0NPTE9SXScsJ2h0dHA6Ly9zdGVwaGVuLWJ1aWxkcy51ay9zdXByZW1hY3kvc2NyYXAlMjBtb3ZpZXMvU0NSQVAlMjBNT1ZJRVMudHh0Jyw5OTk5OTksJ2h0dHA6Ly9zdGVwaGVuLWJ1aWxkcy51ay9hcnQvYWRkLmpwZycsJ2h0dHA6Ly9zdGVwaGVuLWJ1aWxkcy51ay9hcnQvZGFyay1wb3dlci1idXR0b24tcHNkLmpwZycsJycsJycsJycsJycpDQogICAgTWVudSgnW0NPTE9Sd2hpdGVdUEVPUExFIFdBVENISU5HWy9DT0xPUl0nLCdodHRwOi8vc3RlcGhlbi1idWlsZHMudWsvc3VwcmVtYWN5L3NjcmFwJTIwbW92aWVzL3Blb3BsZSUyMHdhdGNoaW5nLnR4dCcsOTk5OTk5LCdodHRwOi8vc3RlcGhlbi1idWlsZHMudWsvYXJ0L2FkZC5qcGcnLCdodHRwOi8vc3RlcGhlbi1idWlsZHMudWsvYXJ0L2RhcmstcG93ZXItYnV0dG9uLXBzZC5qcGcnLCcnLCcnLCcnLCcnKQ0KICAgIE1lbnUoJ1tDT0xPUndoaXRlXUZVTEwgTElTVCBNT1ZJRVNbL0NPTE9SXScsJ2h0dHA6Ly9zdGVwaGVuLWJ1aWxkcy51ay9zdXByZW1hY3kvc2NyYXAlMjBtb3ZpZXMvZnVsbC50eHQnLDk5OTk5OSwnaHR0cDovL3N0ZXBoZW4tYnVpbGRzLnVrL2FydC9hZGQuanBnJywnaHR0cDovL3N0ZXBoZW4tYnVpbGRzLnVrL2FydC9kYXJrLXBvd2VyLWJ1dHRvbi1wc2QuanBnJywnJywnJywnJywnJykNCiAgICBNZW51KCdbQ09MT1J3aGl0ZV1NT1ZJRVMgQSAtIFpbL0NPTE9SXScsJ2h0dHA6Ly9zdGVwaGVuLWJ1aWxkcy51ay9zdXByZW1hY3kvc2NyYXAlMjBtb3ZpZXMvQS1aL0EtWi50eHQnLDk5OTk5OSwnaHR0cDovL3N0ZXBoZW4tYnVpbGRzLnVrL2FydC9hZGQuanBnJywnaHR0cDovL3N0ZXBoZW4tYnVpbGRzLnVrL2FydC9kYXJrLXBvd2VyLWJ1dHRvbi1wc2QuanBnJywnJywnJywnJywnJykNCiAgICBNZW51KCdbQ09MT1J3aGl0ZV1NT1ZJRVMgR0VOUkVbL0NPTE9SXScsJ2h0dHA6Ly9zdGVwaGVuLWJ1aWxkcy51ay9zdXByZW1hY3kvc2NyYXAlMjBtb3ZpZXMvR2VucmUvR2VucmUudHh0Jyw5OTk5OTksJ2h0dHA6Ly9zdGVwaGVuLWJ1aWxkcy51ay9hcnQvYWRkLmpwZycsJ2h0dHA6Ly9zdGVwaGVuLWJ1aWxkcy51ay9hcnQvZGFyay1wb3dlci1idXR0b24tcHNkLmpwZycsJycsJycsJycsJycpDQogICAgTWVudSgnW0NPTE9Sd2hpdGVdTU9TVCBQT1BVTEFSWy9DT0xPUl0nLCdodHRwOi8vd3d3LmltZGIuY29tL2NoYXJ0L21vdmllbWV0ZXI/cmVmXz1udl9tdl9tcG1fOCcsOTk5OTk2LCdodHRwOi8vc3RlcGhlbi1idWlsZHMudWsvYXJ0L2FkZC5qcGcnLCdodHRwOi8vc3RlcGhlbi1idWlsZHMudWsvYXJ0L2RhcmstcG93ZXItYnV0dG9uLXBzZC5qcGcnLCcnLCcnLCcnLCcnKQ0KICAgIE1lbnUoJ1tDT0xPUndoaXRlXUtpZHMgTW92aWVzWy9DT0xPUl0nLCdodHRwOi8vc3RlcGhlbi1idWlsZHMudWsvc3VwcmVtYWN5L3NjcmFwJTIwbW92aWVzL0tpZHMlMjBtb3ZpZXMueG1sJyw5OTk5OTksJ2h0dHA6Ly9zdGVwaGVuLWJ1aWxkcy51ay9hcnQvYWRkLmpwZycsJ2h0dHA6Ly9zdGVwaGVuLWJ1aWxkcy51ay9hcnQvZGFyay1wb3dlci1idXR0b24tcHNkLmpwZycsJycsJycsJycsJycpDQoNCmRlZiByZWdfbmFuKHVybCk6DQogICAgaHRtbCA9IHJlcXVlc3RzLmdldCh1cmwpLnRleHQNCiAgICBtYXRjaCA9IHJlLmNvbXBpbGUoJzxpdGVtPi4rPzx0aXRsZT4oLis/KTwvdGl0bGU+Lis/PGxpbms+KC4rPyk8L2xpbms+Lis/PHN1Ymxpbms+KC4rPyk8L3N1Ymxpbms+Lis/PHRodW1ibmFpbD4oLis/KTwvdGh1bWJuYWlsPi4rPzxwbG90PiguKz8pPC9wbG90Pi4rPzx5ZWFyPiguKz8pPC95ZWFyPi4rPzxmYW5hcnQ+KC4rPyk8L2ZhbmFydD4uKz88L2l0ZW0+JyxyZS5ET1RBTEwpLmZpbmRhbGwoaHRtbCkNCiAgICBmb3IgdGl0bGUsIG1vZGUsc3ViLCBpbSwgcGxvdCwgeWVhcixmYW5hcnQgaW4gbWF0Y2g6DQogICAgICAgIGlmIGZhbmFydCA9PSAnICc6DQogICAgICAgICAgICBmYW5hcnQgPSBGQU5BUlQNCiAgICAgICAgaWYgaW0gPT0gJyAnOg0KICAgICAgICAgICAgaW0gPSBpY29uDQogICAgICAgIHBsb3QgPSBwbG90LnJlcGxhY2UoJ1xcbicsJyAnKQ0KICAgICAgICBpZiBtb2RlID09ICdNb3ZpZSBTZWFyY2gnOg0KICAgICAgICAgICAgUExBWSh0aXRsZSx5ZWFyLDk5OTk5OCxpbSxmYW5hcnQscGxvdCwnJykNCiAgICAgICAgZWxpZiBtb2RlID09ICdNZW51JzoNCiAgICAgICAgICAgIE1lbnUodGl0bGUsc3ViLDk5OTk5OSxpbSxmYW5hcnQscGxvdCwnJykNCg0KZGVmIHJlZ19uYW5fdHYodXJsKToNCiAgICBodG1sID0gcmVxdWVzdHMuZ2V0KHVybCkudGV4dA0KICAgIG1hdGNoID0gcmUuY29tcGlsZSgnPGl0ZW0+Lis/PHRpdGxlPiguKz8pPC90aXRsZT4uKz88bGluaz4oLis/KTwvbGluaz4uKz88c3VibGluaz4oLis/KTwvc3VibGluaz4uKz88dGh1bWJuYWlsPiguKz8pPC90aHVtYm5haWw+Lis/PHBsb3Q+KC4rPyk8L3Bsb3Q+Lis/PHNlYXNvbj4oLis/KTwvc2Vhc29uPi4rPzxlcGlzb2RlPiguKz8pPC9lcGlzb2RlPi4rPzxzZWFzb25feWVhcj4oLis/KTwvc2Vhc29uX3llYXI+Lis/PGZhbmFydD4oLis/KTwvZmFuYXJ0Pi4rPzwvaXRlbT4nLHJlLkRPVEFMTCkuZmluZGFsbChodG1sKQ0KICAgIGZvciB0aXRsZSwgbW9kZSxzdWIsIGltLCBwbG90LHNlYXMsZXAsc2hvd195ZWFyLGZhbmFydCBpbiBtYXRjaDoNCiAgICAgICAgaWYgZmFuYXJ0ID09ICcgJzoNCiAgICAgICAgICAgIGZhbmFydCA9IEZBTkFSVA0KICAgICAgICBpZiBpbSA9PSAnICc6DQogICAgICAgICAgICBpbSA9IGljb24NCiAgICAgICAgcGxvdCA9IHBsb3QucmVwbGFjZSgnXFxuJywnICcpDQogICAgICAgIGlmIG1vZGUgPT0gJ3R2IHNlYXJjaCc6DQogICAgICAgICAgICBNZW51KHRpdGxlKycgLSBTRUFTT04gLScrc2VhcysnLSBFUElTT0RFLScrZXArJy0nK3Nob3dfeWVhciwnJyw0MDQsaW0sZmFuYXJ0LCcnLHRpdGxlKQ0KICAgICAgICBlbGlmIG1vZGUgPT0gJ01lbnUnOg0KICAgICAgICAgICAgTWVudSh0aXRsZSxzdWIsNDEwLGltLGZhbmFydCxwbG90LCcnKQ0KDQpkZWYgTXBvcCh1cmwpOg0KICAgIE1lbnUoJ1tDT0xPUndoaXRlXU1vc3QgUG9wdWxhciBCeSBHZW5yZVsvQ09MT1JdJywnaHR0cDovL3d3dy5pbWRiLmNvbS9nZW5yZS8/cmVmXz1udl9jaF9ncl8zJyw5OTk5OTUsJycsJycsJycsJycsJycsJycpDQogICAgYmFzZSA9ICdodHRwOi8vaW1kYi5jb20nDQogICAgaHRtbCA9IHJlcXVlc3RzLmdldCgnaHR0cDovL3d3dy5pbWRiLmNvbS9jaGFydC9tb3ZpZW1ldGVyP3JlZl89bnZfbXZfbXBtXzgnKS5jb250ZW50DQogICAgbWF0Y2ggPSByZS5jb21waWxlKCc8dGQgY2xhc3M9InBvc3RlckNvbHVtbiI+Lis/dGl0bGU9Lis/PiguKz8pPC9hPi4rPzxzcGFuIGNsYXNzPSJzZWNvbmRhcnlJbmZvIj4oLis/KTwvc3Bhbj4nLHJlLkRPVEFMTCkuZmluZGFsbChodG1sKQ0KICAgIGZvciBuYW1lICwgeWVhciBpbiBtYXRjaDoNCiAgICAgICAgeWVhcnMgPSB5ZWFyLnJlcGxhY2UoJygnLCcnKS5yZXBsYWNlKCcpJywnJykNCiAgICAgICAgUExBWShuYW1lKycgIFtDT0xPUndoaXRlXScreWVhcisnWy9DT0xPUl0nLHllYXJzLDk5OTk5OCwnJywnJyx5ZWFyLG5hbWUpDQoNCmRlZiBNcG9wZ2VuKHVybCk6DQogICAgaHRtbCA9IHJlcXVlc3RzLmdldCh1cmwpLmNvbnRlbnQNCiAgICBtYXRjaCA9IHJlLmNvbXBpbGUoJzx0ciBjbGFzcz0iLis/Ii4rPzxoMz4uKz9ocmVmPSIoLis/KSI+KC4rPyk8Lis/PHA+KC4rPyk8L3A+JyxyZS5ET1RBTEwpLmZpbmRhbGwoaHRtbCkNCiAgICBmb3IgYSxiLHJlc3QgaW4gbWF0Y2g6DQogICAgICAgIE1lbnUoJ1tDT0xPUndoaXRlXScrYi51cHBlcigpKydbL0NPTE9SXScsYSw5OTk5OTQsJycsJycsJycsJycsJycsJycpDQogICAgICAgIA0KZGVmIE1wb3BnZW5yZXModXJsKToNCg0KICAgIGh0bWwgPSByZXF1ZXN0cy5nZXQodXJsKS5jb250ZW50DQogICAgbWF0Y2ggPSByZS5jb21waWxlKCc8dGQgY2xhc3M9ImltYWdlIj4uKz90aXRsZT0iKC4rPykiLis/PHNwYW4gY2xhc3M9InllYXJfdHlwZSI+KC4rPyk8JyxyZS5ET1RBTEwpLmZpbmRhbGwoaHRtbCkNCiAgICBmb3IgeiAseCBpbiBtYXRjaDoNCiAgICAgICAgej16LnJlcGxhY2UoJyYjeDI2OyN4Mjc7JywnJykucmVwbGFjZSgnJiN4MjY7JywnJykucmVwbGFjZSgnJiN4Mjc7JywnJykNCiAgICAgICAgeWVhcnMgPSB4WzE6NV0NCiAgICAgICAgUExBWSh6KycgIFtDT0xPUndoaXRlXScreCsnWy9DT0xPUl0nLHllYXJzLDk5OTk5OCwnJywnJyx4LHopDQoNCmRlZiBjYXRjaHVwdHYodXJsKToNCiAgICAjYWRkRGlyKCdbQ09MT1JyZWRdW0JdU2VjdGlvbiAyWy9DT0xPUl1bL0JdJywnJywxMDEsaWNvbixmYW5hcnQsJycsJycsJycsJycsJycpDQogICAgaHRtbCA9IHJlcXVlc3RzLmdldCh1cmwpLmNvbnRlbnQNCiAgICBzb3VwID0gQmVhdXRpZnVsU291cChodG1sKQ0KICAgICN4Ym1jLmxvZygndGl0bGU6JytyZXByKHNvdXApLHhibWMuTE9HTk9USUNFKQ0KDQogICAgY29udHMgPSBzb3VwLmZpbmRBbGwoJ3AnLCBhdHRycz0geydjbGFzcycgOiAiY2hhbm5lbHNpY29uIn0pDQogICAgZm9yIGNvbnQgaW4gY29udHM6DQogICAgICAgICN4Ym1jLmxvZygndGl0bGU6JytyZXByKGNvbnQpLHhibWMuTE9HTk9USUNFKQ0KICAgICAgICBsaW5rcyA9IGNvbnQuZmluZEFsbCgnYScpDQogICAgICAgIGZvciBsaW5rIGluIGxpbmtzOg0KICAgICAgICAgICAgaWYgbGluay5oYXNfa2V5KCdocmVmJyk6DQogICAgICAgICAgICAgICAgaHJlZiA9ICdodHRwczovL3R2Y2F0Y2h1cC5jb20nK2xpbmtbJ2hyZWYnXQ0KICAgICAgICAgICAgcGljcyA9IGxpbmsuZmluZEFsbCgnaW1nJywgYXR0cnM9IHsnc3R5bGUnIDogIiJ9KQ0KICAgICAgICAgICAgI3hibWMubG9nKCd0aXRsZTonK3JlcHIocGljcykseGJtYy5MT0dOT1RJQ0UpDQogICAgICAgICAgICBmb3IgcGljIGluIHBpY3M6DQogICAgICAgICAgICAgICAgI2ltZyA9IHBpY1snc3JjJ10NCiAgICAgICAgICAgICAgICBhbHQgPSBwaWNbJ2FsdCddDQogICAgICAgICAgICAgICAgYWx0ID0gYWx0LmVuY29kZSgndXRmOCcpDQogICAgICAgICAgICBtYXRjaCA9IHJlLmNvbXBpbGUoJzxiciAvPiguKz8pPC9hPicpLmZpbmRhbGwoc3RyKGxpbmspKQ0KICAgICAgICAgICAgZm9yIGJyIGluIG1hdGNoOg0KICAgICAgICAgICAgICAgIGJyID0gYnIuZW5jb2RlKCd1dGY4JykucmVwbGFjZSgnJiMwMzk7JywnJykucmVwbGFjZSgnJmFtcDsnLCdhbmQnKQ0KICAgICAgICAgICAgICAgIGltcG9ydCBiYXNlNjQNCiAgICAgICAgICAgICAgICBEZWNvZGUgPSBiYXNlNjQuZGVjb2Rlc3RyaW5nDQogICAgICAgICAgICAgICAgaHRtbCA9IHJlcXVlc3RzLmdldChocmVmKS5jb250ZW50IA0KICAgICAgICAgICAgICAgIG1hdGNoID1yZS5jb21waWxlKCd2YXIuKz89Lis/IiguKz8pIicscmUuRE9UQUxMKS5maW5kYWxsKGh0bWwpDQogICAgICAgICAgICAgICAgZm9yIG4gaW4gbWF0Y2g6DQogICAgICAgICAgICAgICAgICAgIGlmIG5vdCAndGV4dCcgaW4gbjoNCiAgICAgICAgICAgICAgICAgICAgICAgIHVybCA9IERlY29kZShEZWNvZGUobikpDQogICAgICAgICAgICAgICAgICAgICAgICBQbGF5KCdbQ09MT1Jnb2xkXScrYWx0KydbL0NPTE9SXVtDT0xPUndoaXRlXSAtIFtDT0xPUnN0ZWVsYmx1ZV0nK2JyKydbL0NPTE9SXScsdXJsLDkwNiwnJywnJywnJywnJywnJywnJykNCiAgICAgICAgICAgICAgICANCmRlZiB0dl9zaG93KCk6DQogICAgDQogICAgYWRkRGlyKCdbQ09MT1J3aGl0ZV1bQl1UdiBTaG93cyBMaXN0Wy9DT0xPUl1bL0JdJywnaHR0cDovL3d3dy50dm1hemUuY29tL3Nob3dzJyw0MDIsJ2h0dHA6Ly9zdGVwaGVuLWJ1aWxkcy51ay9hcnQvYWRkLmpwZycsJ2h0dHA6Ly9zdGVwaGVuLWJ1aWxkcy51ay9hcnQvZGFyay1wb3dlci1idXR0b24tcHNkLmpwZycsJycsJycsJycsJycsJycpDQogICAgYWRkRGlyKCdbQ09MT1J3aGl0ZV1TRUFSQ0ggVHYgU2hvd3NbL0NPTE9SXScsJycsNDA1LCdodHRwOi8vc3RlcGhlbi1idWlsZHMudWsvYXJ0L2FkZC5qcGcnLCdodHRwOi8vc3RlcGhlbi1idWlsZHMudWsvYXJ0L2RhcmstcG93ZXItYnV0dG9uLXBzZC5qcGcnLCcnLCcnLCcnLCcnLCcnKQ0KICAgIGFkZERpcignW0NPTE9Sd2hpdGVdUG9wdWxhciBUdiBTaG93c1svQ09MT1JdJywnaHR0cDovL3N0ZXBoZW4tYnVpbGRzLnVrL3N1cHJlbWFjeS9zY3JhcCUyMG1vdmllcy90diUyMHNob3dzL2dvdG1haW4udHh0Jyw0MTAsJ2h0dHA6Ly9zdGVwaGVuLWJ1aWxkcy51ay9hcnQvYWRkLmpwZycsJ2h0dHA6Ly9zdGVwaGVuLWJ1aWxkcy51ay9hcnQvZGFyay1wb3dlci1idXR0b24tcHNkLmpwZycsJycsJycsJycsJycsJycpDQogICAgYWRkRGlyKCdbQ09MT1J3aGl0ZV1OZXRmbGl4IE9yaWdpbmFsIFR2IFNob3dzWy9DT0xPUl0nICwgJ2h0dHA6Ly9zdGVwaGVuLWJ1aWxkcy51ay9zdXByZW1hY3kvc2NyYXAlMjBtb3ZpZXMvTmV0ZmxpeCUyME9yaWdpbmFsJTIwVHYlMjBTaG93cy9OZXRmbGl4JTIwT3JpZ2luYWwlMjBUdiUyMFNob3dzLnR4dCcgLCA0MTAgLCAnaHR0cDovL3N0ZXBoZW4tYnVpbGRzLnVrL2FydC9hZGQuanBnJyAsICdodHRwOi8vc3RlcGhlbi1idWlsZHMudWsvYXJ0L2RhcmstcG93ZXItYnV0dG9uLXBzZC5qcGcnICwgJycgLCAnJyAsICcnICwgJycgLCAnJyApDQoJDQoNCmRlZiBzaG93X21haW4odXJsKToNCiAgICBNZW51KCdbQ09MT1J3aGl0ZV1TRUFSQ0hbL0NPTE9SXScsJycsNDA1LCcnLEZBTkFSVCwnJywnJykNCiAgICBodG1sID0gcmVxdWVzdHMuZ2V0KHVybCkuY29udGVudA0KICAgIG1hdGNoID0gcmUuY29tcGlsZSgnPGZpZ3VyZSBjbGFzcz0iaW1hZ2Ugc21hbGwtMTIgY2VsbCI+Lis/aHJlZj0iKFtePl0qKT48aW1nIHNyYz0iKFteIl0qKSIgYWx0PSIoW14iXSopIj48L2E+JyxyZS5ET1RBTEwpLmZpbmRhbGwoaHRtbCkNCiAgICBOZXh0ID0gcmUuY29tcGlsZSgnPGxpIGNsYXNzPSJuZXh0Ij48YSBocmVmPSIoLis/KSInKS5maW5kYWxsKGh0bWwpDQogICAgZm9yIHVybCwgaW1nLCBuYW1lIGluIG1hdGNoOg0KICAgICAgICB1cmwyID0gJ2h0dHA6Ly93d3cudHZtYXplLmNvbScrdXJsLnJlcGxhY2UoJyInLCcnKQ0KICAgICAgICBodG1sMiA9IHJlcXVlc3RzLmdldCh1cmwyKS5jb250ZW50DQogICAgICAgIG1hdGNoID0gcmUuY29tcGlsZSgnPGFydGljbGU+Lis/PHA+KC4rPyk8L3A+JyxyZS5ET1RBTEwpLmZpbmRhbGwoaHRtbDIpDQogICAgICAgIGZvciBkZXNjIGluIG1hdGNoOg0KICAgICAgICAgICAgaWYgbm90ICc8ZGl2PicgaW4gZGVzYzoNCiAgICAgICAgICAgICAgICBkZXMgPSBkZXNjLnJlcGxhY2UoJzxiPicsJycpLnJlcGxhY2UoJzwvYj4nLCcnKS5yZXBsYWNlKCc8aT4nLCcnKS5yZXBsYWNlKCc8L2k+JywnJykNCiAgICAgICAgICAgIGltZyA9ICdodHRwOicraW1nDQogICAgICAgICAgICBuYW1lID0gbmFtZS5yZXBsYWNlKCcmIzAzOTsnLCcnKS5yZXBsYWNlKCcmYW1wOycsJyYnKQ0KICAgICAgICAgICAgaWYgbmFtZSA9PSAnJzoNCiAgICAgICAgICAgICAgICBnZXQgPSByZS5jb21waWxlKCcvc2hvd3MvLis/LyhbXiJdKikiJykuZmluZGFsbChzdHIodXJsKSkNCiAgICAgICAgICAgICAgICBmb3IgbmFtZSBpbiBnZXQ6DQogICAgICAgICAgICAgICAgICAgIG5hbWUgPSBuYW1lLnJlcGxhY2UoJy0nLCcgJykucmVwbGFjZSgnJiMwMzk7JywnJykucmVwbGFjZSgnJmFtcDsnLCcmJykNCiAgICAgICAgTWVudShuYW1lLHVybDIsNDAzLGltZyxmYW5hcnQsZGVzLCcnKQ0KDQogICAgZm9yIG54dCBpbiBOZXh0Og0KICAgICAgICB1cmwgPSAnaHR0cDovL3d3dy50dm1hemUuY29tJytueHQNCiAgICAgICAgTWVudSgnTkVYVCcsdXJsLDQwMixpbWcsZmFuYXJ0LCcnLCcnKQ0KDQpkZWYgZ2V0X2Vwcyh1cmwsbmFtZSxpY29uaW1hZ2UpOg0KICAgIHRpdGxlID0gbmFtZS5yZXBsYWNlKCcmIzAzOTsnLCcnKS5yZXBsYWNlKCcmYW1wOycsJyYnKQ0KICAgIGltZyA9IGljb25pbWFnZQ0KICAgIGh0bWwgPSByZXF1ZXN0cy5nZXQodXJsKycvZXBpc29kZXMnKS5jb250ZW50DQogICAgaHRtbDIgPSByZXF1ZXN0cy5nZXQodXJsKS5jb250ZW50DQogICAgYmxvY2sgPSByZS5jb21waWxlKCI8aDIgZGF0YS1tYWdlbGxhbi10YXJnZXQ9JyguKz8pJy4rPzx0Ym9keT4oLis/KTwvdGJvZHk+IixyZS5ET1RBTEwpLmZpbmRhbGwoaHRtbCkNCiAgICBtYXRjaCA9IHJlLmNvbXBpbGUoJzxzcGFuIGlkPSJ5ZWFyIj5cKCguKz8pLScscmUuRE9UQUxMKS5maW5kYWxsKGh0bWwyKQ0KICAgIGZvciBzaG93X3llYXIgaW4gbWF0Y2g6DQogICAgICAgIHNob3dfeWVhciA9IHNob3dfeWVhci5yZXBsYWNlKCcgJywnJykgICANCiAgICBmb3Igc2VhcyAsIHJlc3QgaW4gYmxvY2s6DQogICAgICAgIGlmIG5vdCAnc3BlY2lhbCcgaW4gc2Vhcy5sb3dlcigpOg0KICAgICAgICAgICAgc2VhcyA9IHNlYXMucmVwbGFjZSgnUycsJycpLnJlcGxhY2UoJ3MnLCcnKQ0KICAgICAgICBlcHMgPSByZS5jb21waWxlKCc8dHIgZGF0YS1rZXk9Ii4rPyI+PHRkPiguKz8pPC90ZD48dGQ+Lis/LCguKz8pPC90ZD4uKz9ocmVmPSIuKz8iPiguKz8pPC9hPicscmUuRE9UQUxMKS5maW5kYWxsKHN0cihyZXN0KSkNCiAgICAgICAgZm9yIGVwLCBlcF95ZWFyLCBlcF9uYW1lIGluIGVwczoNCiAgICAgICAgICAgIGlmIG5vdCAnc3BlY2lhbCcgaW4gZXAubG93ZXIoKToNCiAgICAgICAgICAgICAgICBNZW51KHRpdGxlKycgLSBTRUFTT04gLScrc2VhcysnLSBFUElTT0RFLScrZXArJy0nK3Nob3dfeWVhciwnJyw0MDQsaW1nLGZhbmFydCwnJyx0aXRsZSkNCg0KZGVmIG5hbnR2c2VhcmNoKCk6DQogICAgRGlhbG9nID0geGJtY2d1aS5EaWFsb2coKQ0KICAgIFNlYXJjaF9OYW1lID0gRGlhbG9nLmlucHV0KCdTZWFyY2hpbmcuLi4nLCB0eXBlPXhibWNndWkuSU5QVVRfQUxQSEFOVU0pDQogICAgU2VhcmNoX0NsZWFuX05hbWUgPSAnaHR0cDovL3d3dy50dm1hemUuY29tL3NlYXJjaD9xPScrKFNlYXJjaF9OYW1lKS5yZXBsYWNlKCcgJywnKycpDQogICAgU2VhcmNoX1RpdGxlID0gU2VhcmNoX0NsZWFuX05hbWUubG93ZXIoKQ0KICAgIEhUTUwgPSByZXF1ZXN0cy5nZXQoU2VhcmNoX1RpdGxlKS5jb250ZW50DQogICAgbWF0Y2ggPSByZS5jb21waWxlKCc8YSBocmVmPSIoW14iXSopIj48aW1nIHNyYz0iKFteIl0qKSIgYWx0PSIoW14iXSopIj48L2E+JyxyZS5ET1RBTEwpLmZpbmRhbGwoSFRNTCkNCiAgICBmb3IgdXJsLCBpbWcsIG5hbWUgaW4gbWF0Y2g6DQogICAgICAgIHVybDIgPSAnaHR0cDovL3d3dy50dm1hemUuY29tJyt1cmwucmVwbGFjZSgnIicsJycpDQogICAgICAgIGh0bWwyID0gcmVxdWVzdHMuZ2V0KHVybDIpLmNvbnRlbnQNCiAgICAgICAgbWF0Y2ggPSByZS5jb21waWxlKCc8YXJ0aWNsZT4uKz88cD4oLis/KTwvcD4nLHJlLkRPVEFMTCkuZmluZGFsbChodG1sMikNCiAgICAgICAgZm9yIGRlc2MgaW4gbWF0Y2g6DQogICAgICAgICAgICBpZiBub3QgJzxkaXY+JyBpbiBkZXNjOg0KICAgICAgICAgICAgICAgIGRlcyA9IGRlc2MucmVwbGFjZSgnPGI+JywnJykucmVwbGFjZSgnPC9iPicsJycpLnJlcGxhY2UoJzxpPicsJycpLnJlcGxhY2UoJzwvaT4nLCcnKQ0KICAgICAgICAgICAgaW1nID0gJ2h0dHA6JytpbWcNCiAgICAgICAgICAgIG5hbWUgPSBuYW1lLnJlcGxhY2UoJyYjMDM5OycsJycpLnJlcGxhY2UoJyZhbXA7JywnJicpDQogICAgICAgICAgICBpZiBuYW1lID09ICcnOg0KICAgICAgICAgICAgICAgIGdldCA9IHJlLmNvbXBpbGUoJy9zaG93cy8uKz8vKFteIl0qKSInKS5maW5kYWxsKHN0cih1cmwpKQ0KICAgICAgICAgICAgICAgIGZvciBuYW1lIGluIGdldDoNCiAgICAgICAgICAgICAgICAgICAgbmFtZSA9IG5hbWUucmVwbGFjZSgnLScsJyAnKS5yZXBsYWNlKCcmIzAzOTsnLCcnKS5yZXBsYWNlKCcmYW1wOycsJyYnKQ0KICAgICAgICBNZW51KG5hbWUsdXJsMiw0MDMsaW1nLGZhbmFydCxkZXMsJycpDQoNCmRlZiBzZW5kX3RvX3NlYXJjaDIobmFtZSxleHRyYSk6DQogICAgI3hibWMubG9nKCduYW1lOicrKHN0cihleHRyYSkpLHhibWMuTE9HTk9USUNFKQ0KICAgIGRwID0gIHhibWNndWkuRGlhbG9nUHJvZ3Jlc3MoKQ0KICAgIGRwLmNyZWF0ZSgnQ2hlY2tpbmcgZm9yIHN0cmVhbScpDQogICAgZnJvbSBtb2R1bGVzIGltcG9ydCBTY3JhcGVfTmFuDQogICAgbmFtZV9zcGxpdHRlciA9IG5hbWUgKyAnPD4nDQogICAgbmFtZV9zcGxpdCA9IHJlLmNvbXBpbGUoJyguKz8pLSBTRUFTT04gLSguKz8pLSBFUElTT0RFLSguKz8pLSguKz8pPD4nKS5maW5kYWxsKHN0cihuYW1lX3NwbGl0dGVyKSkNCiAgICBmb3IgdGl0bGUsc2Vhc29uLGVwaXNvZGUsc2hvd195ZWFyIGluIG5hbWVfc3BsaXQ6DQogICAgICAgIHRpdGxlID0gdGl0bGUNCiAgICAgICAgc2Vhc29uID0gc2Vhc29uDQogICAgICAgIGVwaXNvZGUgPSBlcGlzb2RlDQogICAgICAgIHR2ZGIgPSAnJw0KICAgICAgICBTY3JhcGVfTmFuLnNjcmFwZV9lcGlzb2RlKHRpdGxlLHNob3dfeWVhciwnJyxzZWFzb24sZXBpc29kZSwnJykNCg0KZGVmIGNhdGNodXB0djEodXJsKToNCiAgICBpbXBvcnQgYmFzZTY0DQogICAgRGVjb2RlID0gYmFzZTY0LmRlY29kZXN0cmluZw0KICAgIGh0bWwgPSByZXF1ZXN0cy5nZXQodXJsKS5jb250ZW50IA0KICAgIG1hdGNoID1yZS5jb21waWxlKCd2YXIuKz89Lis/IiguKz8pIicscmUuRE9UQUxMKS5maW5kYWxsKGh0bWwpDQogICAgZm9yIG4gaW4gbWF0Y2g6DQogICAgICAgIGlmIG5vdCAndGV4dCcgaW4gbjoNCiAgICAgICAgICAgIHVybCA9IERlY29kZShEZWNvZGUobikpDQogICAgICAgICAgICBCaWdfUmVzb2x2ZSgnJyx1cmwpDQoNCmRlZiBSRVNPTFZFdGVzdCh1cmwpOg0KICAgIGltcG9ydCByZXNvbHZldXJsDQogICAgdHJ5Og0KICAgICAgICByZXNvbHZlZF91cmwgPSByZXNvbHZldXJsLnJlc29sdmUodXJsKS5zdHJpcCgpDQogICAgICAgIHhibWMuUGxheWVyKCkucGxheShyZXNvbHZlZF91cmwsIHhibWNndWkuTGlzdEl0ZW0obmFtZSkpDQogICAgZXhjZXB0Og0KICAgICAgICB0cnk6DQogICAgICAgICAgICB4Ym1jLlBsYXllcigpLnBsYXkodXJsLCB4Ym1jZ3VpLkxpc3RJdGVtKG5hbWUpKQ0KICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICB4Ym1jZ3VpLkRpYWxvZygpLm5vdGlmaWNhdGlvbigiRVJST1IiLCAidW5wbGF5YWJsZSBzdHJlYW0iKQ0KICAgICAgICAgICAgc3lzLmV4aXQoKSANCg0KZGVmIHNlbmRfdG9fbW92aWVfc2VhcmNoX3B5cmFtaWQoZXh0cmEsdXJsKToNCiAgICBmcm9tIG1vZHVsZXMgaW1wb3J0IFNjcmFwZV9OYW4NCiAgICBuYW1lID0gc3RyKGV4dHJhKQ0KICAgIHllYXIgPSBzdHIodXJsKQ0KICAgIGRwID0gIHhibWNndWkuRGlhbG9nUHJvZ3Jlc3MoKQ0KICAgIGRwLmNyZWF0ZSgnQ2hlY2tpbmcgZm9yIHN0cmVhbScpDQogICAgU2NyYXBlX05hbi5zY3JhcGVfbW92aWUobmFtZSx5ZWFyLCcnKQ0KDQpkZWYgU2VhcmNoX2lucHV0KHVybCk6DQogICAgRGlhbG9nID0geGJtY2d1aS5EaWFsb2coKQ0KICAgIFNlYXJjaF90aXRsZSA9IERpYWxvZy5pbnB1dCgnU2VhcmNoJywgdHlwZT14Ym1jZ3VpLklOUFVUX0FMUEhBTlVNKQ0KICAgIFNlYXJjaF9uYW1lID0gU2VhcmNoX3RpdGxlLmxvd2VyKCkNCiAgICBpZiBTZWFyY2hfbmFtZSA9PSAnJzoNCiAgICAgICAgcGFzcw0KICAgIGVsc2U6DQogICAgICAgIFNlYXJjaF9sb29wKFNlYXJjaF9uYW1lLHVybCkgICAgDQoJDQpkZWYgU2VhcmNoX2xvb3AoU2VhcmNoX25hbWUsdXJsKToNCiAgICBIVE1MID0gT3Blbl9VcmwodXJsKQ0KICAgIGlmIEhUTUwgIT0gJ0ZhaWxlZCc6DQogICAgICAgIG1hdGNoID0gcmUuY29tcGlsZSgnPGNoYW5uZWw+Lis/PG5hbWU+KC4rPyk8L25hbWU+Lis/PHRodW1ibmFpbD4oLis/KTwvdGh1bWJuYWlsPi4rPzxleHRlcm5hbGxpbms+KC4rPyk8L2V4dGVybmFsbGluaz4uKz88ZmFuYXJ0PiguKz8pPC9mYW5hcnQ+Lis/PC9jaGFubmVsPicscmUuRE9UQUxMKS5maW5kYWxsKEhUTUwpDQogICAgICAgIGZvciBuYW1lLGltYWdlLHVybCxmYW5hcnQgaW4gbWF0Y2g6DQogICAgICAgICAgICBpZiBub3QgJ2h0dHA6JyBpbiB1cmw6DQogICAgICAgICAgICAgICAgcGFzcw0KICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICBTZWFyY2hfbG9vcChTZWFyY2hfbmFtZSx1cmwpDQogICAgICAgIG1hdGNoMiA9IHJlLmNvbXBpbGUoJzx0aXRsZT4oLis/KTwvdGl0bGU+Lis/PGxpbms+KC4rPyk8L2xpbms+Lis/PHRodW1ibmFpbD4oLis/KTwvdGh1bWJuYWlsPi4rPzxmYW5hcnQ+KC4rPyk8L2ZhbmFydD4nLHJlLkRPVEFMTCkuZmluZGFsbChIVE1MKQ0KICAgICAgICBmb3IgbmFtZSx1cmwsaW1hZ2UsZmFuYXJ0IGluIG1hdGNoMjoNCiAgICAgICAgICAgIGlmICdodHRwOicgaW4gdXJsOg0KICAgICAgICAgICAgICAgIGlmIFNlYXJjaF9uYW1lLmxvd2VyKCkgaW4gbmFtZS5sb3dlcigpOg0KICAgICAgICAgICAgICAgICAgICBhZGRMaW5rKHVybCwgbmFtZSxpbWFnZSxmYW5hcnQsJycsJycsJycsJycsTm9uZSwnJywxKQ0KCQkNCgkJDQpkZWYgZ2V0U291cmNlcygpOg0KICAgICAgICBpZiBvcy5wYXRoLmV4aXN0cyhmYXZvcml0ZXMpID09IFRydWU6DQogICAgICAgICAgICBhZGREaXIoJ0Zhdm9yaXRlcycsJ3VybCcsNCxvcy5wYXRoLmpvaW4oaG9tZSwgJ3Jlc291cmNlcycsICdmYXZvcml0ZS5wbmcnKSxGQU5BUlQsJycsJycsJycsJycpDQogICAgICAgIGlmIGFkZG9uLmdldFNldHRpbmcoImJyb3dzZV94bWxfZGF0YWJhc2UiKSA9PSAidHJ1ZSI6DQogICAgICAgICAgICBhZGREaXIoJ1hNTCBEYXRhYmFzZScsJ2h0dHA6Ly94Ym1jcGx1cy54Yi5mdW5waWMuZGUvd3d3LWRhdGEvZmlsZXN5c3RlbS8nLDE1LGljb24sRkFOQVJULCcnLCcnLCcnLCcnKQ0KICAgICAgICBpZiBhZGRvbi5nZXRTZXR0aW5nKCJicm93c2VfY29tbXVuaXR5IikgPT0gInRydWUiOg0KICAgICAgICAgICAgYWRkRGlyKCdDb21tdW5pdHkgRmlsZXMnLCdjb21tdW5pdHlfZmlsZXMnLDE2LGljb24sRkFOQVJULCcnLCcnLCcnLCcnKQ0KICAgICAgICBpZiBvcy5wYXRoLmV4aXN0cyhoaXN0b3J5KSA9PSBUcnVlOg0KICAgICAgICAgICAgYWRkRGlyKCdTZWFyY2ggSGlzdG9yeScsJ2hpc3RvcnknLDI1LG9zLnBhdGguam9pbihob21lLCAncmVzb3VyY2VzJywgJ2Zhdm9yaXRlLnBuZycpLEZBTkFSVCwnJywnJywnJywnJykNCiAgICAgICAgaWYgYWRkb24uZ2V0U2V0dGluZygic2VhcmNoeXQiKSA9PSAidHJ1ZSI6DQogICAgICAgICAgICBhZGREaXIoJ1NlYXJjaDpZb3V0dWJlJywneW91dHViZScsMjUsaWNvbixGQU5BUlQsJycsJycsJycsJycpDQogICAgICAgIGlmIGFkZG9uLmdldFNldHRpbmcoInNlYXJjaERNIikgPT0gInRydWUiOg0KICAgICAgICAgICAgYWRkRGlyKCdTZWFyY2g6ZGFpbHltb3Rpb24nLCdkbW90aW9uJywyNSxpY29uLEZBTkFSVCwnJywnJywnJywnJykNCiAgICAgICAgaWYgYWRkb24uZ2V0U2V0dGluZygiUHVsc2FyTSIpID09ICJ0cnVlIjoNCiAgICAgICAgICAgIGFkZERpcignUHVsc2FyOklNREInLCdJTURCaWRwbGF5JywyNyxpY29uLEZBTkFSVCwnJywnJywnJywnJykgICAgICAgICAgICANCiAgICAgICAgaWYgb3MucGF0aC5leGlzdHMoc291cmNlX2ZpbGUpPT1UcnVlOg0KICAgICAgICAgICAgc291cmNlcyA9IGpzb24ubG9hZHMob3Blbihzb3VyY2VfZmlsZSwiciIpLnJlYWQoKSkNCiAgICAgICAgICAgICNwcmludCAnc291cmNlcycsc291cmNlcw0KICAgICAgICAgICAgaWYgbGVuKHNvdXJjZXMpID4gMToNCiAgICAgICAgICAgICAgICBmb3IgaSBpbiBzb3VyY2VzOg0KICAgICAgICAgICAgICAgICAgICAjIyBmb3IgcHJlIDEuMC44IHNvdXJjZXMNCiAgICAgICAgICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShpLCBsaXN0KToNCiAgICAgICAgICAgICAgICAgICAgICAgIGFkZERpcihpWzBdLmVuY29kZSgndXRmLTgnKSxpWzFdLmVuY29kZSgndXRmLTgnKSwxLGljb24sRkFOQVJULCcnLCcnLCcnLCcnLCdzb3VyY2UnKQ0KICAgICAgICAgICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgICAgICAgICAgdGh1bWIgPSBpY29uDQogICAgICAgICAgICAgICAgICAgICAgICBmYW5hcnQgPSBGQU5BUlQNCiAgICAgICAgICAgICAgICAgICAgICAgIGRlc2MgPSAnJw0KICAgICAgICAgICAgICAgICAgICAgICAgZGF0ZSA9ICcnDQogICAgICAgICAgICAgICAgICAgICAgICBjcmVkaXRzID0gJycNCiAgICAgICAgICAgICAgICAgICAgICAgIGdlbnJlID0gJycNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGkuaGFzX2tleSgndGh1bWJuYWlsJyk6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGh1bWIgPSBpWyd0aHVtYm5haWwnXQ0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgaS5oYXNfa2V5KCdmYW5hcnQnKToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmYW5hcnQgPSBpWydmYW5hcnQnXQ0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgaS5oYXNfa2V5KCdkZXNjcmlwdGlvbicpOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlc2MgPSBpWydkZXNjcmlwdGlvbiddDQogICAgICAgICAgICAgICAgICAgICAgICBpZiBpLmhhc19rZXkoJ2RhdGUnKToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRlID0gaVsnZGF0ZSddDQogICAgICAgICAgICAgICAgICAgICAgICBpZiBpLmhhc19rZXkoJ2dlbnJlJyk6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2VucmUgPSBpWydnZW5yZSddDQogICAgICAgICAgICAgICAgICAgICAgICBpZiBpLmhhc19rZXkoJ2NyZWRpdHMnKToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjcmVkaXRzID0gaVsnY3JlZGl0cyddDQogICAgICAgICAgICAgICAgICAgICAgICBhZGREaXIoaVsndGl0bGUnXS5lbmNvZGUoJ3V0Zi04JyksaVsndXJsJ10uZW5jb2RlKCd1dGYtOCcpLDEsdGh1bWIsZmFuYXJ0LGRlc2MsZ2VucmUsZGF0ZSxjcmVkaXRzLCdzb3VyY2UnKQ0KDQogICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgIGlmIGxlbihzb3VyY2VzKSA9PSAxOg0KICAgICAgICAgICAgICAgICAgICBpZiBpc2luc3RhbmNlKHNvdXJjZXNbMF0sIGxpc3QpOg0KICAgICAgICAgICAgICAgICAgICAgICAgZ2V0RGF0YShzb3VyY2VzWzBdWzFdLmVuY29kZSgndXRmLTgnKSxGQU5BUlQpDQogICAgICAgICAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgICAgICAgICBnZXREYXRhKHNvdXJjZXNbMF1bJ3VybCddLCBzb3VyY2VzWzBdWydmYW5hcnQnXSkNCg0KDQpkZWYgYWRkU291cmNlKHVybD1Ob25lKToNCiAgICAgICAgaWYgdXJsIGlzIE5vbmU6DQogICAgICAgICAgICBpZiBub3QgYWRkb24uZ2V0U2V0dGluZygibmV3X2ZpbGVfc291cmNlIikgPT0gIiI6DQogICAgICAgICAgICAgICBzb3VyY2VfdXJsID0gYWRkb24uZ2V0U2V0dGluZygnbmV3X2ZpbGVfc291cmNlJykuZGVjb2RlKCd1dGYtOCcpDQogICAgICAgICAgICBlbGlmIG5vdCBhZGRvbi5nZXRTZXR0aW5nKCJuZXdfdXJsX3NvdXJjZSIpID09ICIiOg0KICAgICAgICAgICAgICAgc291cmNlX3VybCA9IGFkZG9uLmdldFNldHRpbmcoJ25ld191cmxfc291cmNlJykuZGVjb2RlKCd1dGYtOCcpDQogICAgICAgIGVsc2U6DQogICAgICAgICAgICBzb3VyY2VfdXJsID0gdXJsDQogICAgICAgIGlmIHNvdXJjZV91cmwgPT0gJycgb3Igc291cmNlX3VybCBpcyBOb25lOg0KICAgICAgICAgICAgcmV0dXJuDQogICAgICAgIGFkZG9uX2xvZygnQWRkaW5nIE5ldyBTb3VyY2U6ICcrc291cmNlX3VybC5lbmNvZGUoJ3V0Zi04JykpDQoNCiAgICAgICAgbWVkaWFfaW5mbyA9IE5vbmUNCiAgICAgICAgI3ByaW50ICdzb3VyY2VfdXJsJyxzb3VyY2VfdXJsDQogICAgICAgIGRhdGEgPSBnZXRTb3VwKHNvdXJjZV91cmwpDQogICAgICAgIHByaW50ICdzb3VyY2VfdXJsJyxzb3VyY2VfdXJsDQogICAgICAgIGlmIGlzaW5zdGFuY2UoZGF0YSxCZWF1dGlmdWxTT0FQKToNCiAgICAgICAgICAgIGlmIGRhdGEuZmluZCgnY2hhbm5lbHNfaW5mbycpOg0KICAgICAgICAgICAgICAgIG1lZGlhX2luZm8gPSBkYXRhLmNoYW5uZWxzX2luZm8NCiAgICAgICAgICAgIGVsaWYgZGF0YS5maW5kKCdpdGVtc19pbmZvJyk6DQogICAgICAgICAgICAgICAgbWVkaWFfaW5mbyA9IGRhdGEuaXRlbXNfaW5mbw0KICAgICAgICBpZiBtZWRpYV9pbmZvOg0KICAgICAgICAgICAgc291cmNlX21lZGlhID0ge30NCiAgICAgICAgICAgIHNvdXJjZV9tZWRpYVsndXJsJ10gPSBzb3VyY2VfdXJsDQogICAgICAgICAgICB0cnk6IHNvdXJjZV9tZWRpYVsndGl0bGUnXSA9IG1lZGlhX2luZm8udGl0bGUuc3RyaW5nDQogICAgICAgICAgICBleGNlcHQ6IHBhc3MNCiAgICAgICAgICAgIHRyeTogc291cmNlX21lZGlhWyd0aHVtYm5haWwnXSA9IG1lZGlhX2luZm8udGh1bWJuYWlsLnN0cmluZw0KICAgICAgICAgICAgZXhjZXB0OiBwYXNzDQogICAgICAgICAgICB0cnk6IHNvdXJjZV9tZWRpYVsnZmFuYXJ0J10gPSBtZWRpYV9pbmZvLmZhbmFydC5zdHJpbmcNCiAgICAgICAgICAgIGV4Y2VwdDogcGFzcw0KICAgICAgICAgICAgdHJ5OiBzb3VyY2VfbWVkaWFbJ2dlbnJlJ10gPSBtZWRpYV9pbmZvLmdlbnJlLnN0cmluZw0KICAgICAgICAgICAgZXhjZXB0OiBwYXNzDQogICAgICAgICAgICB0cnk6IHNvdXJjZV9tZWRpYVsnZGVzY3JpcHRpb24nXSA9IG1lZGlhX2luZm8uZGVzY3JpcHRpb24uc3RyaW5nDQogICAgICAgICAgICBleGNlcHQ6IHBhc3MNCiAgICAgICAgICAgIHRyeTogc291cmNlX21lZGlhWydkYXRlJ10gPSBtZWRpYV9pbmZvLmRhdGUuc3RyaW5nDQogICAgICAgICAgICBleGNlcHQ6IHBhc3MNCiAgICAgICAgICAgIHRyeTogc291cmNlX21lZGlhWydjcmVkaXRzJ10gPSBtZWRpYV9pbmZvLmNyZWRpdHMuc3RyaW5nDQogICAgICAgICAgICBleGNlcHQ6IHBhc3MNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIGlmICcvJyBpbiBzb3VyY2VfdXJsOg0KICAgICAgICAgICAgICAgIG5hbWVTdHIgPSBzb3VyY2VfdXJsLnNwbGl0KCcvJylbLTFdLnNwbGl0KCcuJylbMF0NCiAgICAgICAgICAgIGlmICdcXCcgaW4gc291cmNlX3VybDoNCiAgICAgICAgICAgICAgICBuYW1lU3RyID0gc291cmNlX3VybC5zcGxpdCgnXFwnKVstMV0uc3BsaXQoJy4nKVswXQ0KICAgICAgICAgICAgaWYgJyUnIGluIG5hbWVTdHI6DQogICAgICAgICAgICAgICAgbmFtZVN0ciA9IHVybGxpYi51bnF1b3RlX3BsdXMobmFtZVN0cikNCiAgICAgICAgICAgIGtleWJvYXJkID0geGJtYy5LZXlib2FyZChuYW1lU3RyLCdEaXNwbGF5ZWQgTmFtZSwgUmVuYW1lPycpDQogICAgICAgICAgICBrZXlib2FyZC5kb01vZGFsKCkNCiAgICAgICAgICAgIGlmIChrZXlib2FyZC5pc0NvbmZpcm1lZCgpID09IEZhbHNlKToNCiAgICAgICAgICAgICAgICByZXR1cm4NCiAgICAgICAgICAgIG5ld1N0ciA9IGtleWJvYXJkLmdldFRleHQoKQ0KICAgICAgICAgICAgaWYgbGVuKG5ld1N0cikgPT0gMDoNCiAgICAgICAgICAgICAgICByZXR1cm4NCiAgICAgICAgICAgIHNvdXJjZV9tZWRpYSA9IHt9DQogICAgICAgICAgICBzb3VyY2VfbWVkaWFbJ3RpdGxlJ10gPSBuZXdTdHINCiAgICAgICAgICAgIHNvdXJjZV9tZWRpYVsndXJsJ10gPSBzb3VyY2VfdXJsDQogICAgICAgICAgICBzb3VyY2VfbWVkaWFbJ2ZhbmFydCddID0gZmFuYXJ0DQoNCiAgICAgICAgaWYgb3MucGF0aC5leGlzdHMoc291cmNlX2ZpbGUpPT1GYWxzZToNCiAgICAgICAgICAgIHNvdXJjZV9saXN0ID0gW10NCiAgICAgICAgICAgIHNvdXJjZV9saXN0LmFwcGVuZChzb3VyY2VfbWVkaWEpDQogICAgICAgICAgICBiID0gb3Blbihzb3VyY2VfZmlsZSwidyIpDQogICAgICAgICAgICBiLndyaXRlKGpzb24uZHVtcHMoc291cmNlX2xpc3QpKQ0KICAgICAgICAgICAgYi5jbG9zZSgpDQogICAgICAgIGVsc2U6DQogICAgICAgICAgICBzb3VyY2VzID0ganNvbi5sb2FkcyhvcGVuKHNvdXJjZV9maWxlLCJyIikucmVhZCgpKQ0KICAgICAgICAgICAgc291cmNlcy5hcHBlbmQoc291cmNlX21lZGlhKQ0KICAgICAgICAgICAgYiA9IG9wZW4oc291cmNlX2ZpbGUsInciKQ0KICAgICAgICAgICAgYi53cml0ZShqc29uLmR1bXBzKHNvdXJjZXMpKQ0KICAgICAgICAgICAgYi5jbG9zZSgpDQogICAgICAgIGFkZG9uLnNldFNldHRpbmcoJ25ld191cmxfc291cmNlJywgIiIpDQogICAgICAgIGFkZG9uLnNldFNldHRpbmcoJ25ld19maWxlX3NvdXJjZScsICIiKQ0KICAgICAgICB4Ym1jLmV4ZWN1dGVidWlsdGluKCJYQk1DLk5vdGlmaWNhdGlvbihTa3luZXQsTmV3IHNvdXJjZSBhZGRlZC4sNTAwMCwiK2ljb24rIikiKQ0KICAgICAgICBpZiBub3QgdXJsIGlzIE5vbmU6DQogICAgICAgICAgICBpZiAneGJtY3BsdXMueGIuZnVucGljLmRlJyBpbiB1cmw6DQogICAgICAgICAgICAgICAgeGJtYy5leGVjdXRlYnVpbHRpbigiWEJNQy5Db250YWluZXIuVXBkYXRlKCVzP21vZGU9MTQscmVwbGFjZSkiICVzeXMuYXJndlswXSkNCiAgICAgICAgICAgIGVsaWYgJ2NvbW11bml0eS1saW5rcycgaW4gdXJsOg0KICAgICAgICAgICAgICAgIHhibWMuZXhlY3V0ZWJ1aWx0aW4oIlhCTUMuQ29udGFpbmVyLlVwZGF0ZSglcz9tb2RlPTEwLHJlcGxhY2UpIiAlc3lzLmFyZ3ZbMF0pDQogICAgICAgIGVsc2U6IGFkZG9uLm9wZW5TZXR0aW5ncygpDQoJDQoNCmRlZiBybVNvdXJjZShuYW1lKToNCiAgICAgICAgc291cmNlcyA9IGpzb24ubG9hZHMob3Blbihzb3VyY2VfZmlsZSwiciIpLnJlYWQoKSkNCiAgICAgICAgZm9yIGluZGV4IGluIHJhbmdlKGxlbihzb3VyY2VzKSk6DQogICAgICAgICAgICBpZiBpc2luc3RhbmNlKHNvdXJjZXNbaW5kZXhdLCBsaXN0KToNCiAgICAgICAgICAgICAgICBpZiBzb3VyY2VzW2luZGV4XVswXSA9PSBuYW1lOg0KICAgICAgICAgICAgICAgICAgICBkZWwgc291cmNlc1tpbmRleF0NCiAgICAgICAgICAgICAgICAgICAgYiA9IG9wZW4oc291cmNlX2ZpbGUsInciKQ0KICAgICAgICAgICAgICAgICAgICBiLndyaXRlKGpzb24uZHVtcHMoc291cmNlcykpDQogICAgICAgICAgICAgICAgICAgIGIuY2xvc2UoKQ0KICAgICAgICAgICAgICAgICAgICBicmVhaw0KICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICBpZiBzb3VyY2VzW2luZGV4XVsndGl0bGUnXSA9PSBuYW1lOg0KICAgICAgICAgICAgICAgICAgICBkZWwgc291cmNlc1tpbmRleF0NCiAgICAgICAgICAgICAgICAgICAgYiA9IG9wZW4oc291cmNlX2ZpbGUsInciKQ0KICAgICAgICAgICAgICAgICAgICBiLndyaXRlKGpzb24uZHVtcHMoc291cmNlcykpDQogICAgICAgICAgICAgICAgICAgIGIuY2xvc2UoKQ0KICAgICAgICAgICAgICAgICAgICBicmVhaw0KICAgICAgICB4Ym1jLmV4ZWN1dGVidWlsdGluKCJYQk1DLkNvbnRhaW5lci5SZWZyZXNoIikNCg0KDQoNCmRlZiBnZXRfeG1sX2RhdGFiYXNlKHVybCwgYnJvd3NlPUZhbHNlKToNCiAgICAgICAgaWYgdXJsIGlzIE5vbmU6DQogICAgICAgICAgICB1cmwgPSAnaHR0cDovL3hibWNwbHVzLnhiLmZ1bnBpYy5kZS93d3ctZGF0YS9maWxlc3lzdGVtLycNCiAgICAgICAgc291cCA9IEJlYXV0aWZ1bFNvdXAobWFrZVJlcXVlc3QodXJsKSwgY29udmVydEVudGl0aWVzPUJlYXV0aWZ1bFNvdXAuSFRNTF9FTlRJVElFUykNCiAgICAgICAgZm9yIGkgaW4gc291cCgnYScpOg0KICAgICAgICAgICAgaHJlZiA9IGlbJ2hyZWYnXQ0KICAgICAgICAgICAgaWYgbm90IGhyZWYuc3RhcnRzd2l0aCgnPycpOg0KICAgICAgICAgICAgICAgIG5hbWUgPSBpLnN0cmluZw0KICAgICAgICAgICAgICAgIGlmIG5hbWUgbm90IGluIFsnUGFyZW50IERpcmVjdG9yeScsICdyZWN5Y2xlX2Jpbi8nXToNCiAgICAgICAgICAgICAgICAgICAgaWYgaHJlZi5lbmRzd2l0aCgnLycpOg0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgYnJvd3NlOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZERpcihuYW1lLHVybCtocmVmLDE1LGljb24sZmFuYXJ0LCcnLCcnLCcnKQ0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGREaXIobmFtZSx1cmwraHJlZiwxNCxpY29uLGZhbmFydCwnJywnJywnJykNCiAgICAgICAgICAgICAgICAgICAgZWxpZiBocmVmLmVuZHN3aXRoKCcueG1sJyk6DQogICAgICAgICAgICAgICAgICAgICAgICBpZiBicm93c2U6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkRGlyKG5hbWUsdXJsK2hyZWYsMSxpY29uLGZhbmFydCwnJywnJywnJywnJywnZG93bmxvYWQnKQ0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBvcy5wYXRoLmV4aXN0cyhzb3VyY2VfZmlsZSk9PVRydWU6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5hbWUgaW4gU09VUkNFUzoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZERpcihuYW1lKycgKGluIHVzZSknLHVybCtocmVmLDExLGljb24sZmFuYXJ0LCcnLCcnLCcnLCcnLCdkb3dubG9hZCcpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGREaXIobmFtZSx1cmwraHJlZiwxMSxpY29uLGZhbmFydCwnJywnJywnJywnJywnZG93bmxvYWQnKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZERpcihuYW1lLHVybCtocmVmLDExLGljb24sZmFuYXJ0LCcnLCcnLCcnLCcnLCdkb3dubG9hZCcpDQoNCg0KZGVmIGdldENvbW11bml0eVNvdXJjZXMoYnJvd3NlPUZhbHNlKToNCiAgICAgICAgdXJsID0gJ2h0dHA6Ly9jb21tdW5pdHktbGlua3MuZ29vZ2xlY29kZS5jb20vc3ZuL3RydW5rLycNCiAgICAgICAgc291cCA9IEJlYXV0aWZ1bFNvdXAobWFrZVJlcXVlc3QodXJsKSwgY29udmVydEVudGl0aWVzPUJlYXV0aWZ1bFNvdXAuSFRNTF9FTlRJVElFUykNCiAgICAgICAgZmlsZXMgPSBzb3VwKCd1bCcpWzBdKCdsaScpWzE6XQ0KICAgICAgICBmb3IgaSBpbiBmaWxlczoNCiAgICAgICAgICAgIG5hbWUgPSBpKCdhJylbMF1bJ2hyZWYnXQ0KICAgICAgICAgICAgaWYgYnJvd3NlOg0KICAgICAgICAgICAgICAgIGFkZERpcihuYW1lLHVybCtuYW1lLDEsaWNvbixmYW5hcnQsJycsJycsJycsJycsJ2Rvd25sb2FkJykNCiAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgYWRkRGlyKG5hbWUsdXJsK25hbWUsMTEsaWNvbixmYW5hcnQsJycsJycsJycsJycsJ2Rvd25sb2FkJykNCg0KDQpkZWYgZ2V0U291cCh1cmwsZGF0YT1Ob25lKToNCiAgICAgICAgcHJpbnQgJ2dldHNvdXAnLHVybCxkYXRhDQogICAgICAgIGlmIHVybC5zdGFydHN3aXRoKCdodHRwOi8vJykgb3IgdXJsLnN0YXJ0c3dpdGgoJ2h0dHBzOi8vJyk6DQogICAgICAgICAgICBkYXRhID0gbWFrZVJlcXVlc3QodXJsKQ0KICAgICAgICAgICAgaWYgcmUuc2VhcmNoKCIjRVhUTTNVIixkYXRhKSBvciAnbTN1JyBpbiB1cmw6IA0KICAgICAgICAgICAgICAgIHByaW50ICdmb3VuZCBtM3UgZGF0YScsZGF0YQ0KICAgICAgICAgICAgICAgIHJldHVybiBkYXRhDQogICAgICAgICAgICAgICAgDQogICAgICAgIGVsaWYgZGF0YSA9PSBOb25lOg0KICAgICAgICAgICAgaWYgeGJtY3Zmcy5leGlzdHModXJsKToNCiAgICAgICAgICAgICAgICBpZiB1cmwuc3RhcnRzd2l0aCgic21iOi8vIikgb3IgdXJsLnN0YXJ0c3dpdGgoIm5mczovLyIpOg0KICAgICAgICAgICAgICAgICAgICBjb3B5ID0geGJtY3Zmcy5jb3B5KHVybCwgb3MucGF0aC5qb2luKHByb2ZpbGUsICd0ZW1wJywgJ3NvcmNlX3RlbXAudHh0JykpDQogICAgICAgICAgICAgICAgICAgIGlmIGNvcHk6DQogICAgICAgICAgICAgICAgICAgICAgICBkYXRhID0gb3Blbihvcy5wYXRoLmpvaW4ocHJvZmlsZSwgJ3RlbXAnLCAnc29yY2VfdGVtcC50eHQnKSwgInIiKS5yZWFkKCkNCiAgICAgICAgICAgICAgICAgICAgICAgIHhibWN2ZnMuZGVsZXRlKG9zLnBhdGguam9pbihwcm9maWxlLCAndGVtcCcsICdzb3JjZV90ZW1wLnR4dCcpKQ0KICAgICAgICAgICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgICAgICAgICAgYWRkb25fbG9nKCJmYWlsZWQgdG8gY29weSBmcm9tIHNtYjoiKQ0KICAgICAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgICAgIGRhdGEgPSBvcGVuKHVybCwgJ3InKS5yZWFkKCkNCiAgICAgICAgICAgICAgICAgICAgaWYgcmUubWF0Y2goIiNFWFRNM1UiLGRhdGEpb3IgJ20zdScgaW4gdXJsOiANCiAgICAgICAgICAgICAgICAgICAgICAgIHByaW50ICdmb3VuZCBtM3UgZGF0YScsZGF0YQ0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRhdGENCiAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgYWRkb25fbG9nKCJTb3VwIERhdGEgbm90IGZvdW5kISIpDQogICAgICAgICAgICAgICAgcmV0dXJuDQogICAgICAgIHJldHVybiBCZWF1dGlmdWxTT0FQKGRhdGEsIGNvbnZlcnRFbnRpdGllcz1CZWF1dGlmdWxTdG9uZVNvdXAuWE1MX0VOVElUSUVTKQ0KDQoNCmRlZiBnZXREYXRhKHVybCxmYW5hcnQpOg0KICAgIHByaW50ICd1cmwtZ2V0RGF0YScsdXJsDQogICAgU2V0Vmlld0xheW91dCA9ICJMaXN0Ig0KICAgICANCiAgICBzb3VwID0gZ2V0U291cCh1cmwpDQogICAgI3ByaW50IHR5cGUoc291cCkNCiAgICBpZiBpc2luc3RhbmNlKHNvdXAsQmVhdXRpZnVsU09BUCk6DQogICAgICAgIGlmIGxlbihzb3VwKCdsYXlvdXR5cGUnKSkgPiAwOg0KICAgICAgICAgICAgU2V0Vmlld0xheW91dCA9ICJUaHVtYm5haWwiCQkgICAgDQoNCiAgICAgICAgaWYgbGVuKHNvdXAoJ2NoYW5uZWxzJykpID4gMDoNCiAgICAgICAgICAgIGNoYW5uZWxzID0gc291cCgnY2hhbm5lbCcpDQogICAgICAgICAgICBmb3IgY2hhbm5lbCBpbiBjaGFubmVsczoNCiMgICAgICAgICAgICAgICAgcHJpbnQgY2hhbm5lbA0KDQogICAgICAgICAgICAgICAgbGlua2VkVXJsPScnDQogICAgICAgICAgICAgICAgbGNvdW50PTANCiAgICAgICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgICAgIGxpbmtlZFVybCA9ICBjaGFubmVsKCdleHRlcm5hbGxpbmsnKVswXS5zdHJpbmcNCiAgICAgICAgICAgICAgICAgICAgbGNvdW50PWxlbihjaGFubmVsKCdleHRlcm5hbGxpbmsnKSkNCiAgICAgICAgICAgICAgICBleGNlcHQ6IHBhc3MNCiAgICAgICAgICAgICAgICAjcHJpbnQgJ2xpbmtlZFVybCcsbGlua2VkVXJsLGxjb3VudA0KICAgICAgICAgICAgICAgIGlmIGxjb3VudD4xOiBsaW5rZWRVcmw9JycNCg0KICAgICAgICAgICAgICAgIG5hbWUgPSBjaGFubmVsKCduYW1lJylbMF0uc3RyaW5nDQogICAgICAgICAgICAgICAgdGh1bWJuYWlsID0gY2hhbm5lbCgndGh1bWJuYWlsJylbMF0uc3RyaW5nDQogICAgICAgICAgICAgICAgaWYgdGh1bWJuYWlsID09IE5vbmU6DQogICAgICAgICAgICAgICAgICAgIHRodW1ibmFpbCA9ICcnDQoNCiAgICAgICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgICAgIGlmIG5vdCBjaGFubmVsKCdmYW5hcnQnKToNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGFkZG9uLmdldFNldHRpbmcoJ3VzZV90aHVtYicpID09ICJ0cnVlIjoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmYW5BcnQgPSB0aHVtYm5haWwNCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZmFuQXJ0ID0gZmFuYXJ0DQogICAgICAgICAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgICAgICAgICBmYW5BcnQgPSBjaGFubmVsKCdmYW5hcnQnKVswXS5zdHJpbmcNCiAgICAgICAgICAgICAgICAgICAgaWYgZmFuQXJ0ID09IE5vbmU6DQogICAgICAgICAgICAgICAgICAgICAgICByYWlzZQ0KICAgICAgICAgICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgICAgICAgICAgZmFuQXJ0ID0gZmFuYXJ0DQoNCiAgICAgICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgICAgIGRlc2MgPSBjaGFubmVsKCdpbmZvJylbMF0uc3RyaW5nDQogICAgICAgICAgICAgICAgICAgIGlmIGRlc2MgPT0gTm9uZToNCiAgICAgICAgICAgICAgICAgICAgICAgIHJhaXNlDQogICAgICAgICAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgICAgICAgICBkZXNjID0gJycNCg0KICAgICAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICAgICAgZ2VucmUgPSBjaGFubmVsKCdnZW5yZScpWzBdLnN0cmluZw0KICAgICAgICAgICAgICAgICAgICBpZiBnZW5yZSA9PSBOb25lOg0KICAgICAgICAgICAgICAgICAgICAgICAgcmFpc2UNCiAgICAgICAgICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICAgICAgICAgIGdlbnJlID0gJycNCg0KICAgICAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICAgICAgZGF0ZSA9IGNoYW5uZWwoJ2RhdGUnKVswXS5zdHJpbmcNCiAgICAgICAgICAgICAgICAgICAgaWYgZGF0ZSA9PSBOb25lOg0KICAgICAgICAgICAgICAgICAgICAgICAgcmFpc2UNCiAgICAgICAgICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICAgICAgICAgIGRhdGUgPSAnJw0KDQogICAgICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgICAgICBjcmVkaXRzID0gY2hhbm5lbCgnY3JlZGl0cycpWzBdLnN0cmluZw0KICAgICAgICAgICAgICAgICAgICBpZiBjcmVkaXRzID09IE5vbmU6DQogICAgICAgICAgICAgICAgICAgICAgICByYWlzZQ0KICAgICAgICAgICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgICAgICAgICAgY3JlZGl0cyA9ICcnDQoNCiAgICAgICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgICAgIGlmIGxpbmtlZFVybD09Jyc6DQogICAgICAgICAgICAgICAgICAgICAgICBhZGREaXIobmFtZS5lbmNvZGUoJ3V0Zi04JywgJ2lnbm9yZScpLHVybC5lbmNvZGUoJ3V0Zi04JyksMix0aHVtYm5haWwsZmFuQXJ0LGRlc2MsZ2VucmUsZGF0ZSxjcmVkaXRzLFRydWUpDQogICAgICAgICAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgICAgICAgICAjcHJpbnQgbGlua2VkVXJsDQogICAgICAgICAgICAgICAgICAgICAgICBhZGREaXIobmFtZS5lbmNvZGUoJ3V0Zi04JyksbGlua2VkVXJsLmVuY29kZSgndXRmLTgnKSwxLHRodW1ibmFpbCxmYW5BcnQsZGVzYyxnZW5yZSxkYXRlLE5vbmUsJ3NvdXJjZScpDQogICAgICAgICAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgICAgICAgICBhZGRvbl9sb2coJ1RoZXJlIHdhcyBhIHByb2JsZW0gYWRkaW5nIGRpcmVjdG9yeSBmcm9tIGdldERhdGEoKTogJytuYW1lLmVuY29kZSgndXRmLTgnLCAnaWdub3JlJykpDQogICAgICAgIGVsc2U6DQogICAgICAgICAgICBhZGRvbl9sb2coJ05vIENoYW5uZWxzOiBnZXRJdGVtcycpDQogICAgICAgICAgICBnZXRJdGVtcyhzb3VwKCdpdGVtJyksZmFuYXJ0KQ0KICAgIGVsc2U6DQogICAgICAgIHBhcnNlX20zdShzb3VwKQ0KDQogICAgaWYgU2V0Vmlld0xheW91dCA9PSAiVGh1bWJuYWlsIjoNCiAgICAgICBTZXRWaWV3VGh1bWJuYWlsKCkNCg0KCQ0KCQ0KIyBib3Jyb3cgZnJvbSBodHRwczovL2dpdGh1Yi5jb20vZW5lbjkyL1AyUC1TdHJlYW1zLVhCTUMvYmxvYi9tYXN0ZXIvcGx1Z2luLnZpZGVvLnAycC1zdHJlYW1zL3Jlc291cmNlcy9jb3JlL2xpdmVzdHJlYW1zLnB5DQojIFRoaXMgd2lsbCBub3QgZ28gdGhyb3VnaCB0aGUgZ2V0SXRlbXMgZnVuY3Rpb25zICggbWVhbnMgeW91IG11c3QgaGF2ZSByZWFkeSB0byBwbGF5IHVybCwgbm8gcmVnZXgpDQpkZWYgcGFyc2VfbTN1KGRhdGEpOg0KICAgIGNvbnRlbnQgPSBkYXRhLnJzdHJpcCgpDQogICAgbWF0Y2ggPSByZS5jb21waWxlKHInI0VYVElORjooLis/KSwoLio/KVtcblxyXSsoW15cbl0rKScpLmZpbmRhbGwoY29udGVudCkNCiAgICB0b3RhbCA9IGxlbihtYXRjaCkNCiAgICBwcmludCAndG90YWwgbTN1IGxpbmtzJyx0b3RhbA0KICAgIGZvciBvdGhlcixjaGFubmVsX25hbWUsc3RyZWFtX3VybCBpbiBtYXRjaDoNCiAgICAgICAgaWYgJ3R2Zy1sb2dvJyBpbiBvdGhlcjoNCiAgICAgICAgICAgIHRodW1ibmFpbCA9IHJlX21lKG90aGVyLCd0dmctbG9nbz1bXCciXSguKj8pW1wnIl0nKQ0KICAgICAgICAgICAgaWYgdGh1bWJuYWlsOg0KICAgICAgICAgICAgICAgIGlmIHRodW1ibmFpbC5zdGFydHN3aXRoKCdodHRwJyk6DQogICAgICAgICAgICAgICAgICAgIHRodW1ibmFpbCA9IHRodW1ibmFpbA0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIGVsaWYgbm90IGFkZG9uLmdldFNldHRpbmcoJ2xvZ28tZm9sZGVyUGF0aCcpID09ICIiOg0KICAgICAgICAgICAgICAgICAgICBsb2dvX3VybCA9IGFkZG9uLmdldFNldHRpbmcoJ2xvZ28tZm9sZGVyUGF0aCcpDQogICAgICAgICAgICAgICAgICAgIHRodW1ibmFpbCA9IGxvZ29fdXJsICsgdGh1bWJuYWlsDQoNCiAgICAgICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgICAgICB0aHVtYm5haWwgPSB0aHVtYm5haWwNCiAgICAgICAgICAgICNlbHNlOg0KICAgICAgICAgICAgDQogICAgICAgIGVsc2U6DQogICAgICAgICAgICB0aHVtYm5haWwgPSAnJw0KICAgICAgICBpZiAndHlwZScgaW4gb3RoZXI6DQogICAgICAgICAgICBtb2RlX3R5cGUgPSByZV9tZShvdGhlciwndHlwZT1bXCciXSguKj8pW1wnIl0nKQ0KICAgICAgICAgICAgaWYgbW9kZV90eXBlID09ICd5dC1kbCc6DQogICAgICAgICAgICAgICAgc3RyZWFtX3VybCA9IHN0cmVhbV91cmwgKyImbW9kZT0xOCINCiAgICAgICAgICAgIGVsaWYgbW9kZV90eXBlID09ICdyZWdleCc6DQogICAgICAgICAgICAgICAgdXJsID0gc3RyZWFtX3VybC5zcGxpdCgnJnJlZ2V4cz0nKQ0KICAgICAgICAgICAgICAgICNwcmludCB1cmxbMF0gZ2V0U291cCh1cmwsZGF0YT1Ob25lKQ0KICAgICAgICAgICAgICAgIHJlZ2V4cyA9IHBhcnNlX3JlZ2V4KGdldFNvdXAoJycsZGF0YT11cmxbMV0pKQ0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIGFkZExpbmsodXJsWzBdLCBjaGFubmVsX25hbWUsdGh1bWJuYWlsLCcnLCcnLCcnLCcnLCcnLE5vbmUscmVnZXhzLHRvdGFsKQ0KICAgICAgICAgICAgICAgIGNvbnRpbnVlDQogICAgICAgIGFkZExpbmsoc3RyZWFtX3VybCwgY2hhbm5lbF9uYW1lLHRodW1ibmFpbCwnJywnJywnJywnJywnJyxOb25lLCcnLHRvdGFsKQ0KCQkNCiAgICB4Ym1jLmV4ZWN1dGVidWlsdGluKCJDb250YWluZXIuU2V0Vmlld01vZGUoNTApIikNCgkNCmRlZiBnZXRDaGFubmVsSXRlbXMobmFtZSx1cmwsZmFuYXJ0KToNCiAgICAgICAgc291cCA9IGdldFNvdXAodXJsKQ0KICAgICAgICBjaGFubmVsX2xpc3QgPSBzb3VwLmZpbmQoJ2NoYW5uZWwnLCBhdHRycz17J25hbWUnIDogbmFtZS5kZWNvZGUoJ3V0Zi04Jyl9KQ0KICAgICAgICBpdGVtcyA9IGNoYW5uZWxfbGlzdCgnaXRlbScpDQogICAgICAgIHRyeToNCiAgICAgICAgICAgIGZhbkFydCA9IGNoYW5uZWxfbGlzdCgnZmFuYXJ0JylbMF0uc3RyaW5nDQogICAgICAgICAgICBpZiBmYW5BcnQgPT0gTm9uZToNCiAgICAgICAgICAgICAgICByYWlzZQ0KICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICBmYW5BcnQgPSBmYW5hcnQNCiAgICAgICAgZm9yIGNoYW5uZWwgaW4gY2hhbm5lbF9saXN0KCdzdWJjaGFubmVsJyk6DQogICAgICAgICAgICBuYW1lID0gY2hhbm5lbCgnbmFtZScpWzBdLnN0cmluZw0KICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgIHRodW1ibmFpbCA9IGNoYW5uZWwoJ3RodW1ibmFpbCcpWzBdLnN0cmluZw0KICAgICAgICAgICAgICAgIGlmIHRodW1ibmFpbCA9PSBOb25lOg0KICAgICAgICAgICAgICAgICAgICByYWlzZQ0KICAgICAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgICAgIHRodW1ibmFpbCA9ICcnDQogICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgaWYgbm90IGNoYW5uZWwoJ2ZhbmFydCcpOg0KICAgICAgICAgICAgICAgICAgICBpZiBhZGRvbi5nZXRTZXR0aW5nKCd1c2VfdGh1bWInKSA9PSAidHJ1ZSI6DQogICAgICAgICAgICAgICAgICAgICAgICBmYW5BcnQgPSB0aHVtYm5haWwNCiAgICAgICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgICAgICBmYW5BcnQgPSBjaGFubmVsKCdmYW5hcnQnKVswXS5zdHJpbmcNCiAgICAgICAgICAgICAgICBpZiBmYW5BcnQgPT0gTm9uZToNCiAgICAgICAgICAgICAgICAgICAgcmFpc2UNCiAgICAgICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgICAgICBwYXNzDQogICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgZGVzYyA9IGNoYW5uZWwoJ2luZm8nKVswXS5zdHJpbmcNCiAgICAgICAgICAgICAgICBpZiBkZXNjID09IE5vbmU6DQogICAgICAgICAgICAgICAgICAgIHJhaXNlDQogICAgICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICAgICAgZGVzYyA9ICcnDQoNCiAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICBnZW5yZSA9IGNoYW5uZWwoJ2dlbnJlJylbMF0uc3RyaW5nDQogICAgICAgICAgICAgICAgaWYgZ2VucmUgPT0gTm9uZToNCiAgICAgICAgICAgICAgICAgICAgcmFpc2UNCiAgICAgICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgICAgICBnZW5yZSA9ICcnDQoNCiAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICBkYXRlID0gY2hhbm5lbCgnZGF0ZScpWzBdLnN0cmluZw0KICAgICAgICAgICAgICAgIGlmIGRhdGUgPT0gTm9uZToNCiAgICAgICAgICAgICAgICAgICAgcmFpc2UNCiAgICAgICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgICAgICBkYXRlID0gJycNCg0KICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgIGNyZWRpdHMgPSBjaGFubmVsKCdjcmVkaXRzJylbMF0uc3RyaW5nDQogICAgICAgICAgICAgICAgaWYgY3JlZGl0cyA9PSBOb25lOg0KICAgICAgICAgICAgICAgICAgICByYWlzZQ0KICAgICAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgICAgIGNyZWRpdHMgPSAnJw0KDQogICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgYWRkRGlyKG5hbWUuZW5jb2RlKCd1dGYtOCcsICdpZ25vcmUnKSx1cmwuZW5jb2RlKCd1dGYtOCcpLDMsdGh1bWJuYWlsLGZhbkFydCxkZXNjLGdlbnJlLGNyZWRpdHMsZGF0ZSkNCiAgICAgICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgICAgICBhZGRvbl9sb2coJ1RoZXJlIHdhcyBhIHByb2JsZW0gYWRkaW5nIGRpcmVjdG9yeSAtICcrbmFtZS5lbmNvZGUoJ3V0Zi04JywgJ2lnbm9yZScpKQ0KICAgICAgICBnZXRJdGVtcyhpdGVtcyxmYW5BcnQpDQoNCg0KZGVmIGdldFN1YkNoYW5uZWxJdGVtcyhuYW1lLHVybCxmYW5hcnQpOg0KICAgICAgICBzb3VwID0gZ2V0U291cCh1cmwpDQogICAgICAgIGNoYW5uZWxfbGlzdCA9IHNvdXAuZmluZCgnc3ViY2hhbm5lbCcsIGF0dHJzPXsnbmFtZScgOiBuYW1lLmRlY29kZSgndXRmLTgnKX0pDQogICAgICAgIGl0ZW1zID0gY2hhbm5lbF9saXN0KCdzdWJpdGVtJykNCiAgICAgICAgZ2V0SXRlbXMoaXRlbXMsZmFuYXJ0KQ0KDQojaGFrYW1hYw0KZGVmIEdldFN1YmxpbmtzKG5hbWUsdXJsLGljb25pbWFnZSxmYW5hcnQpOg0KICAgIExpc3Q9W107IExpc3RVPVtdOyBjPTANCiAgICBhbGxfdmlkZW9zID0gcmVnZXhfZ2V0X2FsbCh1cmwsICdzdWJsaW5rOicsICcjJykNCiAgICBmb3IgYSBpbiBhbGxfdmlkZW9zOg0KICAgICAgICBpZiAnTElTVFNPVVJDRTonIGluIGE6DQogICAgICAgICAgICB2dXJsID0gcmVnZXhfZnJvbV90byhhLCAnTElTVFNPVVJDRTonLCAnOjonKQ0KICAgICAgICAgICAgbGluZW5hbWUgPSByZWdleF9mcm9tX3RvKGEsICdMSVNUTkFNRTonLCAnOjonKQ0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgdnVybCA9IGEucmVwbGFjZSgnc3VibGluazonLCcnKS5yZXBsYWNlKCcjJywnJykNCiAgICAgICAgICAgIGxpbmVuYW1lID0gbmFtZQ0KICAgICAgICBpZiBsZW4odnVybCkgPiAxMDoNCiAgICAgICAgICAgIGM9YysxOyBMaXN0LmFwcGVuZChsaW5lbmFtZSk7IExpc3RVLmFwcGVuZCh2dXJsKQ0KIA0KICAgIGlmIGM9PTE6DQogICAgICAgIHRyeToNCiAgICAgICAgICAgICNwcmludCAncGxheSAxICAgTmFtZTonICsgbmFtZSArICcgICB1cmw6JyArIExpc3RVWzBdICsgJyAgICAgJyArIHN0cihjKQ0KICAgICAgICAgICAgbGl6PXhibWNndWkuTGlzdEl0ZW0obmFtZSwgaWNvbkltYWdlPWljb25pbWFnZSx0aHVtYm5haWxJbWFnZT1pY29uaW1hZ2UpOyBsaXouc2V0SW5mbyggdHlwZT0iVmlkZW8iLCBpbmZvTGFiZWxzPXsgIlRpdGxlIjogbmFtZSB9ICkNCiAgICAgICAgICAgIG9rPXhibWNwbHVnaW4uYWRkRGlyZWN0b3J5SXRlbShoYW5kbGU9aW50KHN5cy5hcmd2WzFdKSx1cmw9TGlzdFVbMF0sbGlzdGl0ZW09bGl6KQ0KICAgICAgICAgICAgeGJtYy5QbGF5ZXIoKS5wbGF5KHVybHNvbHZlcihMaXN0VVswXSksIGxpeikNCiAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgcGFzcw0KICAgIGVsc2U6DQogICAgICAgICBkaWFsb2c9eGJtY2d1aS5EaWFsb2coKQ0KICAgICAgICAgck5vPWRpYWxvZy5zZWxlY3QoJ1NreW5ldCBTZWxlY3QgQSBTb3VyY2UnLCBMaXN0KQ0KICAgICAgICAgaWYgck5vPj0wOg0KICAgICAgICAgICAgIHJOYW1lPW5hbWUNCiAgICAgICAgICAgICByVVJMPXN0cihMaXN0VVtyTm9dKQ0KICAgICAgICAgICAgICNwcmludCAnU3VibGlua3MgICBOYW1lOicgKyBuYW1lICsgJyAgIHVybDonICsgclVSTA0KICAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICAgbGl6PXhibWNndWkuTGlzdEl0ZW0obmFtZSwgaWNvbkltYWdlPWljb25pbWFnZSx0aHVtYm5haWxJbWFnZT1pY29uaW1hZ2UpOyBsaXouc2V0SW5mbyggdHlwZT0iVmlkZW8iLCBpbmZvTGFiZWxzPXsgIlRpdGxlIjogbmFtZSB9ICkNCiAgICAgICAgICAgICAgICAgb2s9eGJtY3BsdWdpbi5hZGREaXJlY3RvcnlJdGVtKGhhbmRsZT1pbnQoc3lzLmFyZ3ZbMV0pLHVybD1yVVJMLGxpc3RpdGVtPWxpeikNCiAgICAgICAgICAgICAgICAgeGJtYy5QbGF5ZXIoKS5wbGF5KHVybHNvbHZlcihyVVJMKSwgbGl6KQ0KICAgICAgICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgICAgICAgcGFzcw0KDQoJCQkJDQpkZWYgU2VhcmNoQ2hhbm5lbHMoKToNCiNoYWthbWFjIGNvZGUNCiAgICBLZXlib2FyZE1lc3NhZ2UgPSAnTmFtZSBvZiBjaGFubmVsIHNob3cgb3IgbW92aWUnDQogICAgU2VhcmNoa2V5ID0gJycNCiAgICBrZXlib2FyZCA9IHhibWMuS2V5Ym9hcmQoU2VhcmNoa2V5LCBLZXlib2FyZE1lc3NhZ2UpDQogICAga2V5Ym9hcmQuZG9Nb2RhbCgpDQogICAgaWYga2V5Ym9hcmQuaXNDb25maXJtZWQoKToNCiAgICAgICBTZWFyY2hrZXkgPSBrZXlib2FyZC5nZXRUZXh0KCkucmVwbGFjZSgnXG4nLCcnKS5zdHJpcCgpDQogICAgICAgaWYgbGVuKFNlYXJjaGtleSkgPT0gMDogDQogICAgICAgICAgeGJtY2d1aS5EaWFsb2coKS5vaygnUm9iaW5Ib29kJywgJ05vdGhpbmcgRW50ZXJlZCcpDQogICAgICAgICAgcmV0dXJuCSAgIA0KICAgIA0KICAgIFNlYXJjaGtleSA9IFNlYXJjaGtleS5sb3dlcigpDQogICAgTGlzdD1bXQ0KICAgIExpc3QuYXBwZW5kKF9FZGl0Lk1haW5CYXNlKQ0KICAgIFBhc3NlZFVybHMgPSAwDQogICAgRm91bmRDaGFubmVsID0gMSANCiAgICBSZWFkQ2hhbm5lbCA9IDANCiAgICBGb3VuZE1hdGNoID0gMA0KICAgIHByb2dyZXNzID0geGJtY2d1aS5EaWFsb2dQcm9ncmVzcygpDQogICAgcHJvZ3Jlc3MuY3JlYXRlKCdTa3luZXQgU2VhcmNoaW5nIFBsZWFzZSB3YWl0JywnICcpDQoJDQogICAgd2hpbGUgRm91bmRDaGFubmVsIDw+IFJlYWRDaGFubmVsOg0KICAgICAgICBCYXNlU2VhcmNoID0gTGlzdFtSZWFkQ2hhbm5lbF0uc3RyaXAoKQ0KICAgICAgICBwcmludCAncmVhZCB0aGlzIG9uZSBmcm9tIGZpbGUgbGlzdCAoJyArIHN0cihSZWFkQ2hhbm5lbCkgKyAnKScgIA0KICAgICAgICBSZWFkQ2hhbm5lbCA9IFJlYWRDaGFubmVsICsgMQ0KDQogICAgICAgIFBhZ2VTb3VyY2UgPSAnJw0KICAgICAgICB0cnk6DQogICAgICAgICAgICBQYWdlU291cmNlID0gbmV0Lmh0dHBfR0VUKEJhc2VTZWFyY2gpLmNvbnRlbnQNCiAgICAgICAgICAgIFBhZ2VTb3VyY2UgPSBQYWdlU291cmNlLmVuY29kZSgnYXNjaWknLCAnaWdub3JlJykuZGVjb2RlKCdhc2NpaScpDQogICAgICAgICAgICAjdGltZS5zbGVlcCgxKQ0KICAgICAgICBleGNlcHQ6IA0KICAgICAgICAgICAgcGFzcw0KCQkNCiAgICAgICAgaWYgbGVuKFBhZ2VTb3VyY2UpIDwgMTA6DQogICAgICAgICAgICBQYWdlU291cmNlID0gJycNCiAgICAgICAgICAgIFBhc3NlZFVybHMgPSBQYXNzZWRVcmxzICsgMQ0KICAgICAgICAgICAgcHJpbnQgJyoqKiBQQVNTRUQgKioqKicgKyBCYXNlU2VhcmNoICsgJyAgKioqKioqKioqKioqKiBUb3RhbCBQYXNzZWQgVXJsczogJyArIHN0cihQYXNzZWRVcmxzKQ0KICAgICAgICAgICAgdGltZS5zbGVlcCguNSkNCiANCiAgICAgICAgcGVyY2VudCA9IGludCggKCBSZWFkQ2hhbm5lbCAvIDMwMCkgKiAxMDApIA0KICAgICAgICBtZXNzYWdlID0gJyAgICAgUGFnZXMgUmVhZDogJytzdHIoUmVhZENoYW5uZWwpKycgICAgICAgIE1hdGNoZXMgRm91bmQ6ICcgKyBzdHIoRm91bmRNYXRjaCkNCiAgICAgICAgcHJvZ3Jlc3MudXBkYXRlKHBlcmNlbnQsIiIsIG1lc3NhZ2UsICIiICkNCg0KICAgICAgICBpZiBwcm9ncmVzcy5pc2NhbmNlbGVkKCk6DQogICAgICAgICAgIHJldHVybg0KIAkJDQogICAgICAgIGlmIGxlbihQYWdlU291cmNlKSA+IDEwOg0KICAgICAgICAgICAgYWxsX2xpbmtzID0gcmVnZXhfZ2V0X2FsbChQYWdlU291cmNlLCAnPGNoYW5uZWw+JywgJzwvY2hhbm5lbD4nKQ0KICAgICAgICAgICAgZm9yIGEgaW4gYWxsX2xpbmtzOg0KICAgICAgICAgICAgICAgIHZ1cmwgPSByZWdleF9mcm9tX3RvKGEsICc8ZXh0ZXJuYWxsaW5rPicsICc8L2V4dGVybmFsbGluaz4nKQ0KICAgICAgICAgICAgICAgICNuYW1lID0gcmVnZXhfZnJvbV90byhhLCAnPG5hbWU+JywgJzwvbmFtZT4nKQ0KICAgICAgICAgICAgICAgICNwcmludCBuYW1lICsgJyAgICAnICsgdnVybA0KICAgICAgICAgICAgICAgIGlmIGxlbih2dXJsKSA+IDU6DQogICAgICAgICAgICAgICAgICAgRm91bmRDaGFubmVsID0gRm91bmRDaGFubmVsICsgMQ0KICAgICAgICAgICAgICAgICAgIExpc3QuYXBwZW5kKHZ1cmwpDQogICAgICAgICAgICAgICAgICAgI3ByaW50ICdGb3VuZCBDaGFubmVsOiAnKyBzdHIoRm91bmRDaGFubmVsKSArJyA6ICcrIHZ1cmwgDQoNCiAgICAgICAgICAgIGFsbF9pdGVtcyA9IHJlZ2V4X2dldF9hbGwoUGFnZVNvdXJjZSwgJzxpdGVtPicsICc8L2l0ZW0+JykNCiAgICAgICAgICAgIGZvciBhIGluIGFsbF9pdGVtczoNCiAgICAgICAgICAgICAgICB2dXJsID0gcmVnZXhfZnJvbV90byhhLCAnPGxpbms+JywgJzwvbGluaz4nKQ0KICAgICAgICAgICAgICAgIG5hbWUgPSByZWdleF9mcm9tX3RvKGEsICc8dGl0bGU+JywgJzwvdGl0bGU+JykNCiAgICAgICAgICAgICAgICBUZXN0TmFtZSA9ICcgICcgKyBuYW1lLmxvd2VyKCkgKyAnICAnDQogICAgICAgICAgICAgICAgI3ByaW50ICdUZXN0aW5nOicgKyBUZXN0TmFtZSArICcgICcgKyBTZWFyY2hrZXkNCiAgICAgICAgICAgICAgICBpZiBsZW4odnVybCkgPiA1IGFuZCBUZXN0TmFtZS5maW5kKFNlYXJjaGtleSkgPiAwOg0KICAgICAgICAgICAgICAgICAgICBGb3VuZE1hdGNoID0gRm91bmRNYXRjaCArIDENCiAgICAgICAgICAgICAgICAgICAgZmFuYXJ0ID0gJycNCiAgICAgICAgICAgICAgICAgICAgdGh1bWJuYWlsID0gcmVnZXhfZnJvbV90byhhLCAnPHRodW1ibmFpbD4nLCAnPC90aHVtYm5haWw+JykNCiAgICAgICAgICAgICAgICAgICAgZmFuYXJ0ID0gcmVnZXhfZnJvbV90byhhLCAnPGZhbmFydD4nLCAnPC9mYW5hcnQ+JykNCiAgICAgICAgICAgICAgICAgICAgaWYgbGVuKGZhbmFydCkgPCA1Og0KICAgICAgICAgICAgICAgICAgICAgICBmYW5hcnQgPSBpY29uDQogICAgICAgICAgICAgICAgICAgIGlmIHZ1cmwuZmluZCgnc3VibGluaycpID4gMDoNCiAgICAgICAgICAgICAgICAgICAgICAgIGFkZERpcihuYW1lLHZ1cmwsMzAsdGh1bWJuYWlsLGZhbmFydCwnJywnJywnJywnJykNCiAgICAgICAgICAgICAgICAgICAgZWxzZTogDQogICAgICAgICAgICAgICAgICAgICAgICBhZGRMaW5rKHN0cih2dXJsKSxuYW1lLHRodW1ibmFpbCxmYW5hcnQsJycsJycsJycsVHJ1ZSxOb25lLCcnLDEpDQoJCQkJCQkNCiAgICANCiAgICBwcm9ncmVzcy5jbG9zZSgpDQogICAgeGJtYy5leGVjdXRlYnVpbHRpbigiQ29udGFpbmVyLlNldFZpZXdNb2RlKDUwKSIpDQoJDQpkZWYgU2VhcmNoX20zdShkYXRhLFNlYXJjaGtleSk6DQogICAgY29udGVudCA9IGRhdGEucnN0cmlwKCkNCiAgICBtYXRjaCA9IHJlLmNvbXBpbGUocicjRVhUSU5GOiguKz8pLCguKj8pW1xuXHJdKyhbXlxuXSspJykuZmluZGFsbChjb250ZW50KQ0KICAgIHRvdGFsID0gbGVuKG1hdGNoKQ0KICAgIHByaW50ICd0b3RhbCBtM3UgbGlua3MnLHRvdGFsDQogICAgZm9yIG90aGVyLGNoYW5uZWxfbmFtZSxzdHJlYW1fdXJsIGluIG1hdGNoOg0KICAgICAgICBpZiAndHZnLWxvZ28nIGluIG90aGVyOg0KICAgICAgICAgICAgdGh1bWJuYWlsID0gcmVfbWUob3RoZXIsJ3R2Zy1sb2dvPVtcJyJdKC4qPylbXCciXScpDQogICAgICAgICAgICBpZiB0aHVtYm5haWw6DQogICAgICAgICAgICAgICAgaWYgdGh1bWJuYWlsLnN0YXJ0c3dpdGgoJ2h0dHAnKToNCiAgICAgICAgICAgICAgICAgICAgdGh1bWJuYWlsID0gdGh1bWJuYWlsDQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgZWxpZiBub3QgYWRkb24uZ2V0U2V0dGluZygnbG9nby1mb2xkZXJQYXRoJykgPT0gIiI6DQogICAgICAgICAgICAgICAgICAgIGxvZ29fdXJsID0gYWRkb24uZ2V0U2V0dGluZygnbG9nby1mb2xkZXJQYXRoJykNCiAgICAgICAgICAgICAgICAgICAgdGh1bWJuYWlsID0gbG9nb191cmwgKyB0aHVtYm5haWwNCg0KICAgICAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgICAgIHRodW1ibmFpbCA9IHRodW1ibmFpbA0KICAgICAgICAgICAgI2Vsc2U6DQogICAgICAgICAgICANCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHRodW1ibmFpbCA9ICcnDQogICAgICAgIGlmICd0eXBlJyBpbiBvdGhlcjoNCiAgICAgICAgICAgIG1vZGVfdHlwZSA9IHJlX21lKG90aGVyLCd0eXBlPVtcJyJdKC4qPylbXCciXScpDQogICAgICAgICAgICBpZiBtb2RlX3R5cGUgPT0gJ3l0LWRsJzoNCiAgICAgICAgICAgICAgICBzdHJlYW1fdXJsID0gc3RyZWFtX3VybCArIiZtb2RlPTE4Ig0KICAgICAgICAgICAgZWxpZiBtb2RlX3R5cGUgPT0gJ3JlZ2V4JzoNCiAgICAgICAgICAgICAgICB1cmwgPSBzdHJlYW1fdXJsLnNwbGl0KCcmcmVnZXhzPScpDQogICAgICAgICAgICAgICAgI3ByaW50IHVybFswXSBnZXRTb3VwKHVybCxkYXRhPU5vbmUpDQogICAgICAgICAgICAgICAgcmVnZXhzID0gcGFyc2VfcmVnZXgoZ2V0U291cCgnJyxkYXRhPXVybFsxXSkpDQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgYWRkTGluayh1cmxbMF0sIGNoYW5uZWxfbmFtZSx0aHVtYm5haWwsJycsJycsJycsJycsJycsTm9uZSxyZWdleHMsdG90YWwpDQogICAgICAgICAgICAgICAgY29udGludWUNCiAgICAgICAgYWRkTGluayhzdHJlYW1fdXJsLCBjaGFubmVsX25hbWUsdGh1bWJuYWlsLCcnLCcnLCcnLCcnLCcnLE5vbmUsJycsdG90YWwpDQoNCmRlZiBGaW5kRmlyc3RQYXR0ZXJuKHRleHQscGF0dGVybik6DQogICAgcmVzdWx0ID0gIiINCiAgICB0cnk6ICAgIA0KICAgICAgICBtYXRjaGVzID0gcmUuZmluZGFsbChwYXR0ZXJuLHRleHQsIGZsYWdzPXJlLkRPVEFMTCkNCiAgICAgICAgcmVzdWx0ID0gbWF0Y2hlc1swXQ0KICAgIGV4Y2VwdDoNCiAgICAgICAgcmVzdWx0ID0gIiINCg0KICAgIHJldHVybiByZXN1bHQNCgkNCmRlZiByZWdleF9nZXRfYWxsKHRleHQsIHN0YXJ0X3dpdGgsIGVuZF93aXRoKToNCiAgICByID0gcmUuZmluZGFsbCgiKD9pKSgiICsgc3RhcnRfd2l0aCArICJbXFNcc10rPyIgKyBlbmRfd2l0aCArICIpIiwgdGV4dCkNCiAgICByZXR1cm4gcgkJCQkNCg0KZGVmIHJlZ2V4X2Zyb21fdG8odGV4dCwgZnJvbV9zdHJpbmcsIHRvX3N0cmluZywgZXhjbHVkaW5nPVRydWUpOg0KICAgIGlmIGV4Y2x1ZGluZzoNCgkgICB0cnk6IHIgPSByZS5zZWFyY2goIig/aSkiICsgZnJvbV9zdHJpbmcgKyAiKFtcU1xzXSs/KSIgKyB0b19zdHJpbmcsIHRleHQpLmdyb3VwKDEpDQoJICAgZXhjZXB0OiByID0gJycNCiAgICBlbHNlOg0KICAgICAgIHRyeTogciA9IHJlLnNlYXJjaCgiKD9pKSgiICsgZnJvbV9zdHJpbmcgKyAiW1xTXHNdKz8iICsgdG9fc3RyaW5nICsgIikiLCB0ZXh0KS5ncm91cCgxKQ0KICAgICAgIGV4Y2VwdDogciA9ICcnDQogICAgcmV0dXJuIHINCg0KZGVmIGdldEl0ZW1zKGl0ZW1zLGZhbmFydCk6DQogICAgICAgIHRvdGFsID0gbGVuKGl0ZW1zKQ0KICAgICAgICBwcmludCAnU1RBUlQgR0VUIElURU1TICoqKioqJw0KICAgICAgICBhZGRvbl9sb2coJ1RvdGFsIEl0ZW1zOiAlcycgJXRvdGFsKQ0KICAgICAgICBmb3IgaXRlbSBpbiBpdGVtczoNCiAgICAgICAgICAgIGlzWE1MU291cmNlPUZhbHNlDQogICAgICAgICAgICBpc0pzb25ycGMgPSBGYWxzZQ0KICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgIG5hbWUgPSBpdGVtKCd0aXRsZScpWzBdLnN0cmluZw0KICAgICAgICAgICAgICAgIGlmIG5hbWUgaXMgTm9uZToNCiAgICAgICAgICAgICAgICAgICAgbmFtZSA9ICd1bmtub3duPycNCiAgICAgICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgICAgICBhZGRvbl9sb2coJ05hbWUgRXJyb3InKQ0KICAgICAgICAgICAgICAgIG5hbWUgPSAnJw0KDQoNCiAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICBpZiBpdGVtKCdlcGcnKToNCiAgICAgICAgICAgICAgICAgICAgaWYgaXRlbS5lcGdfdXJsOg0KICAgICAgICAgICAgICAgICAgICAgICAgYWRkb25fbG9nKCdHZXQgRVBHIFJlZ2V4JykNCiAgICAgICAgICAgICAgICAgICAgICAgIGVwZ191cmwgPSBpdGVtLmVwZ191cmwuc3RyaW5nDQogICAgICAgICAgICAgICAgICAgICAgICBlcGdfcmVnZXggPSBpdGVtLmVwZ19yZWdleC5zdHJpbmcNCiAgICAgICAgICAgICAgICAgICAgICAgIGVwZ19uYW1lID0gZ2V0X2VwZyhlcGdfdXJsLCBlcGdfcmVnZXgpDQogICAgICAgICAgICAgICAgICAgICAgICBpZiBlcGdfbmFtZToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lICs9ICcgLSAnICsgZXBnX25hbWUNCiAgICAgICAgICAgICAgICAgICAgZWxpZiBpdGVtKCdlcGcnKVswXS5zdHJpbmcgPiAxOg0KICAgICAgICAgICAgICAgICAgICAgICAgbmFtZSArPSBnZXRlcGcoaXRlbSgnZXBnJylbMF0uc3RyaW5nKQ0KICAgICAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgICAgIHBhc3MNCiAgICAgICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgICAgICBhZGRvbl9sb2coJ0VQRyBFcnJvcicpDQogICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgdXJsID0gW10NCiAgICAgICAgICAgICAgICBpZiBsZW4oaXRlbSgnbGluaycpKSA+MDoNCiMgICAgICAgICAgICAgICAgICAgIHByaW50ICdpdGVtIGxpbmsnLCBpdGVtKCdsaW5rJykNCiAgICAgICAgICAgICAgICAgICAgZm9yIGkgaW4gaXRlbSgnbGluaycpOg0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IGkuc3RyaW5nID09IE5vbmU6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdXJsLmFwcGVuZChpLnN0cmluZykNCiAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgZWxpZiBsZW4oaXRlbSgnc3BvcnRzZGV2aWwnKSkgPjA6DQogICAgICAgICAgICAgICAgICAgIGZvciBpIGluIGl0ZW0oJ3Nwb3J0c2RldmlsJyk6DQogICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgaS5zdHJpbmcgPT0gTm9uZToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzcG9ydHNkZXZpbCA9ICdwbHVnaW46Ly9wbHVnaW4udmlkZW8uU3BvcnRzRGV2aWwvP21vZGU9MSZhbXA7aXRlbT1jYXRjaGVyJTNkc3RyZWFtcyUyNnVybD0nICtpLnN0cmluZw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZmVyZXIgPSBpdGVtKCdyZWZlcmVyJylbMF0uc3RyaW5nDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgcmVmZXJlcjoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgI3ByaW50ICdyZWZlcmVyIGZvdW5kJw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzcG9ydHNkZXZpbCA9IHNwb3J0c2RldmlsICsgJyUyNnJlZmVyZXI9JyArcmVmZXJlcg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVybC5hcHBlbmQoc3BvcnRzZGV2aWwpDQogICAgICAgICAgICAgICAgZWxpZiBsZW4oaXRlbSgncDJwJykpID4wOg0KICAgICAgICAgICAgICAgICAgICBmb3IgaSBpbiBpdGVtKCdwMnAnKToNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBpLnN0cmluZyA9PSBOb25lOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICdzb3A6Ly8nIGluIGk6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNvcCA9ICdwbHVnaW46Ly9wbHVnaW4udmlkZW8ucDJwLXN0cmVhbXMvP3VybD0nK2kuc3RyaW5nICsnJmFtcDttb2RlPTImYW1wOycgKyAnbmFtZT0nK25hbWUgDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVybC5hcHBlbmQoc29wKSANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwMnA9J3BsdWdpbjovL3BsdWdpbi52aWRlby5wMnAtc3RyZWFtcy8/dXJsPScraS5zdHJpbmcgKycmYW1wO21vZGU9MSZhbXA7JyArICduYW1lPScrbmFtZSANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXJsLmFwcGVuZChwMnApDQogICAgICAgICAgICAgICAgZWxpZiBsZW4oaXRlbSgndmF1Z2huJykpID4wOg0KICAgICAgICAgICAgICAgICAgICBmb3IgaSBpbiBpdGVtKCd2YXVnaG4nKToNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBpLnN0cmluZyA9PSBOb25lOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhdWdobiA9ICdwbHVnaW46Ly9wbHVnaW4uc3RyZWFtLnZhdWdobmxpdmUudHYvP21vZGU9UGxheUxpdmVTdHJlYW0mYW1wO2NoYW5uZWw9JytpLnN0cmluZw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVybC5hcHBlbmQodmF1Z2huKQ0KICAgICAgICAgICAgICAgIGVsaWYgbGVuKGl0ZW0oJ2lsaXZlJykpID4wOg0KICAgICAgICAgICAgICAgICAgICBmb3IgaSBpbiBpdGVtKCdpbGl2ZScpOg0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IGkuc3RyaW5nID09IE5vbmU6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90ICdodHRwJyBpbiBpLnN0cmluZzoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWxpdmUgPSAncGx1Z2luOi8vcGx1Z2luLnZpZGVvLnRiaC5pbGl2ZS8/dXJsPWh0dHA6Ly93d3cuc3RyZWFtbGl2ZS50by92aWV3LycraS5zdHJpbmcrJyZhbXA7bGluaz05OSZhbXA7bW9kZT1pTGl2ZVBsYXknDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWxpdmUgPSAncGx1Z2luOi8vcGx1Z2luLnZpZGVvLnRiaC5pbGl2ZS8/dXJsPScraS5zdHJpbmcrJyZhbXA7bGluaz05OSZhbXA7bW9kZT1pTGl2ZVBsYXknDQogICAgICAgICAgICAgICAgZWxpZiBsZW4oaXRlbSgneXQtZGwnKSkgPjA6DQogICAgICAgICAgICAgICAgICAgIGZvciBpIGluIGl0ZW0oJ3l0LWRsJyk6DQogICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgaS5zdHJpbmcgPT0gTm9uZToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB5dGRsID0gaS5zdHJpbmcgKyAnJm1vZGU9MTgnDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdXJsLmFwcGVuZCh5dGRsKQ0KICAgICAgICAgICAgICAgIGVsaWYgbGVuKGl0ZW0oJ3V0dWJlJykpID4wOg0KICAgICAgICAgICAgICAgICAgICBmb3IgaSBpbiBpdGVtKCd1dHViZScpOg0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IGkuc3RyaW5nID09IE5vbmU6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgbGVuKGkuc3RyaW5nKSA9PSAxMToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXR1YmUgPSAncGx1Z2luOi8vcGx1Z2luLnZpZGVvLnlvdXR1YmUvcGxheS8/dmlkZW9faWQ9JysgaS5zdHJpbmcgDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxpZiBpLnN0cmluZy5zdGFydHN3aXRoKCdQTCcpIGFuZCBub3QgJyZvcmRlcj0nIGluIGkuc3RyaW5nIDoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXR1YmUgPSAncGx1Z2luOi8vcGx1Z2luLnZpZGVvLnlvdXR1YmUvcGxheS8/Jm9yZGVyPWRlZmF1bHQmcGxheWxpc3RfaWQ9JyArIGkuc3RyaW5nDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXR1YmUgPSAncGx1Z2luOi8vcGx1Z2luLnZpZGVvLnlvdXR1YmUvcGxheS8/cGxheWxpc3RfaWQ9JyArIGkuc3RyaW5nIA0KICAgICAgICAgICAgICAgICAgICB1cmwuYXBwZW5kKHV0dWJlKQ0KICAgICAgICAgICAgICAgIGVsaWYgbGVuKGl0ZW0oJ2ltZGInKSkgPjA6DQogICAgICAgICAgICAgICAgICAgIGZvciBpIGluIGl0ZW0oJ2ltZGInKToNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBpLnN0cmluZyA9PSBOb25lOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGFkZG9uLmdldFNldHRpbmcoJ2dlbmVzaXNvcnB1bHNhcicpID09ICcwJzoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW1kYiA9ICdwbHVnaW46Ly9wbHVnaW4udmlkZW8uZ2VuZXNpcy8/YWN0aW9uPXBsYXkmaW1kYj0nK2kuc3RyaW5nDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW1kYiA9ICdwbHVnaW46Ly9wbHVnaW4udmlkZW8ucHVsc2FyL21vdmllL3R0JytpLnN0cmluZysnL3BsYXknDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdXJsLmFwcGVuZChpbWRiKSAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICBlbGlmIGxlbihpdGVtKCdmNG0nKSkgPjA6DQogICAgICAgICAgICAgICAgICAgICAgICBmb3IgaSBpbiBpdGVtKCdmNG0nKToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgaS5zdHJpbmcgPT0gTm9uZToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgJy5mNG0nIGluIGkuc3RyaW5nOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZjRtID0gJ3BsdWdpbjovL3BsdWdpbi52aWRlby5mNG1UZXN0ZXIvP3VybD0nK3VybGxpYi5xdW90ZV9wbHVzKGkuc3RyaW5nKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbGlmICcubTN1OCcgaW4gaS5zdHJpbmc6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmNG0gPSAncGx1Z2luOi8vcGx1Z2luLnZpZGVvLmY0bVRlc3Rlci8/dXJsPScrdXJsbGliLnF1b3RlX3BsdXMoaS5zdHJpbmcpKycmYW1wO3N0cmVhbXR5cGU9SExTJw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmNG0gPSAncGx1Z2luOi8vcGx1Z2luLnZpZGVvLmY0bVRlc3Rlci8/dXJsPScrdXJsbGliLnF1b3RlX3BsdXMoaS5zdHJpbmcpKycmYW1wO3N0cmVhbXR5cGU9U0lNUExFJw0KICAgICAgICAgICAgICAgICAgICAgICAgdXJsLmFwcGVuZChmNG0pDQogICAgICAgICAgICAgICAgZWxpZiBsZW4oaXRlbSgnZnR2JykpID4wOg0KICAgICAgICAgICAgICAgICAgICBmb3IgaSBpbiBpdGVtKCdmdHYnKToNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBpLnN0cmluZyA9PSBOb25lOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ0diA9ICdwbHVnaW46Ly9wbHVnaW4udmlkZW8uRi5ULlYvP25hbWU9Jyt1cmxsaWIucXVvdGUobmFtZSkgKycmdXJsPScgK2kuc3RyaW5nICsnJm1vZGU9MTI1JmNoX2ZhbmFydD1uYScNCiAgICAgICAgICAgICAgICAgICAgICAgIHVybC5hcHBlbmQoZnR2KSAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIGlmIGxlbih1cmwpIDwgMToNCiAgICAgICAgICAgICAgICAgICAgcmFpc2UNCiAgICAgICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgICAgICBhZGRvbl9sb2coJ0Vycm9yIDxsaW5rPiBlbGVtZW50LCBQYXNzaW5nOicrbmFtZS5lbmNvZGUoJ3V0Zi04JywgJ2lnbm9yZScpKQ0KICAgICAgICAgICAgICAgIGNvbnRpbnVlDQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICBpc1hNTFNvdXJjZT1GYWxzZQ0KDQogICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgaXNYTUxTb3VyY2UgPSBpdGVtKCdleHRlcm5hbGxpbmsnKVswXS5zdHJpbmcNCiAgICAgICAgICAgIGV4Y2VwdDogcGFzcw0KICAgICAgICAgICAgDQogICAgICAgICAgICBpZiBpc1hNTFNvdXJjZToNCiAgICAgICAgICAgICAgICBleHRfdXJsPVtpc1hNTFNvdXJjZV0NCiAgICAgICAgICAgICAgICBpc1hNTFNvdXJjZT1UcnVlDQogICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgIGlzWE1MU291cmNlPUZhbHNlDQogICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgaXNKc29ucnBjID0gaXRlbSgnanNvbnJwYycpWzBdLnN0cmluZw0KICAgICAgICAgICAgZXhjZXB0OiBwYXNzDQogICAgICAgICAgICBpZiBpc0pzb25ycGM6DQogICAgICAgICAgICAgICAgZXh0X3VybD1baXNKc29ucnBjXQ0KICAgICAgICAgICAgICAgIGlzSnNvbnJwYz1UcnVlDQogICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgIGlzSnNvbnJwYz1GYWxzZSAgICAgICAgICAgIA0KICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgIHRodW1ibmFpbCA9IGl0ZW0oJ3RodW1ibmFpbCcpWzBdLnN0cmluZw0KICAgICAgICAgICAgICAgIGlmIHRodW1ibmFpbCA9PSBOb25lOg0KICAgICAgICAgICAgICAgICAgICByYWlzZQ0KICAgICAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgICAgIHRodW1ibmFpbCA9ICcnDQogICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgaWYgbm90IGl0ZW0oJ2ZhbmFydCcpOg0KICAgICAgICAgICAgICAgICAgICBpZiBhZGRvbi5nZXRTZXR0aW5nKCd1c2VfdGh1bWInKSA9PSAidHJ1ZSI6DQogICAgICAgICAgICAgICAgICAgICAgICBmYW5BcnQgPSB0aHVtYm5haWwNCiAgICAgICAgICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICAgICAgICAgIGZhbkFydCA9IGZhbmFydA0KICAgICAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgICAgIGZhbkFydCA9IGl0ZW0oJ2ZhbmFydCcpWzBdLnN0cmluZw0KICAgICAgICAgICAgICAgIGlmIGZhbkFydCA9PSBOb25lOg0KICAgICAgICAgICAgICAgICAgICByYWlzZQ0KICAgICAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgICAgIGZhbkFydCA9IGZhbmFydA0KICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgIGRlc2MgPSBpdGVtKCdpbmZvJylbMF0uc3RyaW5nDQogICAgICAgICAgICAgICAgaWYgZGVzYyA9PSBOb25lOg0KICAgICAgICAgICAgICAgICAgICByYWlzZQ0KICAgICAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgICAgIGRlc2MgPSAnJw0KDQogICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgZ2VucmUgPSBpdGVtKCdnZW5yZScpWzBdLnN0cmluZw0KICAgICAgICAgICAgICAgIGlmIGdlbnJlID09IE5vbmU6DQogICAgICAgICAgICAgICAgICAgIHJhaXNlDQogICAgICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICAgICAgZ2VucmUgPSAnJw0KDQogICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgZGF0ZSA9IGl0ZW0oJ2RhdGUnKVswXS5zdHJpbmcNCiAgICAgICAgICAgICAgICBpZiBkYXRlID09IE5vbmU6DQogICAgICAgICAgICAgICAgICAgIHJhaXNlDQogICAgICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICAgICAgZGF0ZSA9ICcnDQoNCiAgICAgICAgICAgIHJlZ2V4cyA9IE5vbmUNCiAgICAgICAgICAgIGlmIGl0ZW0oJ3JlZ2V4Jyk6DQogICAgICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgICAgICByZWdfaXRlbSA9IGl0ZW0oJ3JlZ2V4JykNCiAgICAgICAgICAgICAgICAgICAgcmVnZXhzID0gcGFyc2VfcmVnZXgocmVnX2l0ZW0pDQogICAgICAgICAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgICAgICAgICBwYXNzICAgICAgICAgICAgDQogICAgICAgICAgIA0KICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgIGlmIGxlbih1cmwpID4gMToNCiAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIGFsdCA9IDANCiAgICAgICAgICAgICAgICAgICAgcGxheWxpc3QgPSBbXQ0KICAgICAgICAgICAgICAgICAgICBmb3IgaSBpbiB1cmw6DQogICAgICAgICAgICAgICAgICAgIAlpZiBhZGRvbi5nZXRTZXR0aW5nKCdhc2tfcGxheWxpc3RfaXRlbXMnKSA9PSAndHJ1ZSc6DQoJICAgICAgICAgICAgICAgICAgICAgICAgaWYgcmVnZXhzOg0KCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBwbGF5bGlzdC5hcHBlbmQoaSsnJnJlZ2V4cz0nK3JlZ2V4cykNCgkgICAgICAgICAgICAgICAgICAgICAgICBlbGlmICBhbnkoeCBpbiBpIGZvciB4IGluIHJlc29sdmVfdXJsKSBhbmQgIGkuc3RhcnRzd2l0aCgnaHR0cCcpOg0KCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBwbGF5bGlzdC5hcHBlbmQoaSsnJm1vZGU9MTknKSAgICAgICAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcGxheWxpc3QuYXBwZW5kKGkpDQogICAgICAgICAgICAgICAgICAgIGlmIGFkZG9uLmdldFNldHRpbmcoJ2FkZF9wbGF5bGlzdCcpID09ICJmYWxzZSI6ICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgaSBpbiB1cmw6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFsdCArPSAxDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByaW50ICdBRERMSU5LIDEnDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZExpbmsoaSwnJXMpICVzJyAlKGFsdCwgbmFtZS5lbmNvZGUoJ3V0Zi04JywgJ2lnbm9yZScpKSx0aHVtYm5haWwsZmFuQXJ0LGRlc2MsZ2VucmUsZGF0ZSxUcnVlLHBsYXlsaXN0LHJlZ2V4cyx0b3RhbCkgICAgICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgICAgICAgICBhZGRMaW5rKCcnLCBuYW1lLmVuY29kZSgndXRmLTgnLCAnaWdub3JlJyksdGh1bWJuYWlsLGZhbkFydCxkZXNjLGdlbnJlLGRhdGUsVHJ1ZSxwbGF5bGlzdCxyZWdleHMsdG90YWwpDQogICAgICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICAgICAgaWYgaXNYTUxTb3VyY2U6DQogICAgICAgICAgICAgICAgICAgIAlhZGREaXIobmFtZS5lbmNvZGUoJ3V0Zi04JyksZXh0X3VybFswXS5lbmNvZGUoJ3V0Zi04JyksMSx0aHVtYm5haWwsZmFuYXJ0LGRlc2MsZ2VucmUsZGF0ZSxOb25lLCdzb3VyY2UnKQ0KICAgICAgICAgICAgICAgICAgICBlbGlmIGlzSnNvbnJwYzoNCiAgICAgICAgICAgICAgICAgICAgICAgIGFkZERpcihuYW1lLmVuY29kZSgndXRmLTgnKSxleHRfdXJsWzBdLDUzLHRodW1ibmFpbCxmYW5hcnQsZGVzYyxnZW5yZSxkYXRlLE5vbmUsJ3NvdXJjZScpDQogICAgICAgICAgICAgICAgICAgIGVsaWYgdXJsWzBdLmZpbmQoJ3N1YmxpbmsnKSA+IDA6DQogICAgICAgICAgICAgICAgICAgICAgICBhZGREaXIobmFtZS5lbmNvZGUoJ3V0Zi04JyksdXJsWzBdLDMwLHRodW1ibmFpbCxmYW5hcnQsJycsJycsJycsJycpDQogICAgICAgICAgICAgICAgICAgICAgICAjYWRkRGlyKG5hbWUuZW5jb2RlKCd1dGYtOCcpLHVybFswXSwzMCx0aHVtYm5haWwsZmFuYXJ0LGRlc2MsZ2VucmUsZGF0ZSwnc3VibGluaycpCQkJCQ0KICAgICAgICAgICAgICAgICAgICBlbHNlOiANCiAgICAgICAgICAgICAgICAgICAgICAgIGFkZExpbmsodXJsWzBdLG5hbWUuZW5jb2RlKCd1dGYtOCcsICdpZ25vcmUnKSx0aHVtYm5haWwsZmFuQXJ0LGRlc2MsZ2VucmUsZGF0ZSxUcnVlLE5vbmUscmVnZXhzLHRvdGFsKQ0KDQogICAgICAgICAgICAgICAgICAgICNwcmludCAnc3VjY2VzcycNCiAgICAgICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgICAgICBhZGRvbl9sb2coJ1RoZXJlIHdhcyBhIHByb2JsZW0gYWRkaW5nIGl0ZW0gLSAnK25hbWUuZW5jb2RlKCd1dGYtOCcsICdpZ25vcmUnKSkNCiAgICAgICAgcHJpbnQgJ0ZJTklTSCBHRVQgSVRFTVMgKioqKionICAgICAgDQoNCmRlZiBwYXJzZV9yZWdleChyZWdfaXRlbSk6DQogICAgICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgICAgICByZWdleHMgPSB7fQ0KICAgICAgICAgICAgICAgICAgICBmb3IgaSBpbiByZWdfaXRlbToNCiAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2V4c1tpKCduYW1lJylbMF0uc3RyaW5nXSA9IHt9DQogICAgICAgICAgICAgICAgICAgICAgICAjcmVnZXhzW2koJ25hbWUnKVswXS5zdHJpbmddWydleHByZSddID0gaSgnZXhwcmVzJylbMF0uc3RyaW5nDQogICAgICAgICAgICAgICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVnZXhzW2koJ25hbWUnKVswXS5zdHJpbmddWydleHByZSddID0gaSgnZXhwcmVzJylbMF0uc3RyaW5nDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IHJlZ2V4c1tpKCduYW1lJylbMF0uc3RyaW5nXVsnZXhwcmUnXToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVnZXhzW2koJ25hbWUnKVswXS5zdHJpbmddWydleHByZSddPScnDQogICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkb25fbG9nKCJSZWdleDogLS0gTm8gUmVmZXJlciAtLSIpDQogICAgICAgICAgICAgICAgICAgICAgICByZWdleHNbaSgnbmFtZScpWzBdLnN0cmluZ11bJ3BhZ2UnXSA9IGkoJ3BhZ2UnKVswXS5zdHJpbmcNCiAgICAgICAgICAgICAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWdleHNbaSgnbmFtZScpWzBdLnN0cmluZ11bJ3JlZmVyJ10gPSBpKCdyZWZlcmVyJylbMF0uc3RyaW5nDQogICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkb25fbG9nKCJSZWdleDogLS0gTm8gUmVmZXJlciAtLSIpDQogICAgICAgICAgICAgICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVnZXhzW2koJ25hbWUnKVswXS5zdHJpbmddWydjb25uZWN0aW9uJ10gPSBpKCdjb25uZWN0aW9uJylbMF0uc3RyaW5nDQogICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkb25fbG9nKCJSZWdleDogLS0gTm8gY29ubmVjdGlvbiAtLSIpDQoNCiAgICAgICAgICAgICAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWdleHNbaSgnbmFtZScpWzBdLnN0cmluZ11bJ25vdHBsYXlhYmxlJ10gPSBpKCdub3RwbGF5YWJsZScpWzBdLnN0cmluZw0KICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZG9uX2xvZygiUmVnZXg6IC0tIE5vIG5vdHBsYXlhYmxlIC0tIikNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWdleHNbaSgnbmFtZScpWzBdLnN0cmluZ11bJ25vcmVkaXJlY3QnXSA9IGkoJ25vcmVkaXJlY3QnKVswXS5zdHJpbmcNCiAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGRvbl9sb2coIlJlZ2V4OiAtLSBObyBub3JlZGlyZWN0IC0tIikNCiAgICAgICAgICAgICAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWdleHNbaSgnbmFtZScpWzBdLnN0cmluZ11bJ29yaWdpbiddID0gaSgnb3JpZ2luJylbMF0uc3RyaW5nDQogICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkb25fbG9nKCJSZWdleDogLS0gTm8gb3JpZ2luIC0tIikNCiAgICAgICAgICAgICAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWdleHNbaSgnbmFtZScpWzBdLnN0cmluZ11bJ2luY2x1ZGVoZWFkZXJzJ10gPSBpKCdpbmNsdWRlaGVhZGVycycpWzBdLnN0cmluZw0KICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZG9uX2xvZygiUmVnZXg6IC0tIE5vIGluY2x1ZGVoZWFkZXJzIC0tIikgICAgICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVnZXhzW2koJ25hbWUnKVswXS5zdHJpbmddWyd4LXJlcSddID0gaSgneC1yZXEnKVswXS5zdHJpbmcNCiAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGRvbl9sb2coIlJlZ2V4OiAtLSBObyB4LXJlcSAtLSIpDQogICAgICAgICAgICAgICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVnZXhzW2koJ25hbWUnKVswXS5zdHJpbmddWyd4LWZvcndhcmQnXSA9IGkoJ3gtZm9yd2FyZCcpWzBdLnN0cmluZw0KICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZG9uX2xvZygiUmVnZXg6IC0tIE5vIHgtZm9yd2FyZCAtLSIpDQoNCiAgICAgICAgICAgICAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWdleHNbaSgnbmFtZScpWzBdLnN0cmluZ11bJ2FnZW50J10gPSBpKCdhZ2VudCcpWzBdLnN0cmluZw0KICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZG9uX2xvZygiUmVnZXg6IC0tIE5vIFVzZXIgQWdlbnQgLS0iKQ0KICAgICAgICAgICAgICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2V4c1tpKCduYW1lJylbMF0uc3RyaW5nXVsncG9zdCddID0gaSgncG9zdCcpWzBdLnN0cmluZw0KICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZG9uX2xvZygiUmVnZXg6IC0tIE5vdCBhIHBvc3QiKQ0KICAgICAgICAgICAgICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2V4c1tpKCduYW1lJylbMF0uc3RyaW5nXVsncmF3cG9zdCddID0gaSgncmF3cG9zdCcpWzBdLnN0cmluZw0KICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZG9uX2xvZygiUmVnZXg6IC0tIE5vdCBhIHJhd3Bvc3QiKQ0KICAgICAgICAgICAgICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2V4c1tpKCduYW1lJylbMF0uc3RyaW5nXVsnaHRtbHVuZXNjYXBlJ10gPSBpKCdodG1sdW5lc2NhcGUnKVswXS5zdHJpbmcNCiAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGRvbl9sb2coIlJlZ2V4OiAtLSBOb3QgYSBodG1sdW5lc2NhcGUiKQ0KDQoNCiAgICAgICAgICAgICAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWdleHNbaSgnbmFtZScpWzBdLnN0cmluZ11bJ3JlYWRjb29raWVvbmx5J10gPSBpKCdyZWFkY29va2llb25seScpWzBdLnN0cmluZw0KICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZG9uX2xvZygiUmVnZXg6IC0tIE5vdCBhIHJlYWRDb29raWVPbmx5IikNCiAgICAgICAgICAgICAgICAgICAgICAgICNwcmludCBpDQogICAgICAgICAgICAgICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVnZXhzW2koJ25hbWUnKVswXS5zdHJpbmddWydjb29raWVqYXInXSA9IGkoJ2Nvb2tpZWphcicpWzBdLnN0cmluZw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCByZWdleHNbaSgnbmFtZScpWzBdLnN0cmluZ11bJ2Nvb2tpZWphciddOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWdleHNbaSgnbmFtZScpWzBdLnN0cmluZ11bJ2Nvb2tpZWphciddPScnDQogICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkb25fbG9nKCJSZWdleDogLS0gTm90IGEgY29va2llSmFyIikJCQkJCQkJDQogICAgICAgICAgICAgICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVnZXhzW2koJ25hbWUnKVswXS5zdHJpbmddWydzZXRjb29raWUnXSA9IGkoJ3NldGNvb2tpZScpWzBdLnN0cmluZw0KICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZG9uX2xvZygiUmVnZXg6IC0tIE5vdCBhIHNldGNvb2tpZSIpDQogICAgICAgICAgICAgICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVnZXhzW2koJ25hbWUnKVswXS5zdHJpbmddWydhcHBlbmRjb29raWUnXSA9IGkoJ2FwcGVuZGNvb2tpZScpWzBdLnN0cmluZw0KICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZG9uX2xvZygiUmVnZXg6IC0tIE5vdCBhIGFwcGVuZGNvb2tpZSIpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVnZXhzW2koJ25hbWUnKVswXS5zdHJpbmddWydpZ25vcmVjYWNoZSddID0gaSgnaWdub3JlY2FjaGUnKVswXS5zdHJpbmcNCiAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGRvbl9sb2coIlJlZ2V4OiAtLSBubyBpZ25vcmVjYWNoZSIpDQogICAgICAgICAgICAgICAgICAgICAgICAjdHJ5Og0KICAgICAgICAgICAgICAgICAgICAgICAgIyAgICByZWdleHNbaSgnbmFtZScpWzBdLnN0cmluZ11bJ2lnbm9yZWNhY2hlJ10gPSBpKCdpZ25vcmVjYWNoZScpWzBdLnN0cmluZw0KICAgICAgICAgICAgICAgICAgICAgICAgI2V4Y2VwdDoNCiAgICAgICAgICAgICAgICAgICAgICAgICMgICAgYWRkb25fbG9nKCJSZWdleDogLS0gbm8gaWdub3JlY2FjaGUiKQkJCQ0KDQogICAgICAgICAgICAgICAgICAgIHJlZ2V4cyA9IHVybGxpYi5xdW90ZShyZXByKHJlZ2V4cykpDQogICAgICAgICAgICAgICAgICAgIHJldHVybiByZWdleHMNCiAgICAgICAgICAgICAgICAgICAgI3ByaW50IHJlZ2V4cw0KICAgICAgICAgICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgICAgICAgICAgcmVnZXhzID0gTm9uZQ0KICAgICAgICAgICAgICAgICAgICBhZGRvbl9sb2coJ3JlZ2V4IEVycm9yOiAnK25hbWUuZW5jb2RlKCd1dGYtOCcsICdpZ25vcmUnKSkNCiNjb3BpZXMgZnJvbSBsYW1kYSdzIGltcGxlbWVudGF0aW9uDQpkZWYgZ2V0X3VzdHJlYW0odXJsKToNCiAgICB0cnk6DQogICAgICAgIGZvciBpIGluIHJhbmdlKDEsIDUxKToNCiAgICAgICAgICAgIHJlc3VsdCA9IGdldFVybCh1cmwpDQogICAgICAgICAgICBpZiAiRVhULVgtU1RSRUFNLUlORiIgaW4gcmVzdWx0OiByZXR1cm4gdXJsDQogICAgICAgICAgICBpZiBub3QgIkVYVE0zVSIgaW4gcmVzdWx0OiByZXR1cm4NCiAgICAgICAgICAgIHhibWMuc2xlZXAoMjAwMCkNCiAgICAgICAgcmV0dXJuDQogICAgZXhjZXB0Og0KICAgICAgICByZXR1cm4NCiAgICAgICAgDQogDQpkZWYgZ2V0UmVnZXhQYXJzZWQocmVnZXhzLCB1cmwsY29va2llSmFyPU5vbmUsZm9yQ29va2llSmFyT25seT1GYWxzZSxyZWN1cnNpdmVDYWxsPUZhbHNlLGNhY2hlZFBhZ2VzPXt9LCByYXdQb3N0PUZhbHNlLCBjb29raWVfamFyX2ZpbGU9Tm9uZSk6IzAsMSwyID0gVVJMLCByZWdleE9ubHksIENvb2tpZUphck9ubHkNCiAgICAgICAgaWYgbm90IHJlY3Vyc2l2ZUNhbGw6DQogICAgICAgICAgICByZWdleHMgPSBldmFsKHVybGxpYi51bnF1b3RlKHJlZ2V4cykpDQogICAgICAgICNjYWNoZWRQYWdlcyA9IHt9DQogICAgICAgICNwcmludCAndXJsJyx1cmwNCiAgICAgICAgZG9SZWdleHMgPSByZS5jb21waWxlKCdcJGRvcmVnZXhcWyhbXlxdXSopXF0nKS5maW5kYWxsKHVybCkNCiAgICAgICAgI3ByaW50ICdkb1JlZ2V4cycsZG9SZWdleHMscmVnZXhzDQogICAgICAgIHNldHJlc29sdmVkPVRydWUNCiAgICAgICAgICAgICAgDQogDQoNCg0KICAgICAgICBmb3IgayBpbiBkb1JlZ2V4czoNCiAgICAgICAgICAgIGlmIGsgaW4gcmVnZXhzOg0KICAgICAgICAgICAgICAgICNwcmludCAncHJvY2Vzc2luZyAnICxrDQogICAgICAgICAgICAgICAgbSA9IHJlZ2V4c1trXQ0KICAgICAgICAgICAgICAgICNwcmludCBtDQogICAgICAgICAgICAgICAgY29va2llSmFyUGFyYW09RmFsc2UNCg0KDQogICAgICAgICAgICAgICAgaWYgICdjb29raWVqYXInIGluIG06ICMgc28gZWl0aGVyIGNyZWF0ZSBvciByZXVzZSBleGlzdGluZyBqYXINCiAgICAgICAgICAgICAgICAgICAgI3ByaW50ICdjb29raWVqYXIgZXhpc3RzJyxtWydjb29raWVqYXInXQ0KICAgICAgICAgICAgICAgICAgICBjb29raWVKYXJQYXJhbT1tWydjb29raWVqYXInXQ0KICAgICAgICAgICAgICAgICAgICBpZiAgJyRkb3JlZ2V4JyBpbiBjb29raWVKYXJQYXJhbToNCiAgICAgICAgICAgICAgICAgICAgICAgIGNvb2tpZUphcj1nZXRSZWdleFBhcnNlZChyZWdleHMsIG1bJ2Nvb2tpZWphciddLGNvb2tpZUphcixUcnVlLCBUcnVlLGNhY2hlZFBhZ2VzKQ0KICAgICAgICAgICAgICAgICAgICAgICAgY29va2llSmFyUGFyYW09VHJ1ZQ0KICAgICAgICAgICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgICAgICAgICAgY29va2llSmFyUGFyYW09VHJ1ZQ0KICAgICAgICAgICAgICAgICNwcmludCAnbVtjb29raWVqYXJdJyxtWydjb29raWVqYXInXSxjb29raWVKYXINCiAgICAgICAgICAgICAgICBpZiBjb29raWVKYXJQYXJhbToNCiAgICAgICAgICAgICAgICAgICAgaWYgY29va2llSmFyPT1Ob25lOg0KICAgICAgICAgICAgICAgICAgICAgICAgI3ByaW50ICdjcmVhdGUgY29va2llIGphcicNCiAgICAgICAgICAgICAgICAgICAgICAgIGNvb2tpZV9qYXJfZmlsZT1Ob25lDQogICAgICAgICAgICAgICAgICAgICAgICBpZiAnb3BlblsnIGluIG1bJ2Nvb2tpZWphciddOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvb2tpZV9qYXJfZmlsZT1tWydjb29raWVqYXInXS5zcGxpdCgnb3BlblsnKVsxXS5zcGxpdCgnXScpWzBdDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICBjb29raWVKYXI9Z2V0Q29va2llSmFyKGNvb2tpZV9qYXJfZmlsZSkNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGNvb2tpZV9qYXJfZmlsZToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzYXZlQ29va2llSmFyKGNvb2tpZUphcixjb29raWVfamFyX2ZpbGUpDQogICAgICAgICAgICAgICAgICAgICAgICAjaW1wb3J0IGNvb2tpZWxpYg0KICAgICAgICAgICAgICAgICAgICAgICAgI2Nvb2tpZUphciA9IGNvb2tpZWxpYi5MV1BDb29raWVKYXIoKQ0KICAgICAgICAgICAgICAgICAgICAgICAgI3ByaW50ICdjb29raWVKYXIgbmV3Jyxjb29raWVKYXINCiAgICAgICAgICAgICAgICAgICAgZWxpZiAnc2F2ZVsnIGluIG1bJ2Nvb2tpZWphciddOg0KICAgICAgICAgICAgICAgICAgICAgICAgY29va2llX2phcl9maWxlPW1bJ2Nvb2tpZWphciddLnNwbGl0KCdzYXZlWycpWzFdLnNwbGl0KCddJylbMF0NCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbXBsZXRlX3BhdGg9b3MucGF0aC5qb2luKHByb2ZpbGUsY29va2llX2phcl9maWxlKQ0KICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQgJ2NvbXBsZXRlX3BhdGgnLGNvbXBsZXRlX3BhdGgNCiAgICAgICAgICAgICAgICAgICAgICAgIHNhdmVDb29raWVKYXIoY29va2llSmFyLGNvb2tpZV9qYXJfZmlsZSkNCiAgICAgICAgICAgICAgICAgICAgICAgIA0KIA0KICAgICAgICAgICAgICAgIGlmICBtWydwYWdlJ10gYW5kICckZG9yZWdleCcgaW4gbVsncGFnZSddOg0KICAgICAgICAgICAgICAgICAgICBtWydwYWdlJ109Z2V0UmVnZXhQYXJzZWQocmVnZXhzLCBtWydwYWdlJ10sY29va2llSmFyLHJlY3Vyc2l2ZUNhbGw9VHJ1ZSxjYWNoZWRQYWdlcz1jYWNoZWRQYWdlcykNCg0KICAgICAgICAgICAgICAgIGlmICdzZXRjb29raWUnIGluIG0gYW5kIG1bJ3NldGNvb2tpZSddIGFuZCAnJGRvcmVnZXgnIGluIG1bJ3NldGNvb2tpZSddOg0KICAgICAgICAgICAgICAgICAgICBtWydzZXRjb29raWUnXT1nZXRSZWdleFBhcnNlZChyZWdleHMsIG1bJ3NldGNvb2tpZSddLGNvb2tpZUphcixyZWN1cnNpdmVDYWxsPVRydWUsY2FjaGVkUGFnZXM9Y2FjaGVkUGFnZXMpDQogICAgICAgICAgICAgICAgaWYgJ2FwcGVuZGNvb2tpZScgaW4gbSBhbmQgbVsnYXBwZW5kY29va2llJ10gYW5kICckZG9yZWdleCcgaW4gbVsnYXBwZW5kY29va2llJ106DQogICAgICAgICAgICAgICAgICAgIG1bJ2FwcGVuZGNvb2tpZSddPWdldFJlZ2V4UGFyc2VkKHJlZ2V4cywgbVsnYXBwZW5kY29va2llJ10sY29va2llSmFyLHJlY3Vyc2l2ZUNhbGw9VHJ1ZSxjYWNoZWRQYWdlcz1jYWNoZWRQYWdlcykNCg0KICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICBpZiAgJ3Bvc3QnIGluIG0gYW5kICckZG9yZWdleCcgaW4gbVsncG9zdCddOg0KICAgICAgICAgICAgICAgICAgICBtWydwb3N0J109Z2V0UmVnZXhQYXJzZWQocmVnZXhzLCBtWydwb3N0J10sY29va2llSmFyLHJlY3Vyc2l2ZUNhbGw9VHJ1ZSxjYWNoZWRQYWdlcz1jYWNoZWRQYWdlcykNCiAgICAgICAgICAgICAgICAgICAgcHJpbnQgJ3Bvc3QgaXMgbm93JyxtWydwb3N0J10NCg0KICAgICAgICAgICAgICAgIGlmICAncmF3cG9zdCcgaW4gbSBhbmQgJyRkb3JlZ2V4JyBpbiBtWydyYXdwb3N0J106DQogICAgICAgICAgICAgICAgICAgIG1bJ3Jhd3Bvc3QnXT1nZXRSZWdleFBhcnNlZChyZWdleHMsIG1bJ3Jhd3Bvc3QnXSxjb29raWVKYXIscmVjdXJzaXZlQ2FsbD1UcnVlLGNhY2hlZFBhZ2VzPWNhY2hlZFBhZ2VzLHJhd1Bvc3Q9VHJ1ZSkNCiAgICAgICAgICAgICAgICAgICAgI3ByaW50ICdyYXdwb3N0IGlzIG5vdycsbVsncmF3cG9zdCddDQogIA0KICAgICAgICAgICAgICAgIGlmICdyYXdwb3N0JyBpbiBtIGFuZCAnJGVwb2N0aW1lJCcgaW4gbVsncmF3cG9zdCddOg0KICAgICAgICAgICAgICAgICAgICBtWydyYXdwb3N0J109bVsncmF3cG9zdCddLnJlcGxhY2UoJyRlcG9jdGltZSQnLGdldEVwb2NUaW1lKCkpDQogIA0KICAgICAgICAgICAgICAgIGlmICdyYXdwb3N0JyBpbiBtIGFuZCAnJGVwb2N0aW1lMiQnIGluIG1bJ3Jhd3Bvc3QnXToNCiAgICAgICAgICAgICAgICAgICAgbVsncmF3cG9zdCddPW1bJ3Jhd3Bvc3QnXS5yZXBsYWNlKCckZXBvY3RpbWUyJCcsZ2V0RXBvY1RpbWUyKCkpDQoNCiAgDQogICAgICAgICAgICAgICAgbGluaz0nJw0KICAgICAgICAgICAgICAgIGlmIG1bJ3BhZ2UnXSBhbmQgbVsncGFnZSddIGluIGNhY2hlZFBhZ2VzIGFuZCBub3QgJ2lnbm9yZWNhY2hlJyBpbiBtIGFuZCBmb3JDb29raWVKYXJPbmx5PT1GYWxzZSA6DQogICAgICAgICAgICAgICAgICAgIGxpbmsgPSBjYWNoZWRQYWdlc1ttWydwYWdlJ11dDQogICAgICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICAgICAgaWYgbVsncGFnZSddIGFuZCAgbm90IG1bJ3BhZ2UnXT09JycgYW5kICBtWydwYWdlJ10uc3RhcnRzd2l0aCgnaHR0cCcpOg0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgJyRlcG9jdGltZSQnIGluIG1bJ3BhZ2UnXToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtWydwYWdlJ109bVsncGFnZSddLnJlcGxhY2UoJyRlcG9jdGltZSQnLGdldEVwb2NUaW1lKCkpDQogICAgICAgICAgICAgICAgICAgICAgICBpZiAnJGVwb2N0aW1lMiQnIGluIG1bJ3BhZ2UnXToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtWydwYWdlJ109bVsncGFnZSddLnJlcGxhY2UoJyRlcG9jdGltZTIkJyxnZXRFcG9jVGltZTIoKSkNCg0KICAgICAgICAgICAgICAgICAgICAgICAgI3ByaW50ICdJbmdvcmluZyBDYWNoZScsbVsncGFnZSddDQogICAgICAgICAgICAgICAgICAgICAgICBwYWdlX3NwbGl0PW1bJ3BhZ2UnXS5zcGxpdCgnfCcpDQogICAgICAgICAgICAgICAgICAgICAgICBwYWdlVXJsPXBhZ2Vfc3BsaXRbMF0NCiAgICAgICAgICAgICAgICAgICAgICAgIGhlYWRlcl9pbl9wYWdlPU5vbmUNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGxlbihwYWdlX3NwbGl0KT4xOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhlYWRlcl9pbl9wYWdlPXBhZ2Vfc3BsaXRbMV0NCiAgICAgICAgICAgICAgICAgICAgICAgIHJlcSA9IHVybGxpYjIuUmVxdWVzdChwYWdlVXJsKQ0KICAgICAgICAgICAgICAgICAgICAgICAgcmVxLmFkZF9oZWFkZXIoJ1VzZXItQWdlbnQnLCAnTW96aWxsYS81LjAgKFdpbmRvd3MgTlQgNi4xOyBydjoxNC4wKSBHZWNrby8yMDEwMDEwMSBGaXJlZm94LzE0LjAuMScpDQogICAgICAgICAgICAgICAgICAgICAgICBpZiAncmVmZXInIGluIG06DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVxLmFkZF9oZWFkZXIoJ1JlZmVyZXInLCBtWydyZWZlciddKQ0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgJ2FnZW50JyBpbiBtOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcS5hZGRfaGVhZGVyKCdVc2VyLWFnZW50JywgbVsnYWdlbnQnXSkNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICd4LXJlcScgaW4gbToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXEuYWRkX2hlYWRlcignWC1SZXF1ZXN0ZWQtV2l0aCcsIG1bJ3gtcmVxJ10pDQogICAgICAgICAgICAgICAgICAgICAgICBpZiAneC1mb3J3YXJkJyBpbiBtOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcS5hZGRfaGVhZGVyKCdYLUZvcndhcmRlZC1Gb3InLCBtWyd4LWZvcndhcmQnXSkNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICdzZXRjb29raWUnIGluIG06DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQgJ2FkZGluZyBjb29raWUnLG1bJ3NldGNvb2tpZSddDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVxLmFkZF9oZWFkZXIoJ0Nvb2tpZScsIG1bJ3NldGNvb2tpZSddKQ0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgJ2FwcGVuZGNvb2tpZScgaW4gbToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmludCAnYXBwZW5kaW5nIGNvb2tpZSB0byBjb29raWVqYXInLG1bJ2FwcGVuZGNvb2tpZSddDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29va2llc3RvQXBlbmQ9bVsnYXBwZW5kY29va2llJ10NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb29raWVzdG9BcGVuZD1jb29raWVzdG9BcGVuZC5zcGxpdCgnOycpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIGggaW4gY29va2llc3RvQXBlbmQ6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG4sdj1oLnNwbGl0KCc9JykNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdyxuPSBuLnNwbGl0KCc6JykNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2sgPSBjb29raWVsaWIuQ29va2llKHZlcnNpb249MCwgbmFtZT1uLCB2YWx1ZT12LCBwb3J0PU5vbmUsIHBvcnRfc3BlY2lmaWVkPUZhbHNlLCBkb21haW49dywgZG9tYWluX3NwZWNpZmllZD1GYWxzZSwgZG9tYWluX2luaXRpYWxfZG90PUZhbHNlLCBwYXRoPScvJywgcGF0aF9zcGVjaWZpZWQ9VHJ1ZSwgc2VjdXJlPUZhbHNlLCBleHBpcmVzPU5vbmUsIGRpc2NhcmQ9VHJ1ZSwgY29tbWVudD1Ob25lLCBjb21tZW50X3VybD1Ob25lLCByZXN0PXsnSHR0cE9ubHknOiBOb25lfSwgcmZjMjEwOT1GYWxzZSkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29va2llSmFyLnNldF9jb29raWUoY2spDQoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgDQoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICdvcmlnaW4nIGluIG06DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVxLmFkZF9oZWFkZXIoJ09yaWdpbicsIG1bJ29yaWdpbiddKQ0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgaGVhZGVyX2luX3BhZ2U6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaGVhZGVyX2luX3BhZ2U9aGVhZGVyX2luX3BhZ2Uuc3BsaXQoJyYnKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciBoIGluIGhlYWRlcl9pbl9wYWdlOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuLHY9aC5zcGxpdCgnPScpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcS5hZGRfaGVhZGVyKG4sdikNCg0KDQogICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgY29va2llSmFyPT1Ob25lOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICNwcmludCAnY29va2llSmFyVmFsJyxjb29raWVKYXINCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb29raWVfaGFuZGxlciA9IHVybGxpYjIuSFRUUENvb2tpZVByb2Nlc3Nvcihjb29raWVKYXIpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgb3BlbmVyID0gdXJsbGliMi5idWlsZF9vcGVuZXIoY29va2llX2hhbmRsZXIsIHVybGxpYjIuSFRUUEJhc2ljQXV0aEhhbmRsZXIoKSwgdXJsbGliMi5IVFRQSGFuZGxlcigpKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wZW5lciA9IHVybGxpYjIuaW5zdGFsbF9vcGVuZXIob3BlbmVyKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICdub3JlZGlyZWN0JyBpbiBtOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcGVuZXIyID0gdXJsbGliMi5idWlsZF9vcGVuZXIoTm9SZWRpcmVjdGlvbikNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3BlbmVyID0gdXJsbGliMi5pbnN0YWxsX29wZW5lcihvcGVuZXIyKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICdjb25uZWN0aW9uJyBpbiBtOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByaW50ICcuLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLmNvbm5lY3Rpb24vLy8vLy8uJyxtWydjb25uZWN0aW9uJ10NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmcm9tIGtlZXBhbGl2ZSBpbXBvcnQgSFRUUEhhbmRsZXINCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBrZWVwYWxpdmVfaGFuZGxlciA9IEhUVFBIYW5kbGVyKCkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcGVuZXIgPSB1cmxsaWIyLmJ1aWxkX29wZW5lcihrZWVwYWxpdmVfaGFuZGxlcikNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cmxsaWIyLmluc3RhbGxfb3BlbmVyKG9wZW5lcikNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgICNwcmludCAnYWZ0ZXIgY29va2llIGphcicNCiAgICAgICAgICAgICAgICAgICAgICAgIHBvc3Q9Tm9uZQ0KDQogICAgICAgICAgICAgICAgICAgICAgICBpZiAncG9zdCcgaW4gbToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb3N0RGF0YT1tWydwb3N0J10NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAnJExpdmVTdHJlYW1SZWNhcHRjaGEnIGluIHBvc3REYXRhOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoY2FwdGNoYV9jaGFsbGVuZ2UsY2F0cGNoYV93b3JkKT1wcm9jZXNzUmVjYXB0Y2hhKG1bJ3BhZ2UnXSkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgY2FwdGNoYV9jaGFsbGVuZ2U6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb3N0RGF0YSs9J3JlY2FwdGNoYV9jaGFsbGVuZ2VfZmllbGQ6JytjYXB0Y2hhX2NoYWxsZW5nZSsnLHJlY2FwdGNoYV9yZXNwb25zZV9maWVsZDonK2NhdHBjaGFfd29yZA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNwbGl0cG9zdD1wb3N0RGF0YS5zcGxpdCgnLCcpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvc3Q9e30NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgcCBpbiBzcGxpdHBvc3Q6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG49cC5zcGxpdCgnOicpWzBdOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2PXAuc3BsaXQoJzonKVsxXTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9zdFtuXT12DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9zdCA9IHVybGxpYi51cmxlbmNvZGUocG9zdCkNCg0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgJ3Jhd3Bvc3QnIGluIG06DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9zdD1tWydyYXdwb3N0J10NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAnJExpdmVTdHJlYW1SZWNhcHRjaGEnIGluIHBvc3Q6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChjYXB0Y2hhX2NoYWxsZW5nZSxjYXRwY2hhX3dvcmQpPXByb2Nlc3NSZWNhcHRjaGEobVsncGFnZSddKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBjYXB0Y2hhX2NoYWxsZW5nZToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9zdCs9JyZyZWNhcHRjaGFfY2hhbGxlbmdlX2ZpZWxkPScrY2FwdGNoYV9jaGFsbGVuZ2UrJyZyZWNhcHRjaGFfcmVzcG9uc2VfZmllbGQ9JytjYXRwY2hhX3dvcmQNCg0KDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgDQoNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIHBvc3Q6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2UgPSB1cmxsaWIyLnVybG9wZW4ocmVxLHBvc3QpDQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlID0gdXJsbGliMi51cmxvcGVuKHJlcSkNCg0KICAgICAgICAgICAgICAgICAgICAgICAgbGluayA9IHJlc3BvbnNlLnJlYWQoKQ0KICAgICAgICAgICAgICAgICAgICAgICAgbGluaz1qYXZhc2NyaXB0VW5Fc2NhcGUobGluaykNCiAgICAgICAgICAgICAgICAgICAgICAgICNwcmludCBsaW5rIFRoaXMganVzdCBwcmludCB3aG9sZSB3ZWJwYWdlIGluIExPRw0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgJ2luY2x1ZGVoZWFkZXJzJyBpbiBtOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpbmsrPXN0cihyZXNwb25zZS5oZWFkZXJzLmdldCgnU2V0LUNvb2tpZScpKQ0KDQogICAgICAgICAgICAgICAgICAgICAgICByZXNwb25zZS5jbG9zZSgpDQogICAgICAgICAgICAgICAgICAgICAgICBjYWNoZWRQYWdlc1ttWydwYWdlJ11dID0gbGluaw0KICAgICAgICAgICAgICAgICAgICAgICAgI3ByaW50IGxpbmsNCiAgICAgICAgICAgICAgICAgICAgICAgICNwcmludCAnc3RvcmUgbGluayBmb3InLG1bJ3BhZ2UnXSxmb3JDb29raWVKYXJPbmx5DQogICAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGZvckNvb2tpZUphck9ubHk6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNvb2tpZUphciMgZG8gbm90aGluZw0KICAgICAgICAgICAgICAgICAgICBlbGlmIG1bJ3BhZ2UnXSBhbmQgIG5vdCBtWydwYWdlJ10uc3RhcnRzd2l0aCgnaHR0cCcpOg0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgbVsncGFnZSddLnN0YXJ0c3dpdGgoJyRweUZ1bmN0aW9uOicpOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbD1kb0V2YWwobVsncGFnZSddLnNwbGl0KCckcHlGdW5jdGlvbjonKVsxXSwnJyxjb29raWVKYXIgKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGZvckNvb2tpZUphck9ubHk6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBjb29raWVKYXIjIGRvIG5vdGhpbmcNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaW5rPXZhbA0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaW5rPW1bJ3BhZ2UnXQ0KICAgICAgICAgICAgICAgIGlmICckcHlGdW5jdGlvbjpwbGF5bWVkaWEoJyBpbiBtWydleHByZSddIG9yICdBY3RpdmF0ZVdpbmRvdycgIGluIG1bJ2V4cHJlJ10gICBvciAgYW55KHggaW4gdXJsIGZvciB4IGluIGdfaWdub3JlU2V0UmVzb2x2ZWQpOg0KICAgICAgICAgICAgICAgICAgICBzZXRyZXNvbHZlZD1GYWxzZQ0KICAgICAgICAgICAgICAgIGlmICAnJGRvcmVnZXgnIGluIG1bJ2V4cHJlJ106DQogICAgICAgICAgICAgICAgICAgIG1bJ2V4cHJlJ109Z2V0UmVnZXhQYXJzZWQocmVnZXhzLCBtWydleHByZSddLGNvb2tpZUphcixyZWN1cnNpdmVDYWxsPVRydWUsY2FjaGVkUGFnZXM9Y2FjaGVkUGFnZXMpDQogICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIGlmIG5vdCBtWydleHByZSddPT0nJzoNCiAgICAgICAgICAgICAgICAgICAgcHJpbnQgJ2RvaW5nIGl0ICcsbVsnZXhwcmUnXQ0KICAgICAgICAgICAgICAgICAgICBpZiAnJExpdmVTdHJlYW1DYXB0Y2hhJyBpbiBtWydleHByZSddOg0KICAgICAgICAgICAgICAgICAgICAgICAgdmFsPWFza0NhcHRjaGEobSxsaW5rLGNvb2tpZUphcikNCiAgICAgICAgICAgICAgICAgICAgICAgICNwcmludCAndXJsIGFuZCB2YWwnLHVybCx2YWwNCiAgICAgICAgICAgICAgICAgICAgICAgIHVybCA9IHVybC5yZXBsYWNlKCIkZG9yZWdleFsiICsgayArICJdIiwgdmFsKQ0KICAgICAgICAgICAgICAgICAgICBlbGlmIG1bJ2V4cHJlJ10uc3RhcnRzd2l0aCgnJHB5RnVuY3Rpb246Jyk6DQogICAgICAgICAgICAgICAgICAgICAgICAjcHJpbnQgJ2V4cGVlZWVlZWVlZWVlZWVlZWVlZWUnLG1bJ2V4cHJlJ10NCiAgICAgICAgICAgICAgICAgICAgICAgIHZhbD1kb0V2YWwobVsnZXhwcmUnXS5zcGxpdCgnJHB5RnVuY3Rpb246JylbMV0sbGluayxjb29raWVKYXIgKQ0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgJ0FjdGl2YXRlV2luZG93JyBpbiBtWydleHByZSddOiByZXR1cm4gDQogICAgICAgICAgICAgICAgICAgICAgICBwcmludCAnc3RpbGwgaHJlJw0KICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQgJ3VybCBrIHZhbCcsdXJsLGssdmFsDQoNCiAgICAgICAgICAgICAgICAgICAgICAgIHVybCA9IHVybC5yZXBsYWNlKCIkZG9yZWdleFsiICsgayArICJdIiwgdmFsKQ0KICAgICAgICAgICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IGxpbms9PScnOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZyA9IHJlLmNvbXBpbGUobVsnZXhwcmUnXSkuc2VhcmNoKGxpbmspDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsPScnDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWw9cmVnLmdyb3VwKDEpLnN0cmlwKCkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6IHRyYWNlYmFjay5wcmludF9leGMoKQ0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWw9bVsnZXhwcmUnXQ0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgcmF3UG9zdDoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmludCAncmF3cG9zdCcNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWw9dXJsbGliLnF1b3RlX3BsdXModmFsKQ0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgJ2h0bWx1bmVzY2FwZScgaW4gbToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjdmFsPXVybGxpYi51bnF1b3RlX3BsdXModmFsKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGltcG9ydCBIVE1MUGFyc2VyDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsPUhUTUxQYXJzZXIuSFRNTFBhcnNlcigpLnVuZXNjYXBlKHZhbCkgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgIHVybCA9IHVybC5yZXBsYWNlKCIkZG9yZWdleFsiICsgayArICJdIiwgdmFsKQ0KICAgICAgICAgICAgICAgICAgICAgICAgI3JldHVybiB2YWwNCiAgICAgICAgICAgICAgICBlbHNlOiAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIHVybCA9IHVybC5yZXBsYWNlKCIkZG9yZWdleFsiICsgayArICJdIiwnJykNCiAgICAgICAgaWYgJyRlcG9jdGltZSQnIGluIHVybDoNCiAgICAgICAgICAgIHVybD11cmwucmVwbGFjZSgnJGVwb2N0aW1lJCcsZ2V0RXBvY1RpbWUoKSkNCiAgICAgICAgaWYgJyRlcG9jdGltZTIkJyBpbiB1cmw6DQogICAgICAgICAgICB1cmw9dXJsLnJlcGxhY2UoJyRlcG9jdGltZTIkJyxnZXRFcG9jVGltZTIoKSkNCg0KICAgICAgICBpZiAnJEdVSUQkJyBpbiB1cmw6DQogICAgICAgICAgICBpbXBvcnQgdXVpZA0KICAgICAgICAgICAgdXJsPXVybC5yZXBsYWNlKCckR1VJRCQnLHN0cih1dWlkLnV1aWQxKCkpLnVwcGVyKCkpDQogICAgICAgIGlmICckZ2V0X2Nvb2tpZXMkJyBpbiB1cmw6DQogICAgICAgICAgICB1cmw9dXJsLnJlcGxhY2UoJyRnZXRfY29va2llcyQnLGdldENvb2tpZXNTdHJpbmcoY29va2llSmFyKSkgICANCg0KICAgICAgICBpZiByZWN1cnNpdmVDYWxsOiByZXR1cm4gdXJsDQogICAgICAgIHByaW50ICdmaW5hbCB1cmwnLHVybA0KICAgICAgICBpZiB1cmw9PSIiOiANCiAgICAgICAgCXJldHVybg0KICAgICAgICBlbHNlOg0KICAgICAgICAJcmV0dXJuIHVybCxzZXRyZXNvbHZlZA0KDQogICAgICAgICAgICANCiAgICAgICAgDQpkZWYgZ2V0bWQ1KHQpOg0KICAgIGltcG9ydCBoYXNobGliDQogICAgaD1oYXNobGliLm1kNSgpDQogICAgaC51cGRhdGUodCkNCiAgICByZXR1cm4gaC5oZXhkaWdlc3QoKQ0KDQpkZWYgZGVjcnlwdF92YXVnaG5saXZlKGVuY3J5cHRlZCk6DQogICAgcmV0VmFsPSIiDQogICAgZm9yIHZhbCBpbiBlbmNyeXB0ZWQuc3BsaXQoJzonKToNCiAgICAgICAgcmV0VmFsKz1jaHIoaW50KHZhbC5yZXBsYWNlKCIwbTAiLCIiKSkvODQvNSkNCiAgICByZXR1cm4gcmV0VmFsDQoNCmRlZiBwbGF5bWVkaWEobWVkaWFfdXJsKToNCiAgICB0cnk6DQogICAgICAgIGltcG9ydCAgQ3VzdG9tUGxheWVyDQogICAgICAgIHBsYXllciA9IEN1c3RvbVBsYXllci5NeVhCTUNQbGF5ZXIoKQ0KICAgICAgICBsaXN0aXRlbSA9IHhibWNndWkuTGlzdEl0ZW0oIGxhYmVsID0gc3RyKG5hbWUpLCBpY29uSW1hZ2UgPSAiRGVmYXVsdFZpZGVvLnBuZyIsIHRodW1ibmFpbEltYWdlID0geGJtYy5nZXRJbmZvSW1hZ2UoICJMaXN0SXRlbS5UaHVtYiIgKSwgcGF0aD1tZWRpYV91cmwgKQ0KICAgICAgICBwbGF5ZXIucGxheSggbWVkaWFfdXJsLGxpc3RpdGVtKQ0KICAgICAgICB4Ym1jLnNsZWVwKDEwMDApDQogICAgICAgIHdoaWxlIHBsYXllci5pc19hY3RpdmU6DQogICAgICAgICAgICB4Ym1jLnNsZWVwKDIwMCkNCiAgICBleGNlcHQ6DQogICAgICAgIHRyYWNlYmFjay5wcmludF9leGMoKQ0KICAgIHJldHVybiAnJw0KICAgIA0KICAgICAgICANCmRlZiBnZXRfc2F3X3J0bXAocGFnZV92YWx1ZSwgcmVmZXJlcj1Ob25lKToNCiAgICBpZiByZWZlcmVyOg0KICAgICAgICByZWZlcmVyPVsoJ1JlZmVyZXInLHJlZmVyZXIpXQ0KICAgIGlmIHBhZ2VfdmFsdWUuc3RhcnRzd2l0aCgiaHR0cCIpOg0KICAgICAgICBwYWdlX3VybD1wYWdlX3ZhbHVlDQogICAgICAgIHBhZ2VfdmFsdWU9IGdldFVybChwYWdlX3ZhbHVlLGhlYWRlcnM9cmVmZXJlcikNCg0KICAgIHN0cl9wYXR0ZXJuPSIoZXZhbFwoZnVuY3Rpb25cKHAsYSxjLGssZSwoPzpyfGQpLiopIg0KDQogICAgcmVnX3Jlcz1yZS5jb21waWxlKHN0cl9wYXR0ZXJuKS5maW5kYWxsKHBhZ2VfdmFsdWUpDQogICAgcj0iIg0KICAgIGlmIHJlZ19yZXMgYW5kIGxlbihyZWdfcmVzKT4wOg0KICAgICAgICBmb3IgdiBpbiByZWdfcmVzOg0KICAgICAgICAgICAgcjE9Z2V0X3VucGFja2VkKHYpDQogICAgICAgICAgICByMj1yZV9tZShyMSwnXCcoLio/KVwnJykNCiAgICAgICAgICAgIGlmICd1bmVzY2FwZScgaW4gcjE6DQogICAgICAgICAgICAgICAgcjE9dXJsbGliLnVucXVvdGUocjIpDQogICAgICAgICAgICByKz1yMSsnXG4nDQogICAgICAgIHByaW50ICdmaW5hbCB2YWx1ZSBpcyAnLHINCiAgICAgICAgDQogICAgICAgIHBhZ2VfdXJsPXJlX21lKHIsJ3NyYz0iKC4qPykiJykNCiAgICAgICAgDQogICAgICAgIHBhZ2VfdmFsdWU9IGdldFVybChwYWdlX3VybCxoZWFkZXJzPXJlZmVyZXIpDQoNCiAgICAjcHJpbnQgcGFnZV92YWx1ZQ0KDQogICAgcnRtcD1yZV9tZShwYWdlX3ZhbHVlLCdzdHJlYW1lclwnLio/XCcoLio/KVwnXCknKQ0KICAgIHBsYXlwYXRoPXJlX21lKHBhZ2VfdmFsdWUsJ2ZpbGVcJyxcc1wnKC4qPylcJycpDQoNCiAgICANCiAgICByZXR1cm4gcnRtcCsnIHBsYXlwYXRoPScrcGxheXBhdGggKycgcGFnZVVybD0nK3BhZ2VfdXJsDQogICAgDQpkZWYgZ2V0X2xldG9uX3J0bXAocGFnZV92YWx1ZSwgcmVmZXJlcj1Ob25lKToNCiAgICBpZiByZWZlcmVyOg0KICAgICAgICByZWZlcmVyPVsoJ1JlZmVyZXInLHJlZmVyZXIpXQ0KICAgIGlmIHBhZ2VfdmFsdWUuc3RhcnRzd2l0aCgiaHR0cCIpOg0KICAgICAgICBwYWdlX3ZhbHVlPSBnZXRVcmwocGFnZV92YWx1ZSxoZWFkZXJzPXJlZmVyZXIpDQogICAgc3RyX3BhdHRlcm49InZhciBhID0gKC4qPyk7XHMqdmFyIGIgPSAoLio/KTtccyp2YXIgYyA9ICguKj8pO1xzKnZhciBkID0gKC4qPyk7XHMqdmFyIGYgPSAoLio/KTtccyp2YXIgdl9wYXJ0ID0gJyguKj8pJzsiDQogICAgcmVnX3Jlcz1yZS5jb21waWxlKHN0cl9wYXR0ZXJuKS5maW5kYWxsKHBhZ2VfdmFsdWUpWzBdIA0KDQogICAgYSxiLGMsZCxmLHY9KHJlZ19yZXMpDQogICAgZj1pbnQoZikNCiAgICBhPWludChhKS9mDQogICAgYj1pbnQoYikvZg0KICAgIGM9aW50KGMpL2YNCiAgICBkPWludChkKS9mDQoNCiAgICByZXQ9ICdydG1wOi8vJyArIHN0cihhKSArICcuJyArIHN0cihiKSArICcuJyArIHN0cihjKSArICcuJyArIHN0cihkKSArIHY7DQogICAgcmV0dXJuIHJldA0KDQpkZWYgY3JlYXRlTTN1Rm9yRGFzaCh1cmwsdXNlcmFnZW50PU5vbmUpOg0KICAgIHN0cj0nI0VYVE0zVScNCiAgICBzdHIrPSdcbiNFWFQtWC1TVFJFQU0tSU5GOlBST0dSQU0tSUQ9MSxCQU5EV0lEVEg9MzYxODE2Jw0KICAgIHN0cis9J1xuJyt1cmwrJyZieXRlcz0wLTIwMDAwMCcjKyd8VXNlci1BZ2VudD0nK3VzZXJhZ2VudA0KICAgIHNvdXJjZV9maWxlID0gb3MucGF0aC5qb2luKHByb2ZpbGUsICd0ZXN0ZmlsZS5tM3UnKQ0KICAgIHN0cis9J1xuJw0KICAgIFNhdmVUb0ZpbGUoc291cmNlX2ZpbGUsc3RyKQ0KICAgICNyZXR1cm4gJ0M6L1VzZXJzL3NoYW5pL0Rvd25sb2Fkcy90ZXN0Lm0zdTgnDQogICAgcmV0dXJuIHNvdXJjZV9maWxlDQoNCmRlZiBTYXZlVG9GaWxlKGZpbGVfbmFtZSxwYWdlX2RhdGEsYXBwZW5kPUZhbHNlKToNCiAgICBpZiBhcHBlbmQ6DQogICAgICAgIGYgPSBvcGVuKGZpbGVfbmFtZSwgJ2EnKQ0KICAgICAgICBmLndyaXRlKHBhZ2VfZGF0YSkNCiAgICAgICAgZi5jbG9zZSgpICAgICAgICANCiAgICBlbHNlOg0KICAgICAgICBmPW9wZW4oZmlsZV9uYW1lLCd3YicpDQogICAgICAgIGYud3JpdGUocGFnZV9kYXRhKQ0KICAgICAgICBmLmNsb3NlKCkNCiAgICAgICAgcmV0dXJuICcnDQogICAgDQpkZWYgTG9hZEZpbGUoZmlsZV9uYW1lKToNCglmPW9wZW4oZmlsZV9uYW1lLCdyYicpDQoJZD1mLnJlYWQoKQ0KCWYuY2xvc2UoKQ0KCXJldHVybiBkDQogICAgDQpkZWYgZ2V0X3BhY2tlZF9pcGhvbmV0dl91cmwocGFnZV9kYXRhKToNCglpbXBvcnQgcmUsYmFzZTY0LHVybGxpYjsgDQoJcz1wYWdlX2RhdGENCgl3aGlsZSAnZ2VoKCcgaW4gczoNCgkJaWYgcy5zdGFydHN3aXRoKCdsb2woJyk6IHM9c1s1Oi0xXSAgICANCiMJCXByaW50ICdzIGlzICcscw0KCQlzPXJlLmNvbXBpbGUoJyIoLio/KSInKS5maW5kYWxsKHMpWzBdOyANCgkJcz0gIGJhc2U2NC5iNjRkZWNvZGUocyk7IA0KCQlzPXVybGxpYi51bnF1b3RlKHMpOyANCglwcmludCBzDQoJcmV0dXJuIHMNCg0KZGVmIGdldF9mZXJyYXJpX3VybChwYWdlX2RhdGEpOg0KICAgIHByaW50ICdnZXRfZGFnX3VybDInLHBhZ2VfZGF0YQ0KICAgIHBhZ2VfZGF0YTI9Z2V0VXJsKHBhZ2VfZGF0YSk7DQogICAgcGF0dD0nKGh0dHAuKiknDQogICAgaW1wb3J0IHV1aWQNCiAgICBwbGF5YmFjaz1zdHIodXVpZC51dWlkMSgpKS51cHBlcigpDQogICAgbGlua3M9cmUuY29tcGlsZShwYXR0KS5maW5kYWxsKHBhZ2VfZGF0YTIpDQogICAgaGVhZGVycz1bKCdYLVBsYXliYWNrLVNlc3Npb24tSWQnLHBsYXliYWNrKV0NCiAgICBmb3IgbCBpbiBsaW5rczoNCiAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgIHBhZ2VfZGF0YXRlbXA9Z2V0VXJsKGwsaGVhZGVycz1oZWFkZXJzKTsNCiAgICAgICAgICAgICAgICAgICAgDQogICAgICAgIGV4Y2VwdDogcGFzcw0KICAgIA0KICAgIHJldHVybiBwYWdlX2RhdGErJ3wmWC1QbGF5YmFjay1TZXNzaW9uLUlkPScrcGxheWJhY2sNCg0KICAgIA0KZGVmIGdldF9kYWdfdXJsKHBhZ2VfZGF0YSk6DQogICAgcHJpbnQgJ2dldF9kYWdfdXJsJyxwYWdlX2RhdGENCiAgICBpZiBwYWdlX2RhdGEuc3RhcnRzd2l0aCgnaHR0cDovL2RhZy50b3RhbC1zdHJlYW0ubmV0Jyk6DQogICAgICAgIGhlYWRlcnM9WygnVXNlci1BZ2VudCcsJ1ZlcmlzbW8tQmxhY2tVSV8oMi40LjcuNS44LjAuMzQpJyldDQogICAgICAgIHBhZ2VfZGF0YT1nZXRVcmwocGFnZV9kYXRhLGhlYWRlcnM9aGVhZGVycyk7DQoNCiAgICBpZiAnMTI3LjAuMC4xJyBpbiBwYWdlX2RhdGE6DQogICAgICAgIHJldHVybiByZXZpc3RfZGFnKHBhZ2VfZGF0YSkNCiAgICBlbGlmIHJlX21lKHBhZ2VfZGF0YSwgJ3dtc0F1dGhTaWduJTNEKFteJSZdKyknKSAhPSAnJzoNCiAgICAgICAgZmluYWxfdXJsID0gcmVfbWUocGFnZV9kYXRhLCAnJnZlcl90PShbXiZdKykmJykgKyAnP3dtc0F1dGhTaWduPScgKyByZV9tZShwYWdlX2RhdGEsICd3bXNBdXRoU2lnbiUzRChbXiUmXSspJykgKyAnPT0vbXA0OicgKyByZV9tZShwYWdlX2RhdGEsICdcXD95PShbXiZdKykmJykNCiAgICBlbHNlOg0KICAgICAgICBmaW5hbF91cmwgPSByZV9tZShwYWdlX2RhdGEsICdocmVmPSIoW14iXSspIlteIl0rJCcpDQogICAgICAgIGlmIGxlbihmaW5hbF91cmwpPT0wOg0KICAgICAgICAgICAgZmluYWxfdXJsPXBhZ2VfZGF0YQ0KICAgIGZpbmFsX3VybCA9IGZpbmFsX3VybC5yZXBsYWNlKCcgJywgJyUyMCcpDQogICAgcmV0dXJuIGZpbmFsX3VybA0KDQpkZWYgcmVfbWUoZGF0YSwgcmVfcGF0dGVuKToNCiAgICBtYXRjaCA9ICcnDQogICAgbSA9IHJlLnNlYXJjaChyZV9wYXR0ZW4sIGRhdGEpDQogICAgaWYgbSAhPSBOb25lOg0KICAgICAgICBtYXRjaCA9IG0uZ3JvdXAoMSkNCiAgICBlbHNlOg0KICAgICAgICBtYXRjaCA9ICcnDQogICAgcmV0dXJuIG1hdGNoDQoNCmRlZiByZXZpc3RfZGFnKHBhZ2VfZGF0YSk6DQogICAgZmluYWxfdXJsID0gJycNCiAgICBpZiAnMTI3LjAuMC4xJyBpbiBwYWdlX2RhdGE6DQogICAgICAgIGZpbmFsX3VybCA9IHJlX21lKHBhZ2VfZGF0YSwgJyZ2ZXJfdD0oW14mXSspJicpICsgJyBsaXZlPXRydWUgdGltZW91dD0xNSBwbGF5cGF0aD0nICsgcmVfbWUocGFnZV9kYXRhLCAnXFw/eT0oW2EtekEtWjAtOS1fXFwuQF0rKScpDQogICAgICAgIA0KICAgIGlmIHJlX21lKHBhZ2VfZGF0YSwgJ3Rva2VuPShbXiZdKykmJykgIT0gJyc6DQogICAgICAgIGZpbmFsX3VybCA9IGZpbmFsX3VybCArICc/dG9rZW49JyArIHJlX21lKHBhZ2VfZGF0YSwgJ3Rva2VuPShbXiZdKykmJykNCiAgICBlbGlmIHJlX21lKHBhZ2VfZGF0YSwgJ3dtc0F1dGhTaWduJTNEKFteJSZdKyknKSAhPSAnJzoNCiAgICAgICAgZmluYWxfdXJsID0gcmVfbWUocGFnZV9kYXRhLCAnJnZlcl90PShbXiZdKykmJykgKyAnP3dtc0F1dGhTaWduPScgKyByZV9tZShwYWdlX2RhdGEsICd3bXNBdXRoU2lnbiUzRChbXiUmXSspJykgKyAnPT0vbXA0OicgKyByZV9tZShwYWdlX2RhdGEsICdcXD95PShbXiZdKykmJykNCiAgICBlbHNlOg0KICAgICAgICBmaW5hbF91cmwgPSByZV9tZShwYWdlX2RhdGEsICdIUkVGPSIoW14iXSspIicpDQoNCiAgICBpZiAnZGFnMS5hc3gnIGluIGZpbmFsX3VybDoNCiAgICAgICAgcmV0dXJuIGdldF9kYWdfdXJsKGZpbmFsX3VybCkNCg0KICAgIGlmICdkZXZpbmxpdmVmcy5mcGxpdmUubmV0JyBub3QgaW4gZmluYWxfdXJsOg0KICAgICAgICBmaW5hbF91cmwgPSBmaW5hbF91cmwucmVwbGFjZSgnZGV2aW5saXZlJywgJ2ZsaXZlJykNCiAgICBpZiAncGVybWxpdmVmcy5mcGxpdmUubmV0JyBub3QgaW4gZmluYWxfdXJsOg0KICAgICAgICBmaW5hbF91cmwgPSBmaW5hbF91cmwucmVwbGFjZSgncGVybWxpdmUnLCAnZmxpdmUnKQ0KICAgIHJldHVybiBmaW5hbF91cmwNCg0KDQpkZWYgZ2V0X3Vud2lzZSggc3RyX2V2YWwpOg0KICAgIHBhZ2VfdmFsdWU9IiINCiAgICB0cnk6ICAgICAgICANCiAgICAgICAgc3M9IncsaSxzLGU9KCIrc3RyX2V2YWwrJyknIA0KICAgICAgICBleGVjIChzcykNCiAgICAgICAgcGFnZV92YWx1ZT11bndpc2VfZnVuYyh3LGkscyxlKQ0KICAgIGV4Y2VwdDogdHJhY2ViYWNrLnByaW50X2V4YyhmaWxlPXN5cy5zdGRvdXQpDQogICAgI3ByaW50ICd1bnBhY2tlZCcscGFnZV92YWx1ZQ0KICAgIHJldHVybiBwYWdlX3ZhbHVlDQogICAgDQpkZWYgdW53aXNlX2Z1bmMoIHcsIGksIHMsIGUpOg0KICAgIGxJbGwgPSAwOw0KICAgIGxsMUkgPSAwOw0KICAgIElsMWwgPSAwOw0KICAgIGxsMWwgPSBbXTsNCiAgICBsMWxJID0gW107DQogICAgd2hpbGUgVHJ1ZToNCiAgICAgICAgaWYgKGxJbGwgPCA1KToNCiAgICAgICAgICAgIGwxbEkuYXBwZW5kKHdbbElsbF0pDQogICAgICAgIGVsaWYgKGxJbGwgPCBsZW4odykpOg0KICAgICAgICAgICAgbGwxbC5hcHBlbmQod1tsSWxsXSk7DQogICAgICAgIGxJbGwrPTE7DQogICAgICAgIGlmIChsbDFJIDwgNSk6DQogICAgICAgICAgICBsMWxJLmFwcGVuZChpW2xsMUldKQ0KICAgICAgICBlbGlmIChsbDFJIDwgbGVuKGkpKToNCiAgICAgICAgICAgIGxsMWwuYXBwZW5kKGlbbGwxSV0pDQogICAgICAgIGxsMUkrPTE7DQogICAgICAgIGlmIChJbDFsIDwgNSk6DQogICAgICAgICAgICBsMWxJLmFwcGVuZChzW0lsMWxdKQ0KICAgICAgICBlbGlmIChJbDFsIDwgbGVuKHMpKToNCiAgICAgICAgICAgIGxsMWwuYXBwZW5kKHNbSWwxbF0pOw0KICAgICAgICBJbDFsKz0xOw0KICAgICAgICBpZiAobGVuKHcpICsgbGVuKGkpICsgbGVuKHMpICsgbGVuKGUpID09IGxlbihsbDFsKSArIGxlbihsMWxJKSArIGxlbihlKSk6DQogICAgICAgICAgICBicmVhazsNCiAgICAgICAgDQogICAgbEkxbCA9ICcnLmpvaW4obGwxbCkjLmpvaW4oJycpOw0KICAgIEkxbEkgPSAnJy5qb2luKGwxbEkpIy5qb2luKCcnKTsNCiAgICBsbDFJID0gMDsNCiAgICBsMWxsID0gW107DQogICAgZm9yIGxJbGwgaW4gcmFuZ2UoMCxsZW4obGwxbCksMik6DQogICAgICAgICNwcmludCAnYXJyYXkgaScsbElsbCxsZW4obGwxbCkNCiAgICAgICAgbGwxMSA9IC0xOw0KICAgICAgICBpZiAoIG9yZChJMWxJW2xsMUldKSAlIDIpOg0KICAgICAgICAgICAgbGwxMSA9IDE7DQogICAgICAgICNwcmludCAndmFsIGlzICcsIGxJMWxbbElsbDogbElsbCsyXQ0KICAgICAgICBsMWxsLmFwcGVuZChjaHIoICAgIGludChsSTFsW2xJbGw6IGxJbGwrMl0sIDM2KSAtIGxsMTEpKTsNCiAgICAgICAgbGwxSSs9MTsNCiAgICAgICAgaWYgKGxsMUkgPj0gbGVuKGwxbEkpKToNCiAgICAgICAgICAgIGxsMUkgPSAwOw0KICAgIHJldD0nJy5qb2luKGwxbGwpDQogICAgaWYgJ2V2YWwoZnVuY3Rpb24odyxpLHMsZSknIGluIHJldDoNCiAgICAgICAgcHJpbnQgJ1NUSUxMIEdPaW5nJw0KICAgICAgICByZXQ9cmUuY29tcGlsZSgnZXZhbFwoZnVuY3Rpb25cKHcsaSxzLGVcKS4qfVwoKC4qPylcKScpLmZpbmRhbGwocmV0KVswXSANCiAgICAgICAgcmV0dXJuIGdldF91bndpc2UocmV0KQ0KICAgIGVsc2U6DQogICAgICAgIHByaW50ICdGSU5JU0hFRCcNCiAgICAgICAgcmV0dXJuIHJldA0KICAgIA0KZGVmIGdldF91bnBhY2tlZCggcGFnZV92YWx1ZSwgcmVnZXhfZm9yX3RleHQ9JycsIGl0ZXJhdGlvbnM9MSwgdG90YWxfaXRlcmF0aW9uPTEpOg0KICAgIHRyeTogICAgICAgIA0KICAgICAgICByZWdfZGF0YT1Ob25lDQogICAgICAgIGlmIHBhZ2VfdmFsdWUuc3RhcnRzd2l0aCgiaHR0cCIpOg0KICAgICAgICAgICAgcGFnZV92YWx1ZT0gZ2V0VXJsKHBhZ2VfdmFsdWUpDQogICAgICAgIHByaW50ICdwYWdlX3ZhbHVlJyxwYWdlX3ZhbHVlDQogICAgICAgIGlmIHJlZ2V4X2Zvcl90ZXh0IGFuZCBsZW4ocmVnZXhfZm9yX3RleHQpPjA6DQogICAgICAgICAgICBwYWdlX3ZhbHVlPXJlLmNvbXBpbGUocmVnZXhfZm9yX3RleHQpLmZpbmRhbGwocGFnZV92YWx1ZSlbMF0gI2dldCB0aGUganMgdmFyaWFibGUNCiAgICAgICAgDQogICAgICAgIHBhZ2VfdmFsdWU9dW5wYWNrKHBhZ2VfdmFsdWUsaXRlcmF0aW9ucyx0b3RhbF9pdGVyYXRpb24pDQogICAgZXhjZXB0OiB0cmFjZWJhY2sucHJpbnRfZXhjKGZpbGU9c3lzLnN0ZG91dCkNCiAgICBwcmludCAndW5wYWNrZWQnLHBhZ2VfdmFsdWUNCiAgICBpZiAnc2F2MWxpdmUudHYnIGluIHBhZ2VfdmFsdWU6DQogICAgICAgIHBhZ2VfdmFsdWU9cGFnZV92YWx1ZS5yZXBsYWNlKCdzYXYxbGl2ZS50dicsJ3Nhd2xpdmUudHYnKSAjcXVpY2sgZml4IHNvbWUgYnVnIHNvbWV3aGVyZQ0KICAgICAgICBwcmludCAnc2F2MSB1bnBhY2tlZCcscGFnZV92YWx1ZQ0KICAgIHJldHVybiBwYWdlX3ZhbHVlDQoNCmRlZiB1bnBhY2soc0phdmFzY3JpcHQsaXRlcmF0aW9uPTEsIHRvdGFsaXRlcmF0aW9ucz0yICApOg0KICAgIHByaW50ICdpdGVyYXRpb24nLGl0ZXJhdGlvbg0KICAgIGlmIHNKYXZhc2NyaXB0LnN0YXJ0c3dpdGgoJ3ZhciBfMHhjYjhhPScpOg0KICAgICAgICBhU3BsaXQ9c0phdmFzY3JpcHQuc3BsaXQoJ3ZhciBfMHhjYjhhPScpDQogICAgICAgIHNzPSJteWFycmF5PSIrYVNwbGl0WzFdLnNwbGl0KCJldmFsKCIpWzBdDQogICAgICAgIGV4ZWMoc3MpDQogICAgICAgIGExPTYyDQogICAgICAgIGMxPWludChhU3BsaXRbMV0uc3BsaXQoIiw2MiwiKVsxXS5zcGxpdCgnLCcpWzBdKQ0KICAgICAgICBwMT1teWFycmF5WzBdDQogICAgICAgIGsxPW15YXJyYXlbM10NCiAgICAgICAgd2l0aCBvcGVuKCd0ZW1wIGZpbGUnK3N0cihpdGVyYXRpb24pKycuanMnLCAid2IiKSBhcyBmaWxld3JpdGVyOg0KICAgICAgICAgICAgZmlsZXdyaXRlci53cml0ZShzdHIoazEpKQ0KICAgICAgICAjYWE9MS8wDQogICAgZWxzZToNCg0KICAgICAgICBhU3BsaXQgPSBzSmF2YXNjcmlwdC5zcGxpdCgicm4gcH0oJyIpDQogICAgICAgIHByaW50IGFTcGxpdA0KICAgICAgICANCiAgICAgICAgcDEsYTEsYzEsazE9KCcnLCcwJywnMCcsJycpDQogICAgIA0KICAgICAgICBzcz0icDEsYTEsYzEsazE9KCciK2FTcGxpdFsxXS5zcGxpdCgiLnNwbGkiKVswXSsnKScgDQogICAgICAgIGV4ZWMoc3MpDQogICAgazE9azEuc3BsaXQoJ3wnKQ0KICAgIGFTcGxpdCA9IGFTcGxpdFsxXS5zcGxpdCgiKSknIikNCiMgICAgcHJpbnQgJyBwIGFycmF5IGlzICcsbGVuKGFTcGxpdCkNCiMgICBwcmludCBsZW4oYVNwbGl0ICkNCg0KICAgICNwPXN0cihhU3BsaXRbMF0rJykpJykjLnJlcGxhY2UoIlxcIiwiIikjLnJlcGxhY2UoJ1xcXFwnLCdcXCcpDQoNCiAgICAjcHJpbnQgYVNwbGl0WzFdDQogICAgI2FTcGxpdCA9IGFTcGxpdFsxXS5zcGxpdCgiLCIpDQogICAgI3ByaW50IGFTcGxpdFswXSANCiAgICAjYSA9IGludChhU3BsaXRbMV0pDQogICAgI2MgPSBpbnQoYVNwbGl0WzJdKQ0KICAgICNrID0gYVNwbGl0WzNdLnNwbGl0KCIuIilbMF0ucmVwbGFjZSgiJyIsICcnKS5zcGxpdCgnfCcpDQogICAgI2E9aW50KGEpDQogICAgI2M9aW50KGMpDQogICAgDQogICAgI3A9cC5yZXBsYWNlKCdcXCcsICcnKQ0KIyAgICBwcmludCAncCB2YWwgaXMgJyxwWzA6MTAwXSwnLi4uLi4uLi4uLi4uJyxwWy0xMDA6XSxsZW4ocCkNCiMgICAgcHJpbnQgJ3AxIHZhbCBpcyAnLHAxWzA6MTAwXSwnLi4uLi4uLi4uLi4uJyxwMVstMTAwOl0sbGVuKHAxKQ0KICAgIA0KICAgICNwcmludCBhLGExDQogICAgI3ByaW50IGMsYTENCiAgICAjcHJpbnQgJ2sgdmFsIGlzICcsa1stMTA6XSxsZW4oaykNCiMgICAgcHJpbnQgJ2sxIHZhbCBpcyAnLGsxWy0xMDpdLGxlbihrMSkNCiAgICBlID0gJycNCiAgICBkID0gJycjMzI4MjMNCg0KICAgICNzVW5wYWNrZWQgPSBzdHIoX191bnBhY2socCwgYSwgYywgaywgZSwgZCkpDQogICAgc1VucGFja2VkMSA9IHN0cihfX3VucGFjayhwMSwgYTEsIGMxLCBrMSwgZSwgZCxpdGVyYXRpb24pKQ0KICAgIA0KICAgICNwcmludCBzVW5wYWNrZWRbOjIwMF0rJy4uLi4nK3NVbnBhY2tlZFstMTAwOl0sIGxlbihzVW5wYWNrZWQpDQojICAgIHByaW50IHNVbnBhY2tlZDFbOjIwMF0rJy4uLi4nK3NVbnBhY2tlZDFbLTEwMDpdLCBsZW4oc1VucGFja2VkMSkNCiAgICANCiAgICAjZXhlYygnc1VucGFja2VkMT0iJytzVW5wYWNrZWQxKyciJykNCiAgICBpZiBpdGVyYXRpb24+PXRvdGFsaXRlcmF0aW9uczoNCiMgICAgICAgIHByaW50ICdmaW5hbCByZXMnLHNVbnBhY2tlZDFbOjIwMF0rJy4uLi4nK3NVbnBhY2tlZDFbLTEwMDpdLCBsZW4oc1VucGFja2VkMSkNCiAgICAgICAgcmV0dXJuIHNVbnBhY2tlZDEjLnJlcGxhY2UoJ1xcXFwnLCAnXFwnKQ0KICAgIGVsc2U6DQojICAgICAgICBwcmludCAnZmluYWwgcmVzIGZvciB0aGlzIGl0ZXJhdGlvbiBpcycsaXRlcmF0aW9uDQogICAgICAgIHJldHVybiB1bnBhY2soc1VucGFja2VkMSxpdGVyYXRpb24rMSkjLnJlcGxhY2UoJ1xcJywgJycpLGl0ZXJhdGlvbikjLnJlcGxhY2UoJ1xcJywgJycpOyN1bnBhY2soc1VucGFja2VkLnJlcGxhY2UoJ1xcJywgJycpKQ0KDQpkZWYgX191bnBhY2socCwgYSwgYywgaywgZSwgZCwgaXRlcmF0aW9uLHY9MSk6DQoNCiAgICAjd2l0aCBvcGVuKCdiZWZvcmUgZmlsZScrc3RyKGl0ZXJhdGlvbikrJy5qcycsICJ3YiIpIGFzIGZpbGV3cml0ZXI6DQogICAgIyAgICBmaWxld3JpdGVyLndyaXRlKHN0cihwKSkNCiAgICB3aGlsZSAoYyA+PSAxKToNCiAgICAgICAgYyA9IGMgLTENCiAgICAgICAgaWYgKGtbY10pOg0KICAgICAgICAgICAgYWE9c3RyKF9faXRvYU5ldyhjLCBhKSkNCiAgICAgICAgICAgIGlmIHY9PTE6DQogICAgICAgICAgICAgICAgcD1yZS5zdWIoJ1xcYicgKyBhYSArJ1xcYicsIGtbY10sIHApIyBUSElTIElTIEJsb29keSBzbG93IQ0KICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICBwPWZpbmRBbmRSZXBsYWNlV29yZChwLGFhLGtbY10pDQoNCiAgICAgICAgICAgICNwPWZpbmRBbmRSZXBsYWNlV29yZChwLGFhLGtbY10pDQoNCiAgICAgICAgICAgIA0KICAgICN3aXRoIG9wZW4oJ2FmdGVyIGZpbGUnK3N0cihpdGVyYXRpb24pKycuanMnLCAid2IiKSBhcyBmaWxld3JpdGVyOg0KICAgICMgICAgZmlsZXdyaXRlci53cml0ZShzdHIocCkpDQogICAgcmV0dXJuIHANCg0KIw0KI2Z1bmN0aW9uIGVxdWFsYXZlbnQgdG8gcmUuc3ViKCdcXGInICsgYWEgKydcXGInLCBrW2NdLCBwKQ0KZGVmIGZpbmRBbmRSZXBsYWNlV29yZChzb3VyY2Vfc3RyLCB3b3JkX3RvX2ZpbmQscmVwbGFjZV93aXRoKToNCiAgICBzcGxpdHM9Tm9uZQ0KICAgIHNwbGl0cz1zb3VyY2Vfc3RyLnNwbGl0KHdvcmRfdG9fZmluZCkNCiAgICBpZiBsZW4oc3BsaXRzKT4xOg0KICAgICAgICBuZXdfc3RyaW5nPVtdDQogICAgICAgIGN1cnJlbnRfaW5kZXg9MA0KICAgICAgICBmb3IgY3VycmVudF9zcGxpdCBpbiBzcGxpdHM6DQogICAgICAgICAgICAjcHJpbnQgJ2hlcmUnLGkNCiAgICAgICAgICAgIG5ld19zdHJpbmcuYXBwZW5kKGN1cnJlbnRfc3BsaXQpDQogICAgICAgICAgICB2YWw9d29yZF90b19maW5kI2J5IGRlZmF1bHQgYXNzdW1lIGl0IHdhcyB3cm9uZyB0byBzcGxpdA0KDQogICAgICAgICAgICAjaWYgaXRzIGZpcnN0IG9uZSBhbmQgaXRlbSBpcyBibGFuayB0aGVuIGNoZWNrIG5leHQgaXRlbSBpcyB2YWxpZCBvciBub3QNCiAgICAgICAgICAgIGlmIGN1cnJlbnRfaW5kZXg9PWxlbihzcGxpdHMpLTE6DQogICAgICAgICAgICAgICAgdmFsPScnICMgbGFzdCBvbmUgbm90aGluZyB0byBhcHBlbmQgbm9ybWFsbHkNCiAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgaWYgbGVuKGN1cnJlbnRfc3BsaXQpPT0wOiAjaWYgYmxhbmsgY2hlY2sgbmV4dCBvbmUgd2l0aCBjdXJyZW50IHNwbGl0IHZhbHVlDQogICAgICAgICAgICAgICAgICAgIGlmICggbGVuKHNwbGl0c1tjdXJyZW50X2luZGV4KzFdKT09MCBhbmQgd29yZF90b19maW5kWzBdLmxvd2VyKCkgbm90IGluICdhYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5ejEyMzQ1Njc4OTBfJykgb3IgKGxlbihzcGxpdHNbY3VycmVudF9pbmRleCsxXSk+MCAgYW5kIHNwbGl0c1tjdXJyZW50X2luZGV4KzFdWzBdLmxvd2VyKCkgbm90IGluICdhYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5ejEyMzQ1Njc4OTBfJyk6IyBmaXJzdCBqdXN0IGp1c3QgY2hlY2sgbmV4dA0KICAgICAgICAgICAgICAgICAgICAgICAgdmFsPXJlcGxhY2Vfd2l0aA0KICAgICAgICAgICAgICAgICNub3QgYmxhbmssIHRoZW4gY2hlY2sgY3VycmVudCBlbmR2YWx1ZSBhbmQgbmV4dCBmaXJzdCB2YWx1ZQ0KICAgICAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgICAgIGlmIChzcGxpdHNbY3VycmVudF9pbmRleF1bLTFdLmxvd2VyKCkgbm90IGluICdhYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5ejEyMzQ1Njc4OTBfJykgYW5kICgoIGxlbihzcGxpdHNbY3VycmVudF9pbmRleCsxXSk9PTAgYW5kIHdvcmRfdG9fZmluZFswXS5sb3dlcigpIG5vdCBpbiAnYWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXoxMjM0NTY3ODkwXycpIG9yIChsZW4oc3BsaXRzW2N1cnJlbnRfaW5kZXgrMV0pPjAgIGFuZCBzcGxpdHNbY3VycmVudF9pbmRleCsxXVswXS5sb3dlcigpIG5vdCBpbiAnYWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXoxMjM0NTY3ODkwXycpKTojIGZpcnN0IGp1c3QganVzdCBjaGVjayBuZXh0DQogICAgICAgICAgICAgICAgICAgICAgICB2YWw9cmVwbGFjZV93aXRoDQogICAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgIG5ld19zdHJpbmcuYXBwZW5kKHZhbCkNCiAgICAgICAgICAgIGN1cnJlbnRfaW5kZXgrPTENCiAgICAgICAgI2FhYWE9MS8wDQogICAgICAgIHNvdXJjZV9zdHI9Jycuam9pbihuZXdfc3RyaW5nKQ0KICAgIHJldHVybiBzb3VyY2Vfc3RyICAgICAgICANCg0KZGVmIF9faXRvYShudW0sIHJhZGl4KToNCiMgICAgcHJpbnQgJ251bSByZWQnLG51bSwgcmFkaXgNCiAgICByZXN1bHQgPSAiIg0KICAgIGlmIG51bT09MDogcmV0dXJuICcwJw0KICAgIHdoaWxlIG51bSA+IDA6DQogICAgICAgIHJlc3VsdCA9ICIwMTIzNDU2Nzg5YWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXoiW251bSAlIHJhZGl4XSArIHJlc3VsdA0KICAgICAgICBudW0gLz0gcmFkaXgNCiAgICByZXR1cm4gcmVzdWx0DQoJDQpkZWYgX19pdG9hTmV3KGNjLCBhKToNCiAgICBhYT0iIiBpZiBjYyA8IGEgZWxzZSBfX2l0b2FOZXcoaW50KGNjIC8gYSksYSkgDQogICAgY2MgPSAoY2MgJSBhKQ0KICAgIGJiPWNocihjYyArIDI5KSBpZiBjYz4gMzUgZWxzZSBzdHIoX19pdG9hKGNjLDM2KSkNCiAgICByZXR1cm4gYWErYmINCg0KDQpkZWYgZ2V0Q29va2llc1N0cmluZyhjb29raWVKYXIpOg0KICAgIHRyeToNCiAgICAgICAgY29va2llU3RyaW5nPSIiDQogICAgICAgIGZvciBpbmRleCwgY29va2llIGluIGVudW1lcmF0ZShjb29raWVKYXIpOg0KICAgICAgICAgICAgY29va2llU3RyaW5nKz1jb29raWUubmFtZSArICI9IiArIGNvb2tpZS52YWx1ZSArIjsiDQogICAgZXhjZXB0OiBwYXNzDQogICAgI3ByaW50ICdjb29raWVTdHJpbmcnLGNvb2tpZVN0cmluZw0KICAgIHJldHVybiBjb29raWVTdHJpbmcNCg0KDQpkZWYgc2F2ZUNvb2tpZUphcihjb29raWVKYXIsQ09PS0lFRklMRSk6DQoJdHJ5Og0KCQljb21wbGV0ZV9wYXRoPW9zLnBhdGguam9pbihwcm9maWxlLENPT0tJRUZJTEUpDQoJCWNvb2tpZUphci5zYXZlKGNvbXBsZXRlX3BhdGgsaWdub3JlX2Rpc2NhcmQ9VHJ1ZSkNCglleGNlcHQ6IHBhc3MNCg0KZGVmIGdldENvb2tpZUphcihDT09LSUVGSUxFKToNCg0KCWNvb2tpZUphcj1Ob25lDQoJaWYgQ09PS0lFRklMRToNCgkJdHJ5Og0KCQkJY29tcGxldGVfcGF0aD1vcy5wYXRoLmpvaW4ocHJvZmlsZSxDT09LSUVGSUxFKQ0KCQkJY29va2llSmFyID0gY29va2llbGliLkxXUENvb2tpZUphcigpDQoJCQljb29raWVKYXIubG9hZChjb21wbGV0ZV9wYXRoLGlnbm9yZV9kaXNjYXJkPVRydWUpDQoJCWV4Y2VwdDogDQoJCQljb29raWVKYXI9Tm9uZQ0KCQ0KCWlmIG5vdCBjb29raWVKYXI6DQoJCWNvb2tpZUphciA9IGNvb2tpZWxpYi5MV1BDb29raWVKYXIoKQ0KCQ0KCXJldHVybiBjb29raWVKYXINCiAgICANCmRlZiBkb0V2YWwoZnVuX2NhbGwscGFnZV9kYXRhLENvb2tpZV9KYXIpOg0KICAgIHJldF92YWw9JycNCiAgICBpZiBmdW5jdGlvbnNfZGlyIG5vdCBpbiBzeXMucGF0aDoNCiAgICAgICAgc3lzLnBhdGguYXBwZW5kKGZ1bmN0aW9uc19kaXIpDQogICAgDQogICAgcHJpbnQgZnVuX2NhbGwNCiAgICB0cnk6DQogICAgICAgIHB5X2ZpbGU9J2ltcG9ydCAnK2Z1bl9jYWxsLnNwbGl0KCcuJylbMF0NCiAgICAgICAgcHJpbnQgcHlfZmlsZSxzeXMucGF0aA0KICAgICAgICBleGVjKCBweV9maWxlKQ0KICAgICAgICBwcmludCAnZG9uZScNCiAgICBleGNlcHQ6DQogICAgICAgIHByaW50ICdlcnJvciBpbiBpbXBvcnQnDQogICAgICAgIHRyYWNlYmFjay5wcmludF9leGMoZmlsZT1zeXMuc3Rkb3V0KQ0KICAgIHByaW50ICdyZXRfdmFsPScrZnVuX2NhbGwNCiAgICBleGVjICgncmV0X3ZhbD0nK2Z1bl9jYWxsKQ0KICAgIHByaW50IHJldF92YWwNCiAgICAjZXhlYygncmV0X3ZhbD0xKzEnKQ0KICAgIHJldHVybiBzdHIocmV0X3ZhbCkNCiAgICANCmRlZiBwcm9jZXNzUmVjYXB0Y2hhKHVybCk6DQoJaHRtbF90ZXh0PWdldFVybCh1cmwpDQoJcmVjYXBDaGFsbGVuZ2U9IiINCglzb2x1dGlvbj0iIg0KCWNhcF9yZWc9IjxzY3JpcHQuKj9zcmM9XCIoLio/cmVjYXAuKj8pXCIiDQoJbWF0Y2ggPXJlLmZpbmRhbGwoY2FwX3JlZywgaHRtbF90ZXh0KQ0KCWNhcHRjaGE9RmFsc2UNCgljYXB0Y2hhX3JlbG9hZF9yZXNwb25zZV9jaGFsbD1Ob25lDQoJc29sdXRpb249Tm9uZQ0KCQ0KCWlmIG1hdGNoIGFuZCBsZW4obWF0Y2gpPjA6ICNuZXcgc2hpbnkgY2FwdGNoYSENCgkJY2FwdGNoYV91cmw9bWF0Y2hbMF0NCgkJY2FwdGNoYT1UcnVlDQoJCQ0KCQljYXBfY2hhbGxfcmVnPSdjaGFsbGVuZ2UuKj9cJyguKj8pXCcnDQoJCWNhcF9pbWFnZV9yZWc9J1wnKC4qPylcJycNCgkJY2FwdGNoYV9zY3JpcHQ9Z2V0VXJsKGNhcHRjaGFfdXJsKQ0KCQlyZWNhcENoYWxsZW5nZT1yZS5maW5kYWxsKGNhcF9jaGFsbF9yZWcsIGNhcHRjaGFfc2NyaXB0KVswXQ0KCQljYXB0Y2hhX3JlbG9hZD0naHR0cDovL3d3dy5nb29nbGUuY29tL3JlY2FwdGNoYS9hcGkvcmVsb2FkP2M9JzsNCgkJY2FwdGNoYV9rPWNhcHRjaGFfdXJsLnNwbGl0KCdrPScpWzFdDQoJCWNhcHRjaGFfcmVsb2FkKz1yZWNhcENoYWxsZW5nZSsnJms9JytjYXB0Y2hhX2srJyZjYXB0Y2hhX2s9MSZ0eXBlPWltYWdlJmxhbmc9ZW4tR0InDQoJCWNhcHRjaGFfcmVsb2FkX2pzPWdldFVybChjYXB0Y2hhX3JlbG9hZCkNCgkJY2FwdGNoYV9yZWxvYWRfcmVzcG9uc2VfY2hhbGw9cmUuZmluZGFsbChjYXBfaW1hZ2VfcmVnLCBjYXB0Y2hhX3JlbG9hZF9qcylbMF0NCgkJY2FwdGNoYV9pbWFnZV91cmw9J2h0dHA6Ly93d3cuZ29vZ2xlLmNvbS9yZWNhcHRjaGEvYXBpL2ltYWdlP2M9JytjYXB0Y2hhX3JlbG9hZF9yZXNwb25zZV9jaGFsbA0KCQlpZiBub3QgY2FwdGNoYV9pbWFnZV91cmwuc3RhcnRzd2l0aCgiaHR0cCIpOg0KCQkJY2FwdGNoYV9pbWFnZV91cmw9J2h0dHA6Ly93d3cuZ29vZ2xlLmNvbS9yZWNhcHRjaGEvYXBpLycrY2FwdGNoYV9pbWFnZV91cmwNCgkJaW1wb3J0IHJhbmRvbQ0KCQluPXJhbmRvbS5yYW5kcmFuZ2UoMTAwLDEwMDAsNSkNCgkJbG9jYWxfY2FwdGNoYSA9IG9zLnBhdGguam9pbihwcm9maWxlLHN0cihuKSArImNhcHRjaGEuaW1nIiApDQoJCWxvY2FsRmlsZSA9IG9wZW4obG9jYWxfY2FwdGNoYSwgIndiIikNCgkJbG9jYWxGaWxlLndyaXRlKGdldFVybChjYXB0Y2hhX2ltYWdlX3VybCkpDQoJCWxvY2FsRmlsZS5jbG9zZSgpDQoJCXNvbHZlciA9IElucHV0V2luZG93KGNhcHRjaGE9bG9jYWxfY2FwdGNoYSkNCgkJc29sdXRpb24gPSBzb2x2ZXIuZ2V0KCkNCgkJb3MucmVtb3ZlKGxvY2FsX2NhcHRjaGEpDQoJcmV0dXJuIGNhcHRjaGFfcmVsb2FkX3Jlc3BvbnNlX2NoYWxsICxzb2x1dGlvbg0KDQpkZWYgZ2V0VXJsKHVybCwgY29va2llSmFyPU5vbmUscG9zdD1Ob25lLCB0aW1lb3V0PTIwLCBoZWFkZXJzPU5vbmUpOg0KDQoNCgljb29raWVfaGFuZGxlciA9IHVybGxpYjIuSFRUUENvb2tpZVByb2Nlc3Nvcihjb29raWVKYXIpDQoJb3BlbmVyID0gdXJsbGliMi5idWlsZF9vcGVuZXIoY29va2llX2hhbmRsZXIsIHVybGxpYjIuSFRUUEJhc2ljQXV0aEhhbmRsZXIoKSwgdXJsbGliMi5IVFRQSGFuZGxlcigpKQ0KCSNvcGVuZXIgPSB1cmxsaWIyLmluc3RhbGxfb3BlbmVyKG9wZW5lcikNCglyZXEgPSB1cmxsaWIyLlJlcXVlc3QodXJsKQ0KCXJlcS5hZGRfaGVhZGVyKCdVc2VyLUFnZW50JywnTW96aWxsYS81LjAgKFdpbmRvd3MgTlQgNi4xOyBXT1c2NCkgQXBwbGVXZWJLaXQvNTM3LjM2IChLSFRNTCwgbGlrZSBHZWNrbykgQ2hyb21lLzMzLjAuMTc1MC4xNTQgU2FmYXJpLzUzNy4zNicpDQoJaWYgaGVhZGVyczoNCgkJZm9yIGgsaHYgaW4gaGVhZGVyczoNCgkJCXJlcS5hZGRfaGVhZGVyKGgsaHYpDQoNCglyZXNwb25zZSA9IG9wZW5lci5vcGVuKHJlcSxwb3N0LHRpbWVvdXQ9dGltZW91dCkNCglsaW5rPXJlc3BvbnNlLnJlYWQoKQ0KCXJlc3BvbnNlLmNsb3NlKCkNCglyZXR1cm4gbGluazsNCg0KZGVmIGdldF9kZWNvZGUoc3RyLHJlZz1Ob25lKToNCglpZiByZWc6DQoJCXN0cj1yZS5maW5kYWxsKHJlZywgc3RyKVswXQ0KCXMxID0gdXJsbGliLnVucXVvdGUoc3RyWzA6IGxlbihzdHIpLTFdKTsNCgl0ID0gJyc7DQoJZm9yIGkgaW4gcmFuZ2UoIGxlbihzMSkpOg0KCQl0ICs9IGNocihvcmQoczFbaV0pIC0gczFbbGVuKHMxKS0xXSk7DQoJdD11cmxsaWIudW5xdW90ZSh0KQ0KCXByaW50IHQNCglyZXR1cm4gdA0KDQpkZWYgamF2YXNjcmlwdFVuRXNjYXBlKHN0cik6DQoJanM9cmUuZmluZGFsbCgndW5lc2NhcGVcKFwnKC4qPylcJycsc3RyKQ0KCXByaW50ICdqcycsanMNCglpZiAobm90IGpzPT1Ob25lKSBhbmQgbGVuKGpzKT4wOg0KCQlmb3IgaiBpbiBqczoNCgkJCSNwcmludCB1cmxsaWIudW5xdW90ZShqKQ0KCQkJc3RyPXN0ci5yZXBsYWNlKGogLHVybGxpYi51bnF1b3RlKGopKQ0KCXJldHVybiBzdHINCg0KaWlkPTANCmRlZiBhc2tDYXB0Y2hhKG0saHRtbF9wYWdlLCBjb29raWVKYXIpOg0KICAgIGdsb2JhbCBpaWQNCiAgICBpaWQrPTENCiAgICBleHByZT0gbVsnZXhwcmUnXQ0KICAgIHBhZ2VfdXJsID0gbVsncGFnZSddDQogICAgY2FwdGNoYV9yZWdleD1yZS5jb21waWxlKCdcJExpdmVTdHJlYW1DYXB0Y2hhXFsoW15cXV0qKVxdJykuZmluZGFsbChleHByZSlbMF0NCg0KICAgIGNhcHRjaGFfdXJsPXJlLmNvbXBpbGUoY2FwdGNoYV9yZWdleCkuZmluZGFsbChodG1sX3BhZ2UpWzBdDQogICAgcHJpbnQgZXhwcmUsY2FwdGNoYV9yZWdleCxjYXB0Y2hhX3VybA0KICAgIGlmIG5vdCBjYXB0Y2hhX3VybC5zdGFydHN3aXRoKCJodHRwIik6DQogICAgICAgIHBhZ2VfPSdodHRwOi8vJysiIi5qb2luKHBhZ2VfdXJsLnNwbGl0KCcvJylbMjozXSkNCiAgICAgICAgaWYgY2FwdGNoYV91cmwuc3RhcnRzd2l0aCgiLyIpOg0KICAgICAgICAgICAgY2FwdGNoYV91cmw9cGFnZV8rY2FwdGNoYV91cmwNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIGNhcHRjaGFfdXJsPXBhZ2VfKycvJytjYXB0Y2hhX3VybA0KICAgIA0KICAgIGxvY2FsX2NhcHRjaGEgPSBvcy5wYXRoLmpvaW4ocHJvZmlsZSwgc3RyKGlpZCkrImNhcHRjaGEuanBnIiApDQogICAgbG9jYWxGaWxlID0gb3Blbihsb2NhbF9jYXB0Y2hhLCAid2IiKQ0KICAgIHByaW50ICcgYyBjYXB1cmwnLGNhcHRjaGFfdXJsDQogICAgcmVxID0gdXJsbGliMi5SZXF1ZXN0KGNhcHRjaGFfdXJsKQ0KICAgIHJlcS5hZGRfaGVhZGVyKCdVc2VyLUFnZW50JywgJ01vemlsbGEvNS4wIChXaW5kb3dzIE5UIDYuMTsgcnY6MTQuMCkgR2Vja28vMjAxMDAxMDEgRmlyZWZveC8xNC4wLjEnKQ0KICAgIGlmICdyZWZlcicgaW4gbToNCiAgICAgICAgcmVxLmFkZF9oZWFkZXIoJ1JlZmVyZXInLCBtWydyZWZlciddKQ0KICAgIGlmICdhZ2VudCcgaW4gbToNCiAgICAgICAgcmVxLmFkZF9oZWFkZXIoJ1VzZXItYWdlbnQnLCBtWydhZ2VudCddKQ0KICAgIGlmICdzZXRjb29raWUnIGluIG06DQogICAgICAgIHByaW50ICdhZGRpbmcgY29va2llJyxtWydzZXRjb29raWUnXQ0KICAgICAgICByZXEuYWRkX2hlYWRlcignQ29va2llJywgbVsnc2V0Y29va2llJ10pDQogICAgICAgIA0KICAgICNjb29raWVfaGFuZGxlciA9IHVybGxpYjIuSFRUUENvb2tpZVByb2Nlc3Nvcihjb29raWVKYXIpDQogICAgI29wZW5lciA9IHVybGxpYjIuYnVpbGRfb3BlbmVyKGNvb2tpZV9oYW5kbGVyLCB1cmxsaWIyLkhUVFBCYXNpY0F1dGhIYW5kbGVyKCksIHVybGxpYjIuSFRUUEhhbmRsZXIoKSkNCiAgICAjb3BlbmVyID0gdXJsbGliMi5pbnN0YWxsX29wZW5lcihvcGVuZXIpDQogICAgdXJsbGliMi51cmxvcGVuKHJlcSkNCiAgICByZXNwb25zZSA9IHVybGxpYjIudXJsb3BlbihyZXEpDQoNCiAgICBsb2NhbEZpbGUud3JpdGUocmVzcG9uc2UucmVhZCgpKQ0KICAgIHJlc3BvbnNlLmNsb3NlKCkNCiAgICBsb2NhbEZpbGUuY2xvc2UoKQ0KICAgIHNvbHZlciA9IElucHV0V2luZG93KGNhcHRjaGE9bG9jYWxfY2FwdGNoYSkNCiAgICBzb2x1dGlvbiA9IHNvbHZlci5nZXQoKQ0KICAgIHJldHVybiBzb2x1dGlvbg0KICAgIA0KY2xhc3MgSW5wdXRXaW5kb3coeGJtY2d1aS5XaW5kb3dEaWFsb2cpOg0KICAgIGRlZiBfX2luaXRfXyhzZWxmLCAqYXJncywgKiprd2FyZ3MpOg0KICAgICAgICBzZWxmLmNwdGxvYyA9IGt3YXJncy5nZXQoJ2NhcHRjaGEnKQ0KICAgICAgICBzZWxmLmltZyA9IHhibWNndWkuQ29udHJvbEltYWdlKDMzNSwzMCw2MjQsNjAsc2VsZi5jcHRsb2MpDQogICAgICAgIHNlbGYuYWRkQ29udHJvbChzZWxmLmltZykNCiAgICAgICAgc2VsZi5rYmQgPSB4Ym1jLktleWJvYXJkKCkNCg0KICAgIGRlZiBnZXQoc2VsZik6DQogICAgICAgIHNlbGYuc2hvdygpDQogICAgICAgIHRpbWUuc2xlZXAoMikgICAgICAgIA0KICAgICAgICBzZWxmLmtiZC5kb01vZGFsKCkNCiAgICAgICAgaWYgKHNlbGYua2JkLmlzQ29uZmlybWVkKCkpOg0KICAgICAgICAgICAgdGV4dCA9IHNlbGYua2JkLmdldFRleHQoKQ0KICAgICAgICAgICAgc2VsZi5jbG9zZSgpDQogICAgICAgICAgICByZXR1cm4gdGV4dA0KICAgICAgICBzZWxmLmNsb3NlKCkNCiAgICAgICAgcmV0dXJuIEZhbHNlDQogICAgDQpkZWYgZ2V0RXBvY1RpbWUoKToNCiAgICBpbXBvcnQgdGltZQ0KICAgIHJldHVybiBzdHIoaW50KHRpbWUudGltZSgpKjEwMDApKQ0KDQpkZWYgZ2V0RXBvY1RpbWUyKCk6DQogICAgaW1wb3J0IHRpbWUNCiAgICByZXR1cm4gc3RyKGludCh0aW1lLnRpbWUoKSkpDQoNCmRlZiBnZXRfcGFyYW1zKCk6DQogICAgICAgIHBhcmFtPVtdDQogICAgICAgIHBhcmFtc3RyaW5nPXN5cy5hcmd2WzJdDQogICAgICAgIGlmIGxlbihwYXJhbXN0cmluZyk+PTI6DQogICAgICAgICAgICBwYXJhbXM9c3lzLmFyZ3ZbMl0NCiAgICAgICAgICAgIGNsZWFuZWRwYXJhbXM9cGFyYW1zLnJlcGxhY2UoJz8nLCcnKQ0KICAgICAgICAgICAgaWYgKHBhcmFtc1tsZW4ocGFyYW1zKS0xXT09Jy8nKToNCiAgICAgICAgICAgICAgICBwYXJhbXM9cGFyYW1zWzA6bGVuKHBhcmFtcyktMl0NCiAgICAgICAgICAgIHBhaXJzb2ZwYXJhbXM9Y2xlYW5lZHBhcmFtcy5zcGxpdCgnJicpDQogICAgICAgICAgICBwYXJhbT17fQ0KICAgICAgICAgICAgZm9yIGkgaW4gcmFuZ2UobGVuKHBhaXJzb2ZwYXJhbXMpKToNCiAgICAgICAgICAgICAgICBzcGxpdHBhcmFtcz17fQ0KICAgICAgICAgICAgICAgIHNwbGl0cGFyYW1zPXBhaXJzb2ZwYXJhbXNbaV0uc3BsaXQoJz0nKQ0KICAgICAgICAgICAgICAgIGlmIChsZW4oc3BsaXRwYXJhbXMpKT09MjoNCiAgICAgICAgICAgICAgICAgICAgcGFyYW1bc3BsaXRwYXJhbXNbMF1dPXNwbGl0cGFyYW1zWzFdDQogICAgICAgIHJldHVybiBwYXJhbQ0KDQoNCmRlZiBnZXRGYXZvcml0ZXMoKToNCiAgICAgICAgaXRlbXMgPSBqc29uLmxvYWRzKG9wZW4oZmF2b3JpdGVzKS5yZWFkKCkpDQogICAgICAgIHRvdGFsID0gbGVuKGl0ZW1zKQ0KICAgICAgICBmb3IgaSBpbiBpdGVtczoNCiAgICAgICAgICAgIG5hbWUgPSBpWzBdDQogICAgICAgICAgICB1cmwgPSBpWzFdDQogICAgICAgICAgICBpY29uaW1hZ2UgPSBpWzJdDQogICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgZmFuQXJ0ID0gaVszXQ0KICAgICAgICAgICAgICAgIGlmIGZhbkFydCA9PSBOb25lOg0KICAgICAgICAgICAgICAgICAgICByYWlzZQ0KICAgICAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgICAgIGlmIGFkZG9uLmdldFNldHRpbmcoJ3VzZV90aHVtYicpID09ICJ0cnVlIjoNCiAgICAgICAgICAgICAgICAgICAgZmFuQXJ0ID0gaWNvbmltYWdlDQogICAgICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICAgICAgZmFuQXJ0ID0gZmFuYXJ0DQogICAgICAgICAgICB0cnk6IHBsYXlsaXN0ID0gaVs1XQ0KICAgICAgICAgICAgZXhjZXB0OiBwbGF5bGlzdCA9IE5vbmUNCiAgICAgICAgICAgIHRyeTogcmVnZXhzID0gaVs2XQ0KICAgICAgICAgICAgZXhjZXB0OiByZWdleHMgPSBOb25lDQoNCiAgICAgICAgICAgIGlmIGlbNF0gPT0gMDoNCiAgICAgICAgICAgICAgICBhZGRMaW5rKHVybCxuYW1lLGljb25pbWFnZSxmYW5BcnQsJycsJycsJycsJ2ZhdicscGxheWxpc3QscmVnZXhzLHRvdGFsKQ0KICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICBhZGREaXIobmFtZSx1cmwsaVs0XSxpY29uaW1hZ2UsZmFuYXJ0LCcnLCcnLCcnLCcnLCdmYXYnKQ0KDQoNCmRlZiBhZGRGYXZvcml0ZShuYW1lLHVybCxpY29uaW1hZ2UsZmFuYXJ0LG1vZGUscGxheWxpc3Q9Tm9uZSxyZWdleHM9Tm9uZSk6DQogICAgICAgIGZhdkxpc3QgPSBbXQ0KICAgICAgICBpZiBub3Qgb3MucGF0aC5leGlzdHMoZmF2b3JpdGVzICsgJ3R4dCcpOg0KICAgICAgICAgICAgb3MubWFrZWRpcnMoZmF2b3JpdGVzICsgJ3R4dCcpDQogICAgICAgIGlmIG5vdCBvcy5wYXRoLmV4aXN0cyhoaXN0b3J5KToNCiAgICAgICAgICAgIG9zLm1ha2VkaXJzKGhpc3RvcnkpDQogICAgICAgIHRyeToNCiAgICAgICAgICAgICMgc2VlbXMgdGhhdCBhZnRlcg0KICAgICAgICAgICAgbmFtZSA9IG5hbWUuZW5jb2RlKCd1dGYtOCcsICdpZ25vcmUnKQ0KICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICBwYXNzDQogICAgICAgIGlmIG9zLnBhdGguZXhpc3RzKGZhdm9yaXRlcyk9PUZhbHNlOg0KICAgICAgICAgICAgYWRkb25fbG9nKCdNYWtpbmcgRmF2b3JpdGVzIEZpbGUnKQ0KICAgICAgICAgICAgZmF2TGlzdC5hcHBlbmQoKG5hbWUsdXJsLGljb25pbWFnZSxmYW5hcnQsbW9kZSxwbGF5bGlzdCxyZWdleHMpKQ0KICAgICAgICAgICAgYSA9IG9wZW4oZmF2b3JpdGVzLCAidyIpDQogICAgICAgICAgICBhLndyaXRlKGpzb24uZHVtcHMoZmF2TGlzdCkpDQogICAgICAgICAgICBhLmNsb3NlKCkNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIGFkZG9uX2xvZygnQXBwZW5kaW5nIEZhdm9yaXRlcycpDQogICAgICAgICAgICBhID0gb3BlbihmYXZvcml0ZXMpLnJlYWQoKQ0KICAgICAgICAgICAgZGF0YSA9IGpzb24ubG9hZHMoYSkNCiAgICAgICAgICAgIGRhdGEuYXBwZW5kKChuYW1lLHVybCxpY29uaW1hZ2UsZmFuYXJ0LG1vZGUpKQ0KICAgICAgICAgICAgYiA9IG9wZW4oZmF2b3JpdGVzLCAidyIpDQogICAgICAgICAgICBiLndyaXRlKGpzb24uZHVtcHMoZGF0YSkpDQogICAgICAgICAgICBiLmNsb3NlKCkNCg0KDQpkZWYgcm1GYXZvcml0ZShuYW1lKToNCiAgICAgICAgZGF0YSA9IGpzb24ubG9hZHMob3BlbihmYXZvcml0ZXMpLnJlYWQoKSkNCiAgICAgICAgZm9yIGluZGV4IGluIHJhbmdlKGxlbihkYXRhKSk6DQogICAgICAgICAgICBpZiBkYXRhW2luZGV4XVswXT09bmFtZToNCiAgICAgICAgICAgICAgICBkZWwgZGF0YVtpbmRleF0NCiAgICAgICAgICAgICAgICBiID0gb3BlbihmYXZvcml0ZXMsICJ3IikNCiAgICAgICAgICAgICAgICBiLndyaXRlKGpzb24uZHVtcHMoZGF0YSkpDQogICAgICAgICAgICAgICAgYi5jbG9zZSgpDQogICAgICAgICAgICAgICAgYnJlYWsNCiAgICAgICAgeGJtYy5leGVjdXRlYnVpbHRpbigiWEJNQy5Db250YWluZXIuUmVmcmVzaCIpDQoNCmRlZiB1cmxzb2x2ZXIodXJsKToNCiAgICBpZiBhZGRvbi5nZXRTZXR0aW5nKCdVcGRhdGVjb21tb25yZXNvbHZlcnMnKSA9PSAndHJ1ZSc6DQogICAgICAgIGwgPSBvcy5wYXRoLmpvaW4oaG9tZSwnZ2VuZXNpc3Jlc29sdmVycy5weScpDQogICAgICAgIGlmIHhibWN2ZnMuZXhpc3RzKGwpOg0KICAgICAgICAgICAgb3MucmVtb3ZlKGwpDQoNCiAgICAgICAgZ2VuZXNpc191cmwgPSAnaHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL2xhbWJkYTgxL2xhbWJkYS1hZGRvbnMvbWFzdGVyL3BsdWdpbi52aWRlby5nZW5lc2lzL2NvbW1vbnJlc29sdmVycy5weScNCiAgICAgICAgdGg9IHVybGxpYi51cmxyZXRyaWV2ZShnZW5lc2lzX3VybCxsKQ0KICAgICAgICBhZGRvbi5zZXRTZXR0aW5nKCdVcGRhdGVjb21tb25yZXNvbHZlcnMnLCAnZmFsc2UnKQ0KICAgIHRyeToNCiAgICAgICAgaW1wb3J0IGdlbmVzaXNyZXNvbHZlcnMNCiAgICBleGNlcHQgRXhjZXB0aW9uOg0KICAgICAgICB4Ym1jLmV4ZWN1dGVidWlsdGluKCJYQk1DLk5vdGlmaWNhdGlvbihTa3luZXQsUGxlYXNlIGVuYWJsZSBVcGRhdGUgQ29tbW9ucmVzb2x2ZXJzIHRvIFBsYXkgaW4gU2V0dGluZ3MuIC0gLDEwMDAwKSIpDQoNCiAgICByZXNvbHZlZD1nZW5lc2lzcmVzb2x2ZXJzLmdldCh1cmwpLnJlc3VsdA0KICAgIGlmIHVybCA9PSByZXNvbHZlZCBvciByZXNvbHZlZCBpcyBOb25lOg0KICAgICAgICAjaW1wb3J0DQogICAgICAgIHhibWMuZXhlY3V0ZWJ1aWx0aW4oIlhCTUMuTm90aWZpY2F0aW9uKFNreW5ldCxJcyBGaW5kaW5nIFlvdXIgTGluayAtICw1MDAwKSIpDQogICAgICAgIGltcG9ydCByZXNvbHZldXJsDQogICAgICAgIGhvc3QgPSByZXNvbHZldXJsLkhvc3RlZE1lZGlhRmlsZSh1cmwpDQogICAgICAgIGlmIGhvc3Q6DQogICAgICAgICAgICByZXNvbHZlciA9IHJlc29sdmV1cmwucmVzb2x2ZSh1cmwpDQogICAgICAgICAgICByZXNvbHZlZCA9IHJlc29sdmVyDQogICAgaWYgcmVzb2x2ZWQgOg0KICAgICAgICBpZiBpc2luc3RhbmNlKHJlc29sdmVkLGxpc3QpOg0KICAgICAgICAgICAgZm9yIGsgaW4gcmVzb2x2ZWQ6DQogICAgICAgICAgICAgICAgcXVhbGl0eSA9IGFkZG9uLmdldFNldHRpbmcoJ3F1YWxpdHknKQ0KICAgICAgICAgICAgICAgIGlmIGtbJ3F1YWxpdHknXSA9PSAnSEQnICA6DQogICAgICAgICAgICAgICAgICAgIHJlc29sdmVyID0ga1sndXJsJ10NCiAgICAgICAgICAgICAgICAgICAgYnJlYWsNCiAgICAgICAgICAgICAgICBlbGlmIGtbJ3F1YWxpdHknXSA9PSAnU0QnIDoNCiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZXIgPSBrWyd1cmwnXQ0KICAgICAgICAgICAgICAgIGVsaWYga1sncXVhbGl0eSddID09ICcxMDgwcCcgYW5kIGFkZG9uLmdldFNldHRpbmcoJzEwODBwcXVhbGl0eScpID09ICd0cnVlJyA6DQogICAgICAgICAgICAgICAgICAgIHJlc29sdmVyID0ga1sndXJsJ10NCiAgICAgICAgICAgICAgICAgICAgYnJlYWsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJlc29sdmVyID0gcmVzb2x2ZWQNCiAgICByZXR1cm4gcmVzb2x2ZXINCmRlZiBwbGF5X3BsYXlsaXN0KG5hbWUsIG11X3BsYXlsaXN0KToNCiAgICAgICAgaW1wb3J0IHVybHBhcnNlDQogICAgICAgIGlmIGFkZG9uLmdldFNldHRpbmcoJ2Fza19wbGF5bGlzdF9pdGVtcycpID09ICd0cnVlJzoNCiAgICAgICAgICAgIG5hbWVzID0gW10NCiAgICAgICAgICAgIGZvciBpIGluIG11X3BsYXlsaXN0Og0KICAgICAgICAgICAgICAgIGRfbmFtZT11cmxwYXJzZS51cmxwYXJzZShpKS5uZXRsb2MNCiAgICAgICAgICAgICAgICBpZiBkX25hbWUgPT0gJyc6DQogICAgICAgICAgICAgICAgICAgIG5hbWVzLmFwcGVuZChuYW1lKQ0KICAgICAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgICAgIG5hbWVzLmFwcGVuZChkX25hbWUpDQogICAgICAgICAgICBkaWFsb2cgPSB4Ym1jZ3VpLkRpYWxvZygpDQogICAgICAgICAgICBpbmRleCA9IGRpYWxvZy5zZWxlY3QoJ0Nob29zZSBhIHZpZGVvIHNvdXJjZScsIG5hbWVzKQ0KICAgICAgICAgICAgaWYgaW5kZXggPj0gMDoNCiAgICAgICAgICAgICAgICBpZiAiJm1vZGU9MTkiIGluIG11X3BsYXlsaXN0W2luZGV4XToNCiAgICAgICAgICAgICAgICAgICAgeGJtYy5QbGF5ZXIoKS5wbGF5KHVybHNvbHZlcihtdV9wbGF5bGlzdFtpbmRleF0ucmVwbGFjZSgnJm1vZGU9MTknLCcnKSkpDQogICAgICAgICAgICAgICAgZWxpZiAiJGRvcmVnZXgiIGluIG11X3BsYXlsaXN0W2luZGV4XSA6DQoNCiAgICAgICAgICAgICAgICAgICAgc2VwYXRlID0gbXVfcGxheWxpc3RbaW5kZXhdLnNwbGl0KCcmcmVnZXhzPScpDQoNCiAgICAgICAgICAgICAgICAgICAgdXJsLHNldHJlc29sdmVkID0gZ2V0UmVnZXhQYXJzZWQoc2VwYXRlWzFdLCBzZXBhdGVbMF0pDQogICAgICAgICAgICAgICAgICAgIHhibWMuUGxheWVyKCkucGxheSh1cmwpDQogICAgICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICAgICAgdXJsID0gbXVfcGxheWxpc3RbaW5kZXhdDQogICAgICAgICAgICAgICAgICAgIHhibWMuUGxheWVyKCkucGxheSh1cmwpDQogICAgICAgIGVsc2U6DQogICAgICAgICAgICBwbGF5bGlzdCA9IHhibWMuUGxheUxpc3QoMSkgIyAxIG1lYW5zIHZpZGVvDQogICAgICAgICAgICBwbGF5bGlzdC5jbGVhcigpDQogICAgICAgICAgICBpdGVtID0gMA0KICAgICAgICAgICAgZm9yIGkgaW4gbXVfcGxheWxpc3Q6DQogICAgICAgICAgICAgICAgaXRlbSArPSAxDQogICAgICAgICAgICAgICAgaW5mbyA9IHhibWNndWkuTGlzdEl0ZW0oJyVzKSAlcycgJShzdHIoaXRlbSksbmFtZSkpDQogICAgICAgICAgICAgICAgcGxheWxpc3QuYWRkKGksIGluZm8pDQogICAgICAgICAgICAgICAgeGJtYy5leGVjdXRlYnVpbHRpbigncGxheWxpc3QucGxheW9mZnNldCh2aWRlbywwKScpDQoNCg0KZGVmIGRvd25sb2FkX2ZpbGUobmFtZSwgdXJsKToNCiAgICAgICAgaWYgYWRkb24uZ2V0U2V0dGluZygnc2F2ZV9sb2NhdGlvbicpID09ICIiOg0KICAgICAgICAgICAgeGJtYy5leGVjdXRlYnVpbHRpbigiWEJNQy5Ob3RpZmljYXRpb24oJ1NreW5ldCcsJ0Nob29zZSBhIGxvY2F0aW9uIHRvIHNhdmUgZmlsZXMuJywxNTAwMCwiK2ljb24rIikiKQ0KICAgICAgICAgICAgYWRkb24ub3BlblNldHRpbmdzKCkNCiAgICAgICAgcGFyYW1zID0geyd1cmwnOiB1cmwsICdkb3dubG9hZF9wYXRoJzogYWRkb24uZ2V0U2V0dGluZygnc2F2ZV9sb2NhdGlvbicpfQ0KICAgICAgICBkb3dubG9hZGVyLmRvd25sb2FkKG5hbWUsIHBhcmFtcykNCiAgICAgICAgZGlhbG9nID0geGJtY2d1aS5EaWFsb2coKQ0KICAgICAgICByZXQgPSBkaWFsb2cueWVzbm8oJ1NreW5ldCcsICdEbyB5b3Ugd2FudCB0byBhZGQgdGhpcyBmaWxlIGFzIGEgc291cmNlPycpDQogICAgICAgIGlmIHJldDoNCiAgICAgICAgICAgIGFkZFNvdXJjZShvcy5wYXRoLmpvaW4oYWRkb24uZ2V0U2V0dGluZygnc2F2ZV9sb2NhdGlvbicpLCBuYW1lKSkNCg0KDQpkZWYgYWRkRGlyKG5hbWUsdXJsLG1vZGUsaWNvbmltYWdlLGZhbmFydCxkZXNjcmlwdGlvbixnZW5yZSxkYXRlLGNyZWRpdHMsc2hvd2NvbnRleHQ9RmFsc2UpOg0KICAgICAgICANCiAgICAgICAgdT1zeXMuYXJndlswXSsiP3VybD0iK3VybGxpYi5xdW90ZV9wbHVzKHVybCkrIiZtb2RlPSIrc3RyKG1vZGUpKyImbmFtZT0iK3VybGxpYi5xdW90ZV9wbHVzKG5hbWUpKyImZmFuYXJ0PSIrdXJsbGliLnF1b3RlX3BsdXMoZmFuYXJ0KQ0KICAgICAgICBvaz1UcnVlDQogICAgICAgIGlmIGRhdGUgPT0gJyc6DQogICAgICAgICAgICBkYXRlID0gTm9uZQ0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgZGVzY3JpcHRpb24gKz0gJ1xuXG5EYXRlOiAlcycgJWRhdGUNCiAgICAgICAgbGl6PXhibWNndWkuTGlzdEl0ZW0obmFtZSwgaWNvbkltYWdlPSJEZWZhdWx0Rm9sZGVyLnBuZyIsIHRodW1ibmFpbEltYWdlPWljb25pbWFnZSkNCiAgICAgICAgbGl6LnNldEluZm8odHlwZT0iVmlkZW8iLCBpbmZvTGFiZWxzPXsgIlRpdGxlIjogbmFtZSwgIlBsb3QiOiBkZXNjcmlwdGlvbiwgIkdlbnJlIjogZ2VucmUsICJkYXRlYWRkZWQiOiBkYXRlLCAiY3JlZGl0cyI6IGNyZWRpdHMgfSkNCiAgICAgICAgbGl6LnNldFByb3BlcnR5KCJGYW5hcnRfSW1hZ2UiLCBmYW5hcnQpDQogICAgICAgIGlmIHNob3djb250ZXh0Og0KICAgICAgICAgICAgY29udGV4dE1lbnUgPSBbXQ0KICAgICAgICAgICAgaWYgc2hvd2NvbnRleHQgPT0gJ3NvdXJjZSc6DQogICAgICAgICAgICAgICAgaWYgbmFtZSBpbiBzdHIoU09VUkNFUyk6DQogICAgICAgICAgICAgICAgICAgIGNvbnRleHRNZW51LmFwcGVuZCgoJ1JlbW92ZSBmcm9tIFNvdXJjZXMnLCdYQk1DLlJ1blBsdWdpbiglcz9tb2RlPTgmbmFtZT0lcyknICUoc3lzLmFyZ3ZbMF0sIHVybGxpYi5xdW90ZV9wbHVzKG5hbWUpKSkpDQogICAgICAgICAgICBlbGlmIHNob3djb250ZXh0ID09ICdkb3dubG9hZCc6DQogICAgICAgICAgICAgICAgY29udGV4dE1lbnUuYXBwZW5kKCgnRG93bmxvYWQnLCdYQk1DLlJ1blBsdWdpbiglcz91cmw9JXMmbW9kZT05Jm5hbWU9JXMpJw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJShzeXMuYXJndlswXSwgdXJsbGliLnF1b3RlX3BsdXModXJsKSwgdXJsbGliLnF1b3RlX3BsdXMobmFtZSkpKSkNCiAgICAgICAgICAgIGVsaWYgc2hvd2NvbnRleHQgPT0gJ2Zhdic6DQogICAgICAgICAgICAgICAgY29udGV4dE1lbnUuYXBwZW5kKCgnUmVtb3ZlIGZyb20gQWRkLW9uIEZhdm9yaXRlcycsJ1hCTUMuUnVuUGx1Z2luKCVzP21vZGU9NiZuYW1lPSVzKScNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICUoc3lzLmFyZ3ZbMF0sIHVybGxpYi5xdW90ZV9wbHVzKG5hbWUpKSkpDQoJCQkJCQkJCQkNCiAgICAgICAgICAgIGlmIG5vdCBuYW1lIGluIEZBVjoNCiAgICAgICAgICAgICAgICBjb250ZXh0TWVudS5hcHBlbmQoKCdBZGQgdG8gQWRkLW9uIEZhdm9yaXRlcycsJ1hCTUMuUnVuUGx1Z2luKCVzP21vZGU9NSZuYW1lPSVzJnVybD0lcyZpY29uaW1hZ2U9JXMmZmFuYXJ0PSVzJmZhdl9tb2RlPSVzKScNCiAgICAgICAgICAgICAgICAgICAgICAgICAlKHN5cy5hcmd2WzBdLCB1cmxsaWIucXVvdGVfcGx1cyhuYW1lKSwgdXJsbGliLnF1b3RlX3BsdXModXJsKSwgdXJsbGliLnF1b3RlX3BsdXMoaWNvbmltYWdlKSwgdXJsbGliLnF1b3RlX3BsdXMoZmFuYXJ0KSwgbW9kZSkpKQ0KICAgICAgICAgICAgbGl6LmFkZENvbnRleHRNZW51SXRlbXMoY29udGV4dE1lbnUpDQogICAgICAgIG9rPXhibWNwbHVnaW4uYWRkRGlyZWN0b3J5SXRlbShoYW5kbGU9aW50KHN5cy5hcmd2WzFdKSx1cmw9dSxsaXN0aXRlbT1saXosaXNGb2xkZXI9VHJ1ZSkNCg0KICAgICAgICByZXR1cm4gb2sNCmRlZiB5dGRsX2Rvd25sb2FkKHVybCx0aXRsZSxtZWRpYV90eXBlPSd2aWRlbycpOg0KICAgICMgcGxheSBpbiB4Ym1jIHdoaWxlIHBsYXlpbmcgZ28gYmFjayB0byBjb250ZXh0TWVudShjKSB0byAiISFEb3dubG9hZCEhIg0KICAgICMgVHJpYWwgeWFzY2Vlbjogc2VwZXJhdGUgfFVzZXItQWdlbnQ9DQogICAgaW1wb3J0IHlvdXR1YmVkbA0KICAgIGlmIG5vdCB1cmwgPT0gJyc6DQogICAgICAgIGlmIG1lZGlhX3R5cGU9PSAnYXVkaW8nOg0KICAgICAgICAgICAgeW91dHViZWRsLnNpbmdsZV9ZRCh1cmwsZG93bmxvYWQ9VHJ1ZSxhdWRpbz1UcnVlKQ0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgeW91dHViZWRsLnNpbmdsZV9ZRCh1cmwsZG93bmxvYWQ9VHJ1ZSkgICANCiAgICBlbGlmIHhibWMuUGxheWVyKCkuaXNQbGF5aW5nKCkgPT0gVHJ1ZSA6DQogICAgICAgIGltcG9ydCBZRFN0cmVhbUV4dHJhY3Rvcg0KICAgICAgICBpZiBZRFN0cmVhbUV4dHJhY3Rvci5pc0Rvd25sb2FkaW5nKCkgPT0gVHJ1ZToNCg0KICAgICAgICAgICAgWURTdHJlYW1FeHRyYWN0b3IubWFuYWdlRG93bmxvYWRzKCkNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHhibWNfdXJsID0geGJtYy5QbGF5ZXIoKS5nZXRQbGF5aW5nRmlsZSgpDQoNCiAgICAgICAgICAgIHhibWNfdXJsID0geGJtY191cmwuc3BsaXQoJ3xVc2VyLUFnZW50PScpWzBdDQogICAgICAgICAgICBpbmZvID0geyd1cmwnOnhibWNfdXJsLCd0aXRsZSc6dGl0bGUsJ21lZGlhX3R5cGUnOm1lZGlhX3R5cGV9DQogICAgICAgICAgICB5b3V0dWJlZGwuc2luZ2xlX1lEKCcnLGRvd25sb2FkPVRydWUsZGxfaW5mbz1pbmZvKSAgICANCiAgICBlbHNlOg0KICAgICAgICB4Ym1jLmV4ZWN1dGVidWlsdGluKCJYQk1DLk5vdGlmaWNhdGlvbihET1dOTE9BRCxGaXJzdCBQbGF5IFtDT0xPUiB5ZWxsb3ddV0hJTEUgcGxheWluZyBkb3dubG9hZFsvQ09MT1JdICwxMDAwMCkiKQ0KIA0KZGVmIHNlYXJjaChzaXRlX25hbWUsc2VhcmNoX3Rlcm09Tm9uZSk6DQogICAgdGh1bWJuYWlsPScnDQogICAgaWYgb3MucGF0aC5leGlzdHMoaGlzdG9yeSkgPT0gRmFsc2Ugb3IgYWRkb24uZ2V0U2V0dGluZygnY2xlYXJzZWFjaGhpc3RvcnknKT09J3RydWUnOg0KICAgICAgICBTYXZlVG9GaWxlKGhpc3RvcnksJycpDQogICAgICAgIGFkZG9uLnNldFNldHRpbmcoImNsZWFyc2VhY2hoaXN0b3J5IiwiZmFsc2UiKQ0KICAgIGlmIHNpdGVfbmFtZSA9PSAnaGlzdG9yeScgOg0KICAgICAgICBjb250ZW50ID0gTG9hZEZpbGUoaGlzdG9yeSkNCiAgICAgICAgbWF0Y2ggPSByZS5jb21waWxlKCcoLis/KTooLio/KSg/OlxyfFxuKScpLmZpbmRhbGwoY29udGVudCkNCg0KICAgICAgICBmb3IgbmFtZSxzZWFyY2hfdGVybSBpbiBtYXRjaDoNCiAgICAgICAgICAgIGlmICdwbHVnaW46Ly8nIGluIHNlYXJjaF90ZXJtOg0KICAgICAgICAgICAgICAgIGFkZExpbmsoc2VhcmNoX3Rlcm0sIG5hbWUsdGh1bWJuYWlsLCcnLCcnLCcnLCcnLCcnLE5vbmUsJycsdG90YWw9aW50KGxlbihtYXRjaCkpKQ0KICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICBhZGREaXIobmFtZSsnOicrc2VhcmNoX3Rlcm0sbmFtZSwyNixpY29uLEZBTkFSVCwnJywnJywnJywnJykNCiAgICBpZiBub3Qgc2VhcmNoX3Rlcm06ICAgIA0KICAgICAgICBrZXlib2FyZCA9IHhibWMuS2V5Ym9hcmQoJycsJ0VudGVyIFNlYXJjaCBUZXJtJykNCiAgICAgICAga2V5Ym9hcmQuZG9Nb2RhbCgpDQogICAgICAgIGlmIChrZXlib2FyZC5pc0NvbmZpcm1lZCgpID09IEZhbHNlKToNCiAgICAgICAgICAgIHJldHVybg0KICAgICAgICBzZWFyY2hfdGVybSA9IGtleWJvYXJkLmdldFRleHQoKQ0KICAgICAgICBpZiBsZW4oc2VhcmNoX3Rlcm0pID09IDA6DQogICAgICAgICAgICByZXR1cm4gICAgICAgIA0KICAgIHNlYXJjaF90ZXJtID0gc2VhcmNoX3Rlcm0ucmVwbGFjZSgnICcsJysnKQ0KICAgIHNlYXJjaF90ZXJtID0gc2VhcmNoX3Rlcm0uZW5jb2RlKCd1dGYtOCcpDQogICAgaWYgJ3lvdXR1YmUnIGluIHNpdGVfbmFtZToNCiAgICAgICAgI3lvdXR1YmUgPSB5b3V0dWJlI0xhbmEgRGVsIFJleQ0KICAgICAgICBpbXBvcnQgX3l0cGxpc3QNCg0KICAgICAgICBzZWFyY2hfcmVzID0ge30NCiAgICAgICAgc2VhcmNoX3JlcyA9IF95dHBsaXN0LllvVVR1YmUoJ3NlYXJjaFlUJyx5b3V0dWJlPXNlYXJjaF90ZXJtLG1heF9wYWdlPTQsbm9zYXZlPSdub3NhdmUnKQ0KICAgICAgICB0b3RhbCA9IGxlbihzZWFyY2hfcmVzKQ0KICAgICAgICBmb3IgaXRlbSBpbiBzZWFyY2hfcmVzOg0KICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgIG5hbWUgPSBzZWFyY2hfcmVzW2l0ZW1dWyd0aXRsZSddDQogICAgICAgICAgICAgICAgZGF0ZT0gc2VhcmNoX3Jlc1tpdGVtXVsnZGF0ZSddDQogICAgICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbiA9IHNlYXJjaF9yZXNbaXRlbV1bJ2Rlc2MnXQ0KICAgICAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb246DQogICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uID0gJ1VOQVZBSUFCTEUnDQoNCiAgICAgICAgICAgICAgICB1cmwgPSAncGx1Z2luOi8vcGx1Z2luLnZpZGVvLnlvdXR1YmUvcGxheS8/dmlkZW9faWQ9JyArIHNlYXJjaF9yZXNbaXRlbV1bJ3VybCddDQogICAgICAgICAgICAgICAgdGh1bWJuYWlsID0naHR0cDovL2ltZy55b3V0dWJlLmNvbS92aS8nK3NlYXJjaF9yZXNbaXRlbV1bJ3VybCddKycvMC5qcGcnDQogICAgICAgICAgICAgICAgYWRkTGluayh1cmwsIG5hbWUsdGh1bWJuYWlsLCcnLCcnLCcnLCcnLCcnLE5vbmUsJycsdG90YWwpDQogICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uOg0KICAgICAgICAgICAgCWFkZG9uX2xvZyggJ1RoaXMgaXRlbSBpcyBpZ25vcmVkOjonKQ0KICAgICAgICBwYWdlX2RhdGEgPSBzaXRlX25hbWUgKyc6Jysgc2VhcmNoX3Rlcm0gKyAnXG4nDQogICAgICAgIFNhdmVUb0ZpbGUob3MucGF0aC5qb2luKHByb2ZpbGUsJ2hpc3RvcnknKSxwYWdlX2RhdGEsYXBwZW5kPVRydWUpDQogICAgZWxpZiAnZG1vdGlvbicgaW4gc2l0ZV9uYW1lOg0KICAgICAgICB1cmxNYWluID0gImh0dHBzOi8vYXBpLmRhaWx5bW90aW9uLmNvbSIgDQogICAgICAgICN5b3V0dWJlID0geW91dHViZSNMYW5hIERlbCBSZXkNCiAgICAgICAgaW1wb3J0IF9ETXNlYXJjaA0KICAgICAgICBmYW1pbHlGaWx0ZXIgPSBzdHIoYWRkb24uZ2V0U2V0dGluZygnZmFtaWx5RmlsdGVyJykpDQogICAgICAgIF9ETXNlYXJjaC5saXN0VmlkZW9zKHVybE1haW4rIi92aWRlb3M/ZmllbGRzPWRlc2NyaXB0aW9uLGR1cmF0aW9uLGlkLG93bmVyLnVzZXJuYW1lLHRha2VuX3RpbWUsdGh1bWJuYWlsX2xhcmdlX3VybCx0aXRsZSx2aWV3c190b3RhbCZzZWFyY2g9IitzZWFyY2hfdGVybSsiJnNvcnQ9cmVsZXZhbmNlJmxpbWl0PTEwMCZmYW1pbHlfZmlsdGVyPSIrZmFtaWx5RmlsdGVyKyImbG9jYWxpemF0aW9uPWVuX0VOJnBhZ2U9MSIpDQogICAgDQogICAgICAgIHBhZ2VfZGF0YSA9IHNpdGVfbmFtZSArJzonKyBzZWFyY2hfdGVybSsgJ1xuJw0KICAgICAgICBTYXZlVG9GaWxlKG9zLnBhdGguam9pbihwcm9maWxlLCdoaXN0b3J5JykscGFnZV9kYXRhLGFwcGVuZD1UcnVlKSAgICAgICAgDQogICAgZWxpZiAnSU1EQmlkcGxheScgaW4gc2l0ZV9uYW1lOg0KICAgICAgICB1cmxNYWluID0gImh0dHA6Ly93d3cub21kYmFwaS5jb20vP3Q9IiANCiAgICAgICAgdXJsPSB1cmxNYWluK3NlYXJjaF90ZXJtDQoNCiAgICAgICAgaGVhZGVycyA9IGRpY3QoeydVc2VyLUFnZW50JzonTW96aWxsYS81LjAgKFdpbmRvd3MgTlQgNi4zOyBydjozMy4wKSBHZWNrby8yMDEwMDEwMSBGaXJlZm94LzMzLjAnLCdSZWZlcmVyJzogJ2h0dHA6Ly9qb2tlci5vcmcvJywnQWNjZXB0LUVuY29kaW5nJzonZ3ppcCwgZGVmbGF0ZScsJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uO2NoYXJzZXQ9dXRmLTgnLCdBY2NlcHQnOiAnYXBwbGljYXRpb24vanNvbiwgdGV4dC9wbGFpbiwgKi8qJ30pDQogICAgDQogICAgICAgIHI9cmVxdWVzdHMuZ2V0KHVybCxoZWFkZXJzPWhlYWRlcnMpDQogICAgICAgIGRhdGEgPSByLmpzb24oKQ0KICAgICAgICByZXMgPSBkYXRhWydSZXNwb25zZSddDQogICAgICAgIGlmIHJlcyA9PSAnVHJ1ZSc6DQogICAgICAgICAgICBpbWRiSUQgPSBkYXRhWydpbWRiSUQnXQ0KICAgICAgICAgICAgbmFtZT0gZGF0YVsnVGl0bGUnXSArIGRhdGFbJ1JlbGVhc2VkJ10NCiAgICAgICAgICAgIGRpYWxvZyA9IHhibWNndWkuRGlhbG9nKCkNCiAgICAgICAgICAgIHJldCA9IGRpYWxvZy55ZXNubygnQ2hlY2sgTW92aWUgVGl0bGUnLCAnUExBWSA6OiAlcyA/JyVuYW1lKQ0KICAgICAgICAgICAgaWYgcmV0Og0KICAgICAgICAgICAgICAgIHVybCA9ICdwbHVnaW46Ly9wbHVnaW4udmlkZW8ucHVsc2FyL21vdmllLycraW1kYklEKycvcGxheScNCiAgICAgICAgICAgICAgICBwYWdlX2RhdGEgPSBuYW1lICsnOicrIHVybCsgJ1xuJw0KICAgICAgICAgICAgICAgIFNhdmVUb0ZpbGUoaGlzdG9yeSxwYWdlX2RhdGEsYXBwZW5kPVRydWUpDQogICAgICAgICAgICAgICAgcmV0dXJuIHVybA0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgeGJtYy5leGVjdXRlYnVpbHRpbigiWEJNQy5Ob3RpZmljYXRpb24oU2ltcGxlS29yZSxObyBJTURCIG1hdGNoIGZvdW5kICw3MDAwLCIraWNvbisiKSIpDQojIyBMdW5hdGl4eiBQc2V1ZG9UViBmZWF0dXJlDQpkZWYgYXNjaWkoc3RyaW5nKToNCiAgICBpZiBpc2luc3RhbmNlKHN0cmluZywgYmFzZXN0cmluZyk6DQogICAgICAgIGlmIGlzaW5zdGFuY2Uoc3RyaW5nLCB1bmljb2RlKToNCiAgICAgICAgICAgc3RyaW5nID0gc3RyaW5nLmVuY29kZSgnYXNjaWknLCAnaWdub3JlJykNCiAgICByZXR1cm4gc3RyaW5nDQpkZWYgdW5pKHN0cmluZywgZW5jb2RpbmcgPSAndXRmLTgnKToNCiAgICBpZiBpc2luc3RhbmNlKHN0cmluZywgYmFzZXN0cmluZyk6DQogICAgICAgIGlmIG5vdCBpc2luc3RhbmNlKHN0cmluZywgdW5pY29kZSk6DQogICAgICAgICAgICBzdHJpbmcgPSB1bmljb2RlKHN0cmluZywgZW5jb2RpbmcsICdpZ25vcmUnKQ0KICAgIHJldHVybiBzdHJpbmcNCmRlZiByZW1vdmVOb25Bc2NpaShzKTogcmV0dXJuICIiLmpvaW4oZmlsdGVyKGxhbWJkYSB4OiBvcmQoeCk8MTI4LCBzKSkNCg0KZGVmIHNlbmRKU09OKCBjb21tYW5kKToNCiAgICBkYXRhID0gJycNCiAgICB0cnk6DQogICAgICAgIGRhdGEgPSB4Ym1jLmV4ZWN1dGVKU09OUlBDKHVuaShjb21tYW5kKSkNCiAgICBleGNlcHQgVW5pY29kZUVuY29kZUVycm9yOg0KICAgICAgICBkYXRhID0geGJtYy5leGVjdXRlSlNPTlJQQyhhc2NpaShjb21tYW5kKSkNCg0KICAgIHJldHVybiB1bmkoZGF0YSkNCg0KI2hha2FtYWMgdGhhbmtzIFJvbWFuX1ZfTQ0KZGVmIFNldFZpZXdUaHVtYm5haWwoKToNCiAgICBza2luX3VzZWQgPSB4Ym1jLmdldFNraW5EaXIoKQ0KICAgIGlmIHNraW5fdXNlZCA9PSAnc2tpbi5jb25mbHVlbmNlJzoNCiAgICAgICAgeGJtYy5leGVjdXRlYnVpbHRpbignQ29udGFpbmVyLlNldFZpZXdNb2RlKDUwMCknKQ0KICAgIGVsaWYgc2tpbl91c2VkID09ICdza2luLmFlb24ubm94JzoNCiAgICAgICAgeGJtYy5leGVjdXRlYnVpbHRpbignQ29udGFpbmVyLlNldFZpZXdNb2RlKDUxMSknKSANCiAgICBlbHNlOg0KICAgICAgICB4Ym1jLmV4ZWN1dGVidWlsdGluKCdDb250YWluZXIuU2V0Vmlld01vZGUoNTAwKScpDQoJDQoJDQpkZWYgcGx1Z2lucXVlcnlieUpTT04odXJsKToNCiAgICBqc29uX3F1ZXJ5ID0gdW5pKCd7Impzb25ycGMiOiIyLjAiLCJtZXRob2QiOiJGaWxlcy5HZXREaXJlY3RvcnkiLCJwYXJhbXMiOnsiZGlyZWN0b3J5IjoiJXMiLCJtZWRpYSI6InZpZGVvIiwicHJvcGVydGllcyI6WyJ0aHVtYm5haWwiLCJ0aXRsZSIsInllYXIiLCJkYXRlYWRkZWQiLCJmYW5hcnQiLCJyYXRpbmciLCJzZWFzb24iLCJlcGlzb2RlIiwic3R1ZGlvIl19LCJpZCI6MX0nKSAldXJsDQoNCiAgICBqc29uX2ZvbGRlcl9kZXRhaWwgPSBqc29uLmxvYWRzKHNlbmRKU09OKGpzb25fcXVlcnkpKQ0KICAgIGZvciBpIGluIGpzb25fZm9sZGVyX2RldGFpbFsncmVzdWx0J11bJ2ZpbGVzJ10gOg0KICAgICAgICB1cmwgPSBpWydmaWxlJ10NCiAgICAgICAgbmFtZSA9IHJlbW92ZU5vbkFzY2lpKGlbJ2xhYmVsJ10pDQogICAgICAgIHRodW1ibmFpbCA9IHJlbW92ZU5vbkFzY2lpKGlbJ3RodW1ibmFpbCddKQ0KICAgICAgICB0cnk6DQogICAgICAgICAgICBmYW5hcnQgPSByZW1vdmVOb25Bc2NpaShpWydmYW5hcnQnXSkNCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbjoNCiAgICAgICAgICAgIGZhbmFydCA9ICcnDQogICAgICAgIHRyeToNCiAgICAgICAgICAgIGRhdGUgPSBpWyd5ZWFyJ10NCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbjoNCiAgICAgICAgICAgIGRhdGUgPSAnJw0KICAgICAgICB0cnk6DQogICAgICAgICAgICBlcGlzb2RlID0gaVsnZXBpc29kZSddDQogICAgICAgICAgICBzZWFzb24gPSBpWydzZWFzb24nXQ0KICAgICAgICAgICAgaWYgZXBpc29kZSA9PSAtMSBvciBzZWFzb24gPT0gLTE6DQogICAgICAgICAgICAgICAgZGVzY3JpcHRpb24gPSAnJw0KICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbiA9ICdbQ09MT1IgeWVsbG93XSBTJyArIHN0cihzZWFzb24pKydbL0NPTE9SXVtDT0xPUiBob3RwaW5rXSBFJyArIHN0cihlcGlzb2RlKSArJ1svQ09MT1JdJw0KICAgICAgICBleGNlcHQgRXhjZXB0aW9uOg0KICAgICAgICAgICAgZGVzY3JpcHRpb24gPSAnJw0KICAgICAgICB0cnk6DQogICAgICAgICAgICBzdHVkaW8gPSBpWydzdHVkaW8nXQ0KICAgICAgICAgICAgaWYgc3R1ZGlvOg0KICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uICs9ICdcbiBTdHVkaW86W0NPTE9SIHN0ZWVsYmx1ZV0gJyArIHN0dWRpb1swXSArICdbL0NPTE9SXScNCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbjoNCiAgICAgICAgICAgIHN0dWRpbyA9ICcnDQoNCiAgICAgICAgaWYgaVsnZmlsZXR5cGUnXSA9PSAnZmlsZSc6DQogICAgICAgICAgICBhZGRMaW5rKHVybCxuYW1lLHRodW1ibmFpbCxmYW5hcnQsZGVzY3JpcHRpb24sJycsZGF0ZSwnJyxOb25lLCcnLHRvdGFsPWxlbihqc29uX2ZvbGRlcl9kZXRhaWxbJ3Jlc3VsdCddWydmaWxlcyddKSkNCiAgICAgICAgICAgICN4Ym1jLmV4ZWN1dGVidWlsdGluKCJDb250YWluZXIuU2V0Vmlld01vZGUoNTAwKSIpDQoNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIGFkZERpcihuYW1lLHVybCw1Myx0aHVtYm5haWwsZmFuYXJ0LGRlc2NyaXB0aW9uLCcnLGRhdGUsJycpDQogICAgICAgICAgICAjeGJtYy5leGVjdXRlYnVpbHRpbigiQ29udGFpbmVyLlNldFZpZXdNb2RlKDUwMCkiKQ0KDQpkZWYgYWRkTGluayh1cmwsbmFtZSxpY29uaW1hZ2UsZmFuYXJ0LGRlc2NyaXB0aW9uLGdlbnJlLGRhdGUsc2hvd2NvbnRleHQscGxheWxpc3QscmVnZXhzLHRvdGFsLHNldENvb2tpZT0iIik6DQogICAgICAgICNwcmludCAndXJsLG5hbWUnLHVybCxuYW1lDQogICAgICAgIGNvbnRleHRNZW51ID1bXQ0KICAgICAgICB0cnk6DQogICAgICAgICAgICBuYW1lID0gbmFtZS5lbmNvZGUoJ3V0Zi04JykNCiAgICAgICAgZXhjZXB0OiBwYXNzDQogICAgICAgIG9rID0gVHJ1ZQ0KICAgICAgIA0KICAgICAgICBpZiByZWdleHM6IA0KICAgICAgICAgICAgbW9kZSA9ICcxNycNCiAgICAgICAgICAgDQogICAgICAgICAgICBjb250ZXh0TWVudS5hcHBlbmQoKCdbQ09MT1Igd2hpdGVdISFEb3dubG9hZCBDdXJyZW50bHkgUGxheWluZyEhWy9DT0xPUl0nLCdYQk1DLlJ1blBsdWdpbiglcz91cmw9JXMmbW9kZT0yMSZuYW1lPSVzKScNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICUoc3lzLmFyZ3ZbMF0sIHVybGxpYi5xdW90ZV9wbHVzKHVybCksIHVybGxpYi5xdW90ZV9wbHVzKG5hbWUpKSkpICAgICAgICAgICANCiAgICAgICAgZWxpZiAgYW55KHggaW4gdXJsIGZvciB4IGluIHJlc29sdmVfdXJsKSBhbmQgIHVybC5zdGFydHN3aXRoKCdodHRwJyk6DQogICAgICAgICAgICBtb2RlID0gJzE5Jw0KICAgICAgICAgIA0KICAgICAgICAgICAgY29udGV4dE1lbnUuYXBwZW5kKCgnW0NPTE9SIHdoaXRlXSEhRG93bmxvYWQgQ3VycmVudGx5IFBsYXlpbmchIVsvQ09MT1JdJywnWEJNQy5SdW5QbHVnaW4oJXM/dXJsPSVzJm1vZGU9MjEmbmFtZT0lcyknDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAlKHN5cy5hcmd2WzBdLCB1cmxsaWIucXVvdGVfcGx1cyh1cmwpLCB1cmxsaWIucXVvdGVfcGx1cyhuYW1lKSkpKSAgICAgICAgICAgDQogICAgICAgIGVsaWYgdXJsLmVuZHN3aXRoKCcmbW9kZT0xOCcpOg0KICAgICAgICAgICAgdXJsPXVybC5yZXBsYWNlKCcmbW9kZT0xOCcsJycpDQogICAgICAgICAgICBtb2RlID0gJzE4JyANCiAgICAgICAgICANCiAgICAgICAgICAgIGNvbnRleHRNZW51LmFwcGVuZCgoJ1tDT0xPUiB3aGl0ZV0hIURvd25sb2FkISFbL0NPTE9SXScsJ1hCTUMuUnVuUGx1Z2luKCVzP3VybD0lcyZtb2RlPTIzJm5hbWU9JXMpJw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJShzeXMuYXJndlswXSwgdXJsbGliLnF1b3RlX3BsdXModXJsKSwgdXJsbGliLnF1b3RlX3BsdXMobmFtZSkpKSkgDQogICAgICAgICAgICBpZiBhZGRvbi5nZXRTZXR0aW5nKCdkbGF1ZGlvb25seScpID09ICd0cnVlJzoNCiAgICAgICAgICAgICAgICBjb250ZXh0TWVudS5hcHBlbmQoKCchIURvd25sb2FkIFtDT0xPUiBzZWFibHVlXUF1ZGlvISFbL0NPTE9SXScsJ1hCTUMuUnVuUGx1Z2luKCVzP3VybD0lcyZtb2RlPTI0Jm5hbWU9JXMpJw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICUoc3lzLmFyZ3ZbMF0sIHVybGxpYi5xdW90ZV9wbHVzKHVybCksIHVybGxpYi5xdW90ZV9wbHVzKG5hbWUpKSkpICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICBlbGlmIHVybC5zdGFydHN3aXRoKCdtYWduZXQ6P3h0PScpIG9yICcudG9ycmVudCcgaW4gdXJsOg0KICAgICAgICAgIA0KICAgICAgICAgICAgaWYgJyYnIGluIHVybCBhbmQgbm90ICcmYW1wOycgaW4gdXJsIDoNCiAgICAgICAgICAgICAgICB1cmwgPSB1cmwucmVwbGFjZSgnJicsJyZhbXA7JykNCiAgICAgICAgICAgIHVybCA9ICdwbHVnaW46Ly9wbHVnaW4udmlkZW8ucHVsc2FyL3BsYXk/dXJpPScgKyB1cmwNCiAgICAgICAgICAgIG1vZGUgPSAnMTInDQogICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgZWxzZTogDQogICAgICAgICAgICBtb2RlID0gJzEyJw0KICAgICAgDQogICAgICAgICAgICBjb250ZXh0TWVudS5hcHBlbmQoKCdbQ09MT1Igd2hpdGVdISFEb3dubG9hZCBDdXJyZW50bHkgUGxheWluZyEhWy9DT0xPUl0nLCdYQk1DLlJ1blBsdWdpbiglcz91cmw9JXMmbW9kZT0yMSZuYW1lPSVzKScNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICUoc3lzLmFyZ3ZbMF0sIHVybGxpYi5xdW90ZV9wbHVzKHVybCksIHVybGxpYi5xdW90ZV9wbHVzKG5hbWUpKSkpICAgICAgICAgICANCiAgICAgICAgdT1zeXMuYXJndlswXSsiPyINCiAgICAgICAgcGxheV9saXN0ID0gRmFsc2UNCiAgICAgIA0KICAgICAgICBpZiBwbGF5bGlzdDoNCiAgICAgICAgICAgIGlmIGFkZG9uLmdldFNldHRpbmcoJ2FkZF9wbGF5bGlzdCcpID09ICJmYWxzZSI6DQogICAgICAgICAgICAgICAgdSArPSAidXJsPSIrdXJsbGliLnF1b3RlX3BsdXModXJsKSsiJm1vZGU9Iittb2RlDQogICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgIHUgKz0gIm1vZGU9MTMmbmFtZT0lcyZwbGF5bGlzdD0lcyIgJSh1cmxsaWIucXVvdGVfcGx1cyhuYW1lKSwgdXJsbGliLnF1b3RlX3BsdXMoc3RyKHBsYXlsaXN0KS5yZXBsYWNlKCcsJywnfHwnKSkpDQogICAgICAgICAgICAgICAgbmFtZSA9IG5hbWUgKyAnW0NPTE9SIG1hZ2VudGFdICgnICsgc3RyKGxlbihwbGF5bGlzdCkpICsgJyBpdGVtcyApWy9DT0xPUl0nDQogICAgICAgICAgICAgICAgcGxheV9saXN0ID0gVHJ1ZQ0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgdSArPSAidXJsPSIrdXJsbGliLnF1b3RlX3BsdXModXJsKSsiJm1vZGU9Iittb2RlDQogICAgICAgIGlmIHJlZ2V4czoNCiAgICAgICAgICAgIHUgKz0gIiZyZWdleHM9IityZWdleHMNCiAgICAgICAgaWYgbm90IHNldENvb2tpZSA9PSAnJzoNCiAgICAgICAgICAgIHUgKz0gIiZzZXRDb29raWU9Iit1cmxsaWIucXVvdGVfcGx1cyhzZXRDb29raWUpDQogIA0KICAgICAgICBpZiBkYXRlID09ICcnOg0KICAgICAgICAgICAgZGF0ZSA9IE5vbmUNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIGRlc2NyaXB0aW9uICs9ICdcblxuRGF0ZTogJXMnICVkYXRlDQogICAgICAgIGxpej14Ym1jZ3VpLkxpc3RJdGVtKG5hbWUsIGljb25JbWFnZT0iRGVmYXVsdFZpZGVvLnBuZyIsIHRodW1ibmFpbEltYWdlPWljb25pbWFnZSkNCiAgICAgICAgbGl6LnNldEluZm8odHlwZT0iVmlkZW8iLCBpbmZvTGFiZWxzPXsgIlRpdGxlIjogbmFtZSwgIlBsb3QiOiBkZXNjcmlwdGlvbiwgIkdlbnJlIjogZ2VucmUsICJkYXRlYWRkZWQiOiBkYXRlIH0pDQogICAgICAgIGxpei5zZXRQcm9wZXJ0eSgiRmFuYXJ0X0ltYWdlIiwgZmFuYXJ0KQ0KICAgICAgICANCiAgICAgICAgaWYgKG5vdCBwbGF5X2xpc3QpIGFuZCBub3QgYW55KHggaW4gdXJsIGZvciB4IGluIGdfaWdub3JlU2V0UmVzb2x2ZWQpOiMgIChub3QgdXJsLnN0YXJ0c3dpdGgoJ3BsdWdpbjovL3BsdWdpbi52aWRlby5mNG1UZXN0ZXInKSk6DQogICAgICAgICAgICBpZiByZWdleHM6DQogICAgICAgICAgICAgICAgaWYgJyRweUZ1bmN0aW9uOnBsYXltZWRpYSgnIG5vdCBpbiB1cmxsaWIudW5xdW90ZV9wbHVzKHJlZ2V4cykgYW5kICdub3RwbGF5YWJsZScgbm90IGluIHVybGxpYi51bnF1b3RlX3BsdXMocmVnZXhzKSAgOg0KICAgICAgICAgICAgICAgICAgICAjcHJpbnQgJ3NldHRpbmcgaXNwbGF5YWJsZScsdXJsLCB1cmxsaWIudW5xdW90ZV9wbHVzKHJlZ2V4cyksdXJsDQogICAgICAgICAgICAgICAgICAgIGxpei5zZXRQcm9wZXJ0eSgnSXNQbGF5YWJsZScsICd0cnVlJykNCiAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgbGl6LnNldFByb3BlcnR5KCdJc1BsYXlhYmxlJywgJ3RydWUnKQ0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgYWRkb25fbG9nKCAnTk9UIHNldHRpbmcgaXNwbGF5YWJsZScrdXJsKQ0KICAgICAgIA0KICAgICAgICBpZiBzaG93Y29udGV4dDoNCiAgICAgICAgICAgIGNvbnRleHRNZW51ID0gW10NCiAgICAgICAgICAgIGlmIHNob3djb250ZXh0ID09ICdmYXYnOg0KICAgICAgICAgICAgICAgIGNvbnRleHRNZW51LmFwcGVuZCgNCiAgICAgICAgICAgICAgICAgICAgKCdSZW1vdmUgZnJvbSBBZGQtb24gRmF2b3JpdGVzJywnWEJNQy5SdW5QbHVnaW4oJXM/bW9kZT02Jm5hbWU9JXMpJw0KICAgICAgICAgICAgICAgICAgICAgJShzeXMuYXJndlswXSwgdXJsbGliLnF1b3RlX3BsdXMobmFtZSkpKQ0KICAgICAgICAgICAgICAgICAgICAgKQ0KICAgICAgICAgICAgZWxpZiBub3QgbmFtZSBpbiBGQVY6DQogICAgICAgICAgICAgICAgZmF2X3BhcmFtcyA9ICgNCiAgICAgICAgICAgICAgICAgICAgJyVzP21vZGU9NSZuYW1lPSVzJnVybD0lcyZpY29uaW1hZ2U9JXMmZmFuYXJ0PSVzJmZhdl9tb2RlPTAnDQogICAgICAgICAgICAgICAgICAgICUoc3lzLmFyZ3ZbMF0sIHVybGxpYi5xdW90ZV9wbHVzKG5hbWUpLCB1cmxsaWIucXVvdGVfcGx1cyh1cmwpLCB1cmxsaWIucXVvdGVfcGx1cyhpY29uaW1hZ2UpLCB1cmxsaWIucXVvdGVfcGx1cyhmYW5hcnQpKQ0KICAgICAgICAgICAgICAgICAgICApDQogICAgICAgICAgICAgICAgaWYgcGxheWxpc3Q6DQogICAgICAgICAgICAgICAgICAgIGZhdl9wYXJhbXMgKz0gJ3BsYXlsaXN0PScrdXJsbGliLnF1b3RlX3BsdXMoc3RyKHBsYXlsaXN0KS5yZXBsYWNlKCcsJywnfHwnKSkNCiAgICAgICAgICAgICAgICBpZiByZWdleHM6DQogICAgICAgICAgICAgICAgICAgIGZhdl9wYXJhbXMgKz0gIiZyZWdleHM9IityZWdleHMNCiAgICAgICAgICAgICAgICBjb250ZXh0TWVudS5hcHBlbmQoKCdBZGQgdG8gQWRkLW9uIEZhdm9yaXRlcycsJ1hCTUMuUnVuUGx1Z2luKCVzKScgJWZhdl9wYXJhbXMpKQ0KICAgICAgICAgICAgbGl6LmFkZENvbnRleHRNZW51SXRlbXMoY29udGV4dE1lbnUpDQogICAgICAgDQogICAgICAgIGlmIG5vdCBwbGF5bGlzdCBpcyBOb25lOg0KICAgICAgICAgICAgaWYgYWRkb24uZ2V0U2V0dGluZygnYWRkX3BsYXlsaXN0JykgPT0gImZhbHNlIjoNCiAgICAgICAgICAgICAgICBwbGF5bGlzdF9uYW1lID0gbmFtZS5zcGxpdCgnKSAnKVsxXQ0KICAgICAgICAgICAgICAgIGNvbnRleHRNZW51XyA9IFsNCiAgICAgICAgICAgICAgICAgICAgKCdQbGF5ICcrcGxheWxpc3RfbmFtZSsnIFBsYXlMaXN0JywnWEJNQy5SdW5QbHVnaW4oJXM/bW9kZT0xMyZuYW1lPSVzJnBsYXlsaXN0PSVzKScNCiAgICAgICAgICAgICAgICAgICAgICUoc3lzLmFyZ3ZbMF0sIHVybGxpYi5xdW90ZV9wbHVzKHBsYXlsaXN0X25hbWUpLCB1cmxsaWIucXVvdGVfcGx1cyhzdHIocGxheWxpc3QpLnJlcGxhY2UoJywnLCd8fCcpKSkpDQogICAgICAgICAgICAgICAgICAgICBdDQogICAgICAgICAgICAgICAgbGl6LmFkZENvbnRleHRNZW51SXRlbXMoY29udGV4dE1lbnVfKQ0KICAgICAgICAjcHJpbnQgJ2FkZGluZycsbmFtZQ0KICMgICAgICAgcHJpbnQgdXJsLHRvdGFsaXRlbXMNCiAgICAgICAgb2s9eGJtY3BsdWdpbi5hZGREaXJlY3RvcnlJdGVtKGhhbmRsZT1pbnQoc3lzLmFyZ3ZbMV0pLHVybD11LGxpc3RpdGVtPWxpeix0b3RhbEl0ZW1zPXRvdGFsKQ0KICAgICAgICAjcHJpbnQgJ2FkZGVkJyxuYW1lDQogICAgICAgIHJldHVybiBvaw0KDQpkZWYgcGxheXNldHJlc29sdmVkKHVybCxuYW1lLGljb25pbWFnZSxzZXRyZXNvbHZlZD1UcnVlKToNCiAgICBpZiBzZXRyZXNvbHZlZDoNCiAgICAgICAgbGl6ID0geGJtY2d1aS5MaXN0SXRlbShuYW1lLCBpY29uSW1hZ2U9aWNvbmltYWdlKQ0KICAgICAgICBsaXouc2V0SW5mbyh0eXBlPSdWaWRlbycsIGluZm9MYWJlbHM9eydUaXRsZSc6bmFtZX0pDQogICAgICAgIGxpei5zZXRQcm9wZXJ0eSgiSXNQbGF5YWJsZSIsInRydWUiKQ0KICAgICAgICBsaXouc2V0UGF0aChzdHIodXJsKSkNCiAgICAgICAgeGJtY3BsdWdpbi5zZXRSZXNvbHZlZFVybChpbnQoc3lzLmFyZ3ZbMV0pLCBUcnVlLCBsaXopDQogICAgZWxzZToNCiAgICAgICAgeGJtYy5leGVjdXRlYnVpbHRpbignWEJNQy5SdW5QbHVnaW4oJyt1cmwrJyknKSAgICAgIA0KDQoNCiMjIFRoYW5rcyB0byBkYXNjaGFja2EsIGFuIGVwZyBzY3JhcGVyIGZvciBodHRwOi8vaS50ZWxlYm95LmNoL3Byb2dyYW1tL3N0YXRpb25fc2VsZWN0LnBocA0KIyMgIGh0dHA6Ly9mb3J1bS54Ym1jLm9yZy9wb3N0LnBocD9wPTkzNjIyOCZwb3N0Y291bnQ9MTA3Ng0KZGVmIGdldGVwZyhsaW5rKToNCiAgICAgICAgdXJsPXVybGxpYi51cmxvcGVuKGxpbmspDQogICAgICAgIHNvdXJjZT11cmwucmVhZCgpDQogICAgICAgIHVybC5jbG9zZSgpDQogICAgICAgIHNvdXJjZTIgPSBzb3VyY2Uuc3BsaXQoIkpldHp0IikNCiAgICAgICAgc291cmNlMyA9IHNvdXJjZTJbMV0uc3BsaXQoJ3Byb2dyYW1tL2RldGFpbC5waHA/Y29uc3RfaWQ9JykNCiAgICAgICAgc291cmNldWhyemVpdCA9IHNvdXJjZTNbMV0uc3BsaXQoJzxiciAvPjxhIGhyZWY9Ii8nKQ0KICAgICAgICBub3d0aW1lID0gc291cmNldWhyemVpdFswXVs0MDpsZW4oc291cmNldWhyemVpdFswXSldDQogICAgICAgIHNvdXJjZXRpdGxlID0gc291cmNlM1syXS5zcGxpdCgiPC9hPjwvcD48L2Rpdj4iKQ0KICAgICAgICBub3d0aXRsZSA9IHNvdXJjZXRpdGxlWzBdWzE3Omxlbihzb3VyY2V0aXRsZVswXSldDQogICAgICAgIG5vd3RpdGxlID0gbm93dGl0bGUuZW5jb2RlKCd1dGYtOCcpDQogICAgICAgIHJldHVybiAiICAtICIrbm93dGl0bGUrIiAtICIrbm93dGltZQ0KDQpkZWYgYWMyNDcoKToNCiAgICBNZW51KCdbQ09MT1IgYXF1YV0gRmVhdHVyZWQgMjQvN1svQ09MT1JdJywnJyw5MDcsJ2h0dHA6Ly9zdGVwaGVuLWJ1aWxkcy51ay9hcnQvMjQlMjA3JTIwc2hvd3MucG5nJywnaHR0cDovL3N0ZXBoZW4tYnVpbGRzLnVrL2FydC8yMDgzOTcwMl8xMDIwNzg4NDg2MDc5ODMzN18zNjM3ODYwODdfby5qcGcnLCcnLCcnKQ0KICAgIE1lbnUoJ1tDT0xPUiBhcXVhXSAyNC83IFR2IFNob3dzWy9DT0xPUl0nLCcnLDkwOCwnaHR0cDovL3N0ZXBoZW4tYnVpbGRzLnVrL2FydC9yb2xsaW5nLXN0b25lLTEwMC1iZXN0LXR2LXNob3dzLW9mLWFsbC10aW1lLWM3NmNkZDBiLTJlMDQtNDc2OS04NGMxLTBmYWFiMTc4ZGRiZi5qcGcnLCdodHRwOi8vc3RlcGhlbi1idWlsZHMudWsvYXJ0LzIwODM5NzAyXzEwMjA3ODg0ODYwNzk4MzM3XzM2Mzc4NjA4N19vLmpwZycsJycsJycpDQogICAgTWVudSgnW0NPTE9SIGFxdWFdIDI0LzcgTW92aWVzWy9DT0xPUl0nLCcnLDkwOSwnaHR0cDovL3N0ZXBoZW4tYnVpbGRzLnVrL2FydC8yNCUyME1PVklFUy5wbmcnLCdodHRwOi8vc3RlcGhlbi1idWlsZHMudWsvYXJ0LzIwODM5NzAyXzEwMjA3ODg0ODYwNzk4MzM3XzM2Mzc4NjA4N19vLmpwZycsJycsJycpDQogICAgTWVudSgnW0NPTE9SIGFxdWFdIDI0LzcgQ2FibGVbL0NPTE9SXScsJycsOTEwLCdodHRwOi8vc3RlcGhlbi1idWlsZHMudWsvYXJ0L2NhYmxlaGVhZGVyLWdyYXlwdXJwbGUtNTkweDIzNi5qcGcnLCdodHRwOi8vc3RlcGhlbi1idWlsZHMudWsvYXJ0LzIwODM5NzAyXzEwMjA3ODg0ODYwNzk4MzM3XzM2Mzc4NjA4N19vLmpwZycsJycsJycpDQogICAgTWVudSgnW0NPTE9SIGFxdWFdIDI0LzcgUmFuZG9tIFN0cmVhbVsvQ09MT1JdJywnJyw5MTEsJ2h0dHA6Ly9zdGVwaGVuLWJ1aWxkcy51ay9hcnQvbWF4cmVzZGVmYXVsdC5qcGcnLCdodHRwOi8vc3RlcGhlbi1idWlsZHMudWsvYXJ0LzIwODM5NzAyXzEwMjA3ODg0ODYwNzk4MzM3XzM2Mzc4NjA4N19vLmpwZycsJycsJycpDQoNCmRlZiBhY3R2c2hvd3MoKToNCiAgICB1cmwgPSAnaHR0cDovL2FyY29uYWl0di5tZS8nDQogICAgaW5kZXggPSAnaW5kZXgucGhwI3Nob3dzJw0KICAgIGh0bWwgPSBCZWF1dGlmdWxTb3VwKHJlcXVlc3RzLmdldCh1cmwraW5kZXgpLmNvbnRlbnQpDQogICAgY29udHMgPSBodG1sLmZpbmRBbGwoJ2RpdicsIGF0dHJzPSB7J2NsYXNzJzonc3RyZWFtLW5hdiBzaG93cyd9KQ0KICAgIGZvciBjb250IGluIGNvbnRzOg0KICAgICAgICBsaW5rcyA9IGNvbnQuZmluZEFsbCgnZGl2JywgYXR0cnM9IHsnY2xhc3MnOidzdHJlYW0taW5pdGlhbCd9KQ0KICAgICAgICBmb3IgbGluayBpbiBsaW5rczoNCiAgICAgICAgICAgIGluaXMgPSBsaW5rLnRleHQNCiAgICAgICAgbGlua3MyID0gY29udC5maW5kQWxsKCdhJykNCiAgICAgICAgZm9yIGxpbmsgaW4gbGlua3MyOg0KICAgICAgICAgICAgaWYgbGluay5oYXNfa2V5KCdocmVmJyk6DQogICAgICAgICAgICAgICAgaHJlZiA9IHVybCtsaW5rWydocmVmJ10NCiAgICAgICAgICAgIGlmIGxpbmsuaGFzX2tleSgndGl0bGUnKToNCiAgICAgICAgICAgICAgICBuYW1lID0gbGlua1sndGl0bGUnXQ0KICAgICAgICAgICAgaGVhZHMgPSB7J1VzZXItQWdlbnQnOiByYW5kb21fYWdlbnQoKX0NCiAgICAgICAgICAgIGh0bWwzID0gcmVxdWVzdHMuZ2V0KGhyZWYsaGVhZGVycz1oZWFkcykuY29udGVudA0KICAgICAgICAgICAgcHAgPSBwYWNrZXRzKGh0bWwzKQ0KDQogICAgICAgICAgICBtYXRjaCA9IHJlLmNvbXBpbGUoIidodHRwczooLis/KSciKS5maW5kYWxsKHBwKQ0KICAgICAgICAgICAgZm9yIHBsaW5rIGluIG1hdGNoOg0KICAgICAgICAgICAgICAgIHBsaW5rID0gcGxpbmsucmVwbGFjZSgnXFwnLCcnKS5yZXBsYWNlKCdtM3U4LycsJ20zdTgnKQ0KICAgICAgICAgICAgICAgIHNyYyA9ICdodHRwczonK3BsaW5rKyd8UmVmZXJlcj1odHRwOi8vYXJjb25haXR2Lm1lJlVzZXItQWdlbnQ9TW96aWxsYSUyRjUuMCUyMChXaW5kb3dzJTIwTlQlMjA2LjElM0IlMjBXaW42NCUzQiUyMHg2NCklMjBBcHBsZVdlYktpdCUyRjUzNy4zNiUyMChLSFRNTCUyQyUyMGxpa2UlMjBHZWNrbyklMjBDaHJvbWUlMkY1OS4wLjMwNzEuMTE1JTIwU2FmYXJpJTJGNTM3LjM2Jw0KICAgICAgICAgICAgICAgIFBMQVkobmFtZSwgc3JjICw5MDYsJycsJycsJycsJycpDQoNCg0KZGVmIGFjdHZtb3ZpZXMoKToNCiAgICB1cmwgPSAnaHR0cDovL2FyY29uYWl0di5tZS8nDQogICAgaW5kZXggPSAnaW5kZXgucGhwI21vdmllcycNCiAgICBodG1sID0gQmVhdXRpZnVsU291cChyZXF1ZXN0cy5nZXQodXJsK2luZGV4KS5jb250ZW50KQ0KICAgIGNvbnRzID0gaHRtbC5maW5kQWxsKCdkaXYnLCBhdHRycz0geydjbGFzcyc6J3N0cmVhbS1uYXYgbW92aWVzJ30pDQogICAgZm9yIGNvbnQgaW4gY29udHM6DQogICAgICAgIGxpbmtzID0gY29udC5maW5kQWxsKCdkaXYnLCBhdHRycz0geydjbGFzcyc6J3N0cmVhbS1pbml0aWFsJ30pDQogICAgICAgIGZvciBsaW5rIGluIGxpbmtzOg0KICAgICAgICAgICAgaW5pcyA9IGxpbmsudGV4dA0KICAgICAgICBsaW5rczIgPSBjb250LmZpbmRBbGwoJ2EnKQ0KICAgICAgICBmb3IgbGluayBpbiBsaW5rczI6DQogICAgICAgICAgICBpZiBsaW5rLmhhc19rZXkoJ2hyZWYnKToNCiAgICAgICAgICAgICAgICBocmVmID0gdXJsK2xpbmtbJ2hyZWYnXQ0KICAgICAgICAgICAgaWYgbGluay5oYXNfa2V5KCd0aXRsZScpOg0KICAgICAgICAgICAgICAgIG5hbWUgPSBsaW5rWyd0aXRsZSddDQogICAgICAgICAgICBoZWFkcyA9IHsnVXNlci1BZ2VudCc6IHJhbmRvbV9hZ2VudCgpfQ0KICAgICAgICAgICAgaHRtbDMgPSByZXF1ZXN0cy5nZXQoaHJlZixoZWFkZXJzPWhlYWRzKS5jb250ZW50DQogICAgICAgICAgICBwcCA9IHBhY2tldHMoaHRtbDMpDQoNCiAgICAgICAgICAgIG1hdGNoID0gcmUuY29tcGlsZSgiJ2h0dHBzOiguKz8pJyIpLmZpbmRhbGwocHApDQogICAgICAgICAgICBmb3IgcGxpbmsgaW4gbWF0Y2g6DQogICAgICAgICAgICAgICAgcGxpbmsgPSBwbGluay5yZXBsYWNlKCdcXCcsJycpLnJlcGxhY2UoJ20zdTgvJywnbTN1OCcpDQogICAgICAgICAgICAgICAgc3JjID0gJ2h0dHBzOicrcGxpbmsrJ3xSZWZlcmVyPWh0dHA6Ly9hcmNvbmFpdHYubWUmVXNlci1BZ2VudD1Nb3ppbGxhJTJGNS4wJTIwKFdpbmRvd3MlMjBOVCUyMDYuMSUzQiUyMFdpbjY0JTNCJTIweDY0KSUyMEFwcGxlV2ViS2l0JTJGNTM3LjM2JTIwKEtIVE1MJTJDJTIwbGlrZSUyMEdlY2tvKSUyMENocm9tZSUyRjU5LjAuMzA3MS4xMTUlMjBTYWZhcmklMkY1MzcuMzYnDQogICAgICAgICAgICAgICAgUExBWShuYW1lLCBzcmMgLDkwNiwnJywnJywnJywnJykNCiAgICAgICAgICAgIA0KDQpkZWYgYWN0dmNhYmxlKCk6DQogICAgdXJsID0gJ2h0dHA6Ly9hcmNvbmFpdHYubWUvJw0KICAgIGluZGV4ID0gJ2luZGV4LnBocCNjYWJsZScNCiAgICBodG1sID0gQmVhdXRpZnVsU291cChyZXF1ZXN0cy5nZXQodXJsK2luZGV4KS5jb250ZW50KQ0KICAgIGNvbnRzID0gaHRtbC5maW5kQWxsKCdkaXYnLCBhdHRycz0geydjbGFzcyc6J3N0cmVhbS1uYXYgY2FibGUnfSkNCiAgICBmb3IgY29udCBpbiBjb250czoNCiAgICAgICAgbGlua3MgPSBjb250LmZpbmRBbGwoJ2RpdicsIGF0dHJzPSB7J2NsYXNzJzonc3RyZWFtLWluaXRpYWwnfSkNCiAgICAgICAgZm9yIGxpbmsgaW4gbGlua3M6DQogICAgICAgICAgICBpbmlzID0gbGluay50ZXh0DQogICAgICAgIGxpbmtzMiA9IGNvbnQuZmluZEFsbCgnYScpDQogICAgICAgIGZvciBsaW5rIGluIGxpbmtzMjoNCiAgICAgICAgICAgIGlmIGxpbmsuaGFzX2tleSgnaHJlZicpOg0KICAgICAgICAgICAgICAgIGhyZWYgPSB1cmwrbGlua1snaHJlZiddDQogICAgICAgICAgICBpZiBsaW5rLmhhc19rZXkoJ3RpdGxlJyk6DQogICAgICAgICAgICAgICAgbmFtZSA9IGxpbmtbJ3RpdGxlJ10NCiAgICAgICAgICAgIGhlYWRzID0geydVc2VyLUFnZW50JzogcmFuZG9tX2FnZW50KCl9DQogICAgICAgICAgICBodG1sMyA9IHJlcXVlc3RzLmdldChocmVmLGhlYWRlcnM9aGVhZHMpLmNvbnRlbnQNCiAgICAgICAgICAgIHBwID0gcGFja2V0cyhodG1sMykNCg0KICAgICAgICAgICAgbWF0Y2ggPSByZS5jb21waWxlKCInaHR0cHM6KC4rPyknIikuZmluZGFsbChwcCkNCiAgICAgICAgICAgIGZvciBwbGluayBpbiBtYXRjaDoNCiAgICAgICAgICAgICAgICBwbGluayA9IHBsaW5rLnJlcGxhY2UoJ1xcJywnJykucmVwbGFjZSgnbTN1OC8nLCdtM3U4JykNCiAgICAgICAgICAgICAgICBzcmMgPSAnaHR0cHM6JytwbGluaysnfFJlZmVyZXI9aHR0cDovL2FyY29uYWl0di5tZSZVc2VyLUFnZW50PU1vemlsbGElMkY1LjAlMjAoV2luZG93cyUyME5UJTIwNi4xJTNCJTIwV2luNjQlM0IlMjB4NjQpJTIwQXBwbGVXZWJLaXQlMkY1MzcuMzYlMjAoS0hUTUwlMkMlMjBsaWtlJTIwR2Vja28pJTIwQ2hyb21lJTJGNTkuMC4zMDcxLjExNSUyMFNhZmFyaSUyRjUzNy4zNicNCiAgICAgICAgICAgICAgICBQTEFZKG5hbWUsIHNyYyAsOTA2LCcnLCcnLCcnLCcnKQ0KDQpkZWYgYWN0dnJhbmQoKToNCiAgICBodG1sMiA9ICdodHRwOi8vYXJjb25haXR2Lm1lL3N0cmVhbS5waHA/aWQ9cmFuZG9tJw0KICAgIGhlYWRzID0geydVc2VyLUFnZW50JzogcmFuZG9tX2FnZW50KCl9DQogICAgaHRtbDMgPSByZXF1ZXN0cy5nZXQoaHRtbDIsaGVhZGVycz1oZWFkcykuY29udGVudA0KICAgIHBwID0gcGFja2V0cyhodG1sMykNCg0KICAgIG1hdGNoID0gcmUuY29tcGlsZSgiJ2h0dHBzOiguKz8pJyIpLmZpbmRhbGwocHApDQogICAgZm9yIHBsaW5rIGluIG1hdGNoOg0KICAgICAgICBwbGluayA9IHBsaW5rLnJlcGxhY2UoJ1xcJywnJykucmVwbGFjZSgnbTN1OC8nLCdtM3U4JykNCiAgICAgICAgc3JjID0gJ2h0dHBzOicrcGxpbmsrJ3xSZWZlcmVyPWh0dHA6Ly9hcmNvbmFpdHYubWUmVXNlci1BZ2VudD1Nb3ppbGxhJTJGNS4wJTIwKFdpbmRvd3MlMjBOVCUyMDYuMSUzQiUyMFdpbjY0JTNCJTIweDY0KSUyMEFwcGxlV2ViS2l0JTJGNTM3LjM2JTIwKEtIVE1MJTJDJTIwbGlrZSUyMEdlY2tvKSUyMENocm9tZSUyRjU5LjAuMzA3MS4xMTUlMjBTYWZhcmklMkY1MzcuMzYnDQogICAgICAgIFBMQVkoJ1JhbmRvbSBQaWNrJywgc3JjICw5MDYsJycsJycsJycsJycpDQoNCmRlZiBhcmNvbnR2KCk6DQogICAgdXJsID0gJ2h0dHA6Ly9hcmNvbmFpdHYubWUvJw0KICAgIGluZGV4ID0gJ2luZGV4LnBocCNzaG93cycNCg0KICAgIGh0bWwgPSBCZWF1dGlmdWxTb3VwKHJlcXVlc3RzLmdldCh1cmwraW5kZXgpLmNvbnRlbnQpDQogICAgY29udHMgPSBodG1sLmZpbmRBbGwoJ2RpdicsIGF0dHJzPSB7J2NsYXNzJzonYm94LWNvbnRlbnQnfSkNCiAgICBmb3IgY29udCBpbiBjb250czoNCiAgICAgICAgbGlua3MgPSBjb250LmZpbmRBbGwoJ2EnKQ0KICAgICAgICBmb3IgbGluayBpbiBsaW5rczoNCiAgICAgICAgICAgIGlmIGxpbmsuaGFzX2tleSgnaHJlZicpOg0KICAgICAgICAgICAgICAgIGhyZWYgPSB1cmwrbGlua1snaHJlZiddDQogICAgICAgICAgICBpZiBsaW5rLmhhc19rZXkoJ3RpdGxlJyk6DQogICAgICAgICAgICAgICAgbmFtZSA9IGxpbmtbJ3RpdGxlJ10NCiAgICAgICAgICAgIHBpY3MgPSBsaW5rLmZpbmRBbGwoJ2ltZycpDQogICAgICAgICAgICBmb3IgcGljIGluIHBpY3M6DQogICAgICAgICAgICAgICAgaW1nID0gdXJsK3BpY1snc3JjJ10NCiAgICAgICAgICAgICAgICBoZWFkcyA9IHsnVXNlci1BZ2VudCc6IHJhbmRvbV9hZ2VudCgpfQ0KICAgICAgICAgICAgICAgIGh0bWwzID0gcmVxdWVzdHMuZ2V0KGhyZWYsaGVhZGVycz1oZWFkcykuY29udGVudA0KICAgICAgICAgICAgICAgIHBwID0gcGFja2V0cyhodG1sMykNCg0KICAgICAgICAgICAgICAgIG1hdGNoID0gcmUuY29tcGlsZSgiJ2h0dHBzOiguKz8pJyIpLmZpbmRhbGwocHApDQogICAgICAgICAgICAgICAgZm9yIHBsaW5rIGluIG1hdGNoOg0KICAgICAgICAgICAgICAgICAgICBwbGluayA9IHBsaW5rLnJlcGxhY2UoJ1xcJywnJykucmVwbGFjZSgnbTN1OC8nLCdtM3U4JykNCiAgICAgICAgICAgICAgICAgICAgc3JjID0gJ2h0dHBzOicrcGxpbmsrJ3xSZWZlcmVyPWh0dHA6Ly9hcmNvbmFpdHYubWUmVXNlci1BZ2VudD1Nb3ppbGxhJTJGNS4wJTIwKFdpbmRvd3MlMjBOVCUyMDYuMSUzQiUyMFdpbjY0JTNCJTIweDY0KSUyMEFwcGxlV2ViS2l0JTJGNTM3LjM2JTIwKEtIVE1MJTJDJTIwbGlrZSUyMEdlY2tvKSUyMENocm9tZSUyRjU5LjAuMzA3MS4xMTUlMjBTYWZhcmklMkY1MzcuMzYnDQogICAgICAgICAgICAgICAgICAgIFBMQVkobmFtZSwgc3JjICw5MDYsaW1nLGltZywnJywnJykNCg0KZGVmIFBMQVkobmFtZSwgdXJsLCBtb2RlLCBpY29uaW1hZ2UsIGZhbmFydCwgZGVzY3JpcHRpb24sIGV4dHJhLCBzaG93Y29udGV4dD1UcnVlLCBhbGxpbmZvPXt9KToNCiAgICB1ID0gc3lzLmFyZ3ZbMF0gKyAiP3VybD0iICsgdXJsbGliLnF1b3RlX3BsdXModXJsKSArICImbW9kZT0iICsgc3RyKG1vZGUpICsgIiZuYW1lPSIgKyB1cmxsaWIucXVvdGVfcGx1cygNCiAgICAgICAgbmFtZSkgKyAiJmljb25pbWFnZT0iICsgdXJsbGliLnF1b3RlX3BsdXMoaWNvbmltYWdlKSArICImZmFuYXJ0PSIgKyB1cmxsaWIucXVvdGVfcGx1cygNCiAgICAgICAgZmFuYXJ0KSArICImZGVzY3JpcHRpb249IiArIHVybGxpYi5xdW90ZV9wbHVzKGRlc2NyaXB0aW9uKQ0KICAgIG9rID0gVHJ1ZQ0KICAgIGxpeiA9IHhibWNndWkuTGlzdEl0ZW0obmFtZSwgaWNvbkltYWdlPSIgIiwgdGh1bWJuYWlsSW1hZ2U9aWNvbmltYWdlKQ0KICAgIGxpei5zZXRJbmZvKHR5cGU9IlZpZGVvIiwgaW5mb0xhYmVscz17IlRpdGxlIjogbmFtZSwgIlBsb3QiOiBkZXNjcmlwdGlvbn0pDQogICAgbGl6LnNldFByb3BlcnR5KCJGYW5hcnRfSW1hZ2UiLCBmYW5hcnQpDQogICAgb2sgPSB4Ym1jcGx1Z2luLmFkZERpcmVjdG9yeUl0ZW0oaGFuZGxlPWludChzeXMuYXJndlsxXSksIHVybD11LCBsaXN0aXRlbT1saXosIGlzRm9sZGVyPUZhbHNlKQ0KICAgIHJldHVybiBvaw0KICAgIHhibWNwbHVnaW4uZW5kT2ZEaXJlY3RvcnkoaW50KHN5cy5hcmd2WzFdKSkNCg0KDQpkZWYgTWVudShuYW1lLCB1cmwsIG1vZGUsIGljb25pbWFnZSwgZmFuYXJ0LCBkZXNjcmlwdGlvbiwgZXh0cmEsIHNob3djb250ZXh0PVRydWUsIGFsbGluZm89e30pOg0KICAgIHUgPSBzeXMuYXJndlswXSArICI/dXJsPSIgKyB1cmxsaWIucXVvdGVfcGx1cyh1cmwpICsgIiZtb2RlPSIgKyBzdHIobW9kZSkgKyAiJm5hbWU9IiArIHVybGxpYi5xdW90ZV9wbHVzKA0KICAgICAgICBuYW1lKSArICImaWNvbmltYWdlPSIgKyB1cmxsaWIucXVvdGVfcGx1cyhpY29uaW1hZ2UpICsgIiZmYW5hcnQ9IiArIHVybGxpYi5xdW90ZV9wbHVzKA0KICAgICAgICBmYW5hcnQpICsgIiZkZXNjcmlwdGlvbj0iICsgdXJsbGliLnF1b3RlX3BsdXMoZGVzY3JpcHRpb24pICsgIiZleHRyYT0iICsgdXJsbGliLnF1b3RlX3BsdXMoZXh0cmEpDQogICAgb2sgPSBUcnVlDQogICAgbGl6ID0geGJtY2d1aS5MaXN0SXRlbShuYW1lLCBpY29uSW1hZ2U9IkRlZmF1bHRGb2xkZXIucG5nIiwgdGh1bWJuYWlsSW1hZ2U9aWNvbmltYWdlKQ0KICAgIGxpei5zZXRJbmZvKHR5cGU9IlZpZGVvIiwgaW5mb0xhYmVscz17IlRpdGxlIjogbmFtZSwgIlBsb3QiOiBkZXNjcmlwdGlvbn0pDQogICAgbGl6LnNldFByb3BlcnR5KCJGYW5hcnRfSW1hZ2UiLCBmYW5hcnQpDQogICAgb2sgPSB4Ym1jcGx1Z2luLmFkZERpcmVjdG9yeUl0ZW0oaGFuZGxlPWludChzeXMuYXJndlsxXSksIHVybD11LCBsaXN0aXRlbT1saXosIGlzRm9sZGVyPVRydWUpDQogICAgcmV0dXJuIG9rDQogICAgeGJtY3BsdWdpbi5lbmRPZkRpcmVjdG9yeShpbnQoc3lzLmFyZ3ZbMV0pKQ0KDQpkZWYgQmlnX1Jlc29sdmUobmFtZSx1cmwpOg0KICAgIGltcG9ydCByZXNvbHZldXJsDQogICAgdHJ5Og0KICAgICAgICByZXNvbHZlZF91cmwgPSByZXNvbHZldXJsLnJlc29sdmUodXJsKQ0KICAgICAgICB4Ym1jLlBsYXllcigpLnBsYXkocmVzb2x2ZWRfdXJsLCB4Ym1jZ3VpLkxpc3RJdGVtKG5hbWUpKQ0KICAgIGV4Y2VwdDoNCiAgICAgICAgeGJtYy5QbGF5ZXIoKS5wbGF5KHVybCwgeGJtY2d1aS5MaXN0SXRlbShuYW1lKSkNCiAgICB4Ym1jcGx1Z2luLmVuZE9mRGlyZWN0b3J5KGludChzeXMuYXJndlsxXSkpDQoNCg0KZGVmIGdldF9lcGcodXJsLCByZWdleCk6DQogICAgICAgIGRhdGEgPSBtYWtlUmVxdWVzdCh1cmwpDQogICAgICAgIHRyeToNCiAgICAgICAgICAgIGl0ZW0gPSByZS5maW5kYWxsKHJlZ2V4LCBkYXRhKVswXQ0KICAgICAgICAgICAgcmV0dXJuIGl0ZW0NCiAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgYWRkb25fbG9nKCdyZWdleCBmYWlsZWQnKQ0KICAgICAgICAgICAgYWRkb25fbG9nKHJlZ2V4KQ0KICAgICAgICAgICAgcmV0dXJuDQoNCg0KeGJtY3BsdWdpbi5zZXRDb250ZW50KGludChzeXMuYXJndlsxXSksICdtb3ZpZXMnKQ0KDQp0cnk6DQogICAgeGJtY3BsdWdpbi5hZGRTb3J0TWV0aG9kKGludChzeXMuYXJndlsxXSksIHhibWNwbHVnaW4uU09SVF9NRVRIT0RfVU5TT1JURUQpDQpleGNlcHQ6DQogICAgcGFzcw0KdHJ5Og0KICAgIHhibWNwbHVnaW4uYWRkU29ydE1ldGhvZChpbnQoc3lzLmFyZ3ZbMV0pLCB4Ym1jcGx1Z2luLlNPUlRfTUVUSE9EX0xBQkVMKQ0KZXhjZXB0Og0KICAgIHBhc3MNCnRyeToNCiAgICB4Ym1jcGx1Z2luLmFkZFNvcnRNZXRob2QoaW50KHN5cy5hcmd2WzFdKSwgeGJtY3BsdWdpbi5TT1JUX01FVEhPRF9EQVRFKQ0KZXhjZXB0Og0KICAgIHBhc3MNCnRyeToNCiAgICB4Ym1jcGx1Z2luLmFkZFNvcnRNZXRob2QoaW50KHN5cy5hcmd2WzFdKSwgeGJtY3BsdWdpbi5TT1JUX01FVEhPRF9HRU5SRSkNCmV4Y2VwdDoNCiAgICBwYXNzDQoNCnBhcmFtcz1nZXRfcGFyYW1zKCkNCg0KdXJsPU5vbmUNCm5hbWU9Tm9uZQ0KbW9kZT1Ob25lDQpwbGF5bGlzdD1Ob25lDQppY29uaW1hZ2U9Tm9uZQ0KZmFuYXJ0PUZBTkFSVA0KcGxheWxpc3Q9Tm9uZQ0KZmF2X21vZGU9Tm9uZQ0KcmVnZXhzPU5vbmUNCg0KdHJ5Og0KICAgIHVybD11cmxsaWIudW5xdW90ZV9wbHVzKHBhcmFtc1sidXJsIl0pLmRlY29kZSgndXRmLTgnKQ0KZXhjZXB0Og0KICAgIHBhc3MNCnRyeToNCiAgICBuYW1lPXVybGxpYi51bnF1b3RlX3BsdXMocGFyYW1zWyJuYW1lIl0pDQpleGNlcHQ6DQogICAgcGFzcw0KdHJ5Og0KICAgIGljb25pbWFnZT11cmxsaWIudW5xdW90ZV9wbHVzKHBhcmFtc1siaWNvbmltYWdlIl0pDQpleGNlcHQ6DQogICAgcGFzcw0KdHJ5Og0KICAgIGZhbmFydD11cmxsaWIudW5xdW90ZV9wbHVzKHBhcmFtc1siZmFuYXJ0Il0pDQpleGNlcHQ6DQogICAgcGFzcw0KdHJ5Og0KICAgIG1vZGU9aW50KHBhcmFtc1sibW9kZSJdKQ0KZXhjZXB0Og0KICAgIHBhc3MNCnRyeToNCiAgICBwbGF5bGlzdD1ldmFsKHVybGxpYi51bnF1b3RlX3BsdXMocGFyYW1zWyJwbGF5bGlzdCJdKS5yZXBsYWNlKCd8fCcsJywnKSkNCmV4Y2VwdDoNCiAgICBwYXNzDQp0cnk6DQogICAgZmF2X21vZGU9aW50KHBhcmFtc1siZmF2X21vZGUiXSkNCmV4Y2VwdDoNCiAgICBwYXNzDQp0cnk6DQogICAgcmVnZXhzPXBhcmFtc1sicmVnZXhzIl0NCmV4Y2VwdDoNCiAgICBwYXNzDQp0cnk6DQogICAgZXh0cmE9cGFyYW1zWyJleHRyYSJdDQpleGNlcHQ6DQogICAgcGFzcw0KYWRkb25fbG9nKCJNb2RlOiAiK3N0cihtb2RlKSkNCmlmIG5vdCB1cmwgaXMgTm9uZToNCiAgICBhZGRvbl9sb2coIlVSTDogIitzdHIodXJsLmVuY29kZSgndXRmLTgnKSkpDQphZGRvbl9sb2coIk5hbWU6ICIrc3RyKG5hbWUpKQ0KDQppZiBtb2RlPT1Ob25lOg0KICAgIGFkZG9uX2xvZygiSW5kZXgiKQ0KICAgIFNLaW5kZXgoKQkNCg0KZWxpZiBtb2RlPT0xOg0KICAgIGFkZG9uX2xvZygiZ2V0RGF0YSIpDQogICAgZ2V0RGF0YSh1cmwsZmFuYXJ0KQ0KICAgIHhibWNwbHVnaW4uZW5kT2ZEaXJlY3RvcnkoaW50KHN5cy5hcmd2WzFdKSkNCg0KZWxpZiBtb2RlPT0yOg0KICAgIGFkZG9uX2xvZygiZ2V0Q2hhbm5lbEl0ZW1zIikNCiAgICBnZXRDaGFubmVsSXRlbXMobmFtZSx1cmwsZmFuYXJ0KQ0KICAgIHhibWNwbHVnaW4uZW5kT2ZEaXJlY3RvcnkoaW50KHN5cy5hcmd2WzFdKSkNCg0KZWxpZiBtb2RlPT0zOg0KICAgIGFkZG9uX2xvZygiZ2V0U3ViQ2hhbm5lbEl0ZW1zIikNCiAgICBnZXRTdWJDaGFubmVsSXRlbXMobmFtZSx1cmwsZmFuYXJ0KQ0KICAgIHhibWNwbHVnaW4uZW5kT2ZEaXJlY3RvcnkoaW50KHN5cy5hcmd2WzFdKSkNCg0KZWxpZiBtb2RlPT00Og0KICAgIGFkZG9uX2xvZygiZ2V0RmF2b3JpdGVzIikNCiAgICBnZXRGYXZvcml0ZXMoKQ0KICAgIHhibWNwbHVnaW4uZW5kT2ZEaXJlY3RvcnkoaW50KHN5cy5hcmd2WzFdKSkNCg0KZWxpZiBtb2RlPT01Og0KICAgIGFkZG9uX2xvZygiYWRkRmF2b3JpdGUiKQ0KICAgIHRyeToNCiAgICAgICAgbmFtZSA9IG5hbWUuc3BsaXQoJ1xcICcpWzFdDQogICAgZXhjZXB0Og0KICAgICAgICBwYXNzDQogICAgdHJ5Og0KICAgICAgICBuYW1lID0gbmFtZS5zcGxpdCgnICAtICcpWzBdDQogICAgZXhjZXB0Og0KICAgICAgICBwYXNzDQogICAgYWRkRmF2b3JpdGUobmFtZSx1cmwsaWNvbmltYWdlLGZhbmFydCxmYXZfbW9kZSkNCg0KZWxpZiBtb2RlPT02Og0KICAgIGFkZG9uX2xvZygicm1GYXZvcml0ZSIpDQogICAgdHJ5Og0KICAgICAgICBuYW1lID0gbmFtZS5zcGxpdCgnXFwgJylbMV0NCiAgICBleGNlcHQ6DQogICAgICAgIHBhc3MNCiAgICB0cnk6DQogICAgICAgIG5hbWUgPSBuYW1lLnNwbGl0KCcgIC0gJylbMF0NCiAgICBleGNlcHQ6DQogICAgICAgIHBhc3MNCiAgICBybUZhdm9yaXRlKG5hbWUpDQoNCmVsaWYgbW9kZT09NzoNCiAgICBhZGRvbl9sb2coImFkZFNvdXJjZSIpDQogICAgYWRkU291cmNlKHVybCkNCg0KZWxpZiBtb2RlPT04Og0KICAgIGFkZG9uX2xvZygicm1Tb3VyY2UiKQ0KICAgIHJtU291cmNlKG5hbWUpDQoNCmVsaWYgbW9kZT09OToNCiAgICBhZGRvbl9sb2coImRvd25sb2FkX2ZpbGUiKQ0KICAgIGRvd25sb2FkX2ZpbGUobmFtZSwgdXJsKQ0KDQplbGlmIG1vZGU9PTEwOg0KICAgIGFkZG9uX2xvZygiZ2V0Q29tbXVuaXR5U291cmNlcyIpDQogICAgZ2V0Q29tbXVuaXR5U291cmNlcygpDQoNCmVsaWYgbW9kZT09MTE6DQogICAgYWRkb25fbG9nKCJhZGRTb3VyY2UiKQ0KICAgIGFkZFNvdXJjZSh1cmwpDQoNCmVsaWYgbW9kZT09MTI6DQogICAgYWRkb25fbG9nKCJzZXRSZXNvbHZlZFVybCIpDQogICAgaWYgbm90IHVybC5zdGFydHN3aXRoKCJwbHVnaW46Ly9wbHVnaW4iKSBvciBub3QgYW55KHggaW4gdXJsIGZvciB4IGluIGdfaWdub3JlU2V0UmVzb2x2ZWQpOiNub3QgdXJsLnN0YXJ0c3dpdGgoInBsdWdpbjovL3BsdWdpbi52aWRlby5mNG1UZXN0ZXIiKSA6DQogICAgICAgIGl0ZW0gPSB4Ym1jZ3VpLkxpc3RJdGVtKHBhdGg9dXJsKQ0KICAgICAgICB4Ym1jcGx1Z2luLnNldFJlc29sdmVkVXJsKGludChzeXMuYXJndlsxXSksIFRydWUsIGl0ZW0pDQogICAgZWxzZToNCiAgICAgICAgcHJpbnQgJ05vdCBzZXR0aW5nIHNldFJlc29sdmVkVXJsJw0KICAgICAgICB4Ym1jLmV4ZWN1dGVidWlsdGluKCdYQk1DLlJ1blBsdWdpbignK3VybCsnKScpDQoNCg0KZWxpZiBtb2RlPT0xMzoNCiAgICBhZGRvbl9sb2coInBsYXlfcGxheWxpc3QiKQ0KICAgIHBsYXlfcGxheWxpc3QobmFtZSwgcGxheWxpc3QpDQoNCmVsaWYgbW9kZT09MTQ6DQogICAgYWRkb25fbG9nKCJnZXRfeG1sX2RhdGFiYXNlIikNCiAgICBnZXRfeG1sX2RhdGFiYXNlKHVybCkNCiAgICB4Ym1jcGx1Z2luLmVuZE9mRGlyZWN0b3J5KGludChzeXMuYXJndlsxXSkpDQoNCmVsaWYgbW9kZT09MTU6DQogICAgYWRkb25fbG9nKCJicm93c2VfeG1sX2RhdGFiYXNlIikNCiAgICBnZXRfeG1sX2RhdGFiYXNlKHVybCwgVHJ1ZSkNCiAgICB4Ym1jcGx1Z2luLmVuZE9mRGlyZWN0b3J5KGludChzeXMuYXJndlsxXSkpDQoNCmVsaWYgbW9kZT09MTY6DQogICAgYWRkb25fbG9nKCJicm93c2VfY29tbXVuaXR5IikNCiAgICBnZXRDb21tdW5pdHlTb3VyY2VzKFRydWUpDQogICAgeGJtY3BsdWdpbi5lbmRPZkRpcmVjdG9yeShpbnQoc3lzLmFyZ3ZbMV0pKQ0KDQplbGlmIG1vZGU9PTE3Og0KICAgIGFkZG9uX2xvZygiZ2V0UmVnZXhQYXJzZWQiKQ0KICAgIHVybCxzZXRyZXNvbHZlZCA9IGdldFJlZ2V4UGFyc2VkKHJlZ2V4cywgdXJsKQ0KICAgIGlmIHVybDoNCiAgICAgICAgcGxheXNldHJlc29sdmVkKHVybCxuYW1lLGljb25pbWFnZSxzZXRyZXNvbHZlZCkNCiAgICBlbHNlOg0KICAgICAgICB4Ym1jLmV4ZWN1dGVidWlsdGluKCJYQk1DLk5vdGlmaWNhdGlvbihTa3luZXQgLEZhaWxlZCB0byBleHRyYWN0IHJlZ2V4LiAtICIrInRoaXMiKyIsNDAwMCwiK2ljb24rIikiKQ0KZWxpZiBtb2RlPT0xODoNCiAgICBhZGRvbl9sb2coInlvdXR1YmVkbCIpDQogICAgdHJ5Og0KICAgICAgICBpbXBvcnQgeW91dHViZWRsDQogICAgZXhjZXB0IEV4Y2VwdGlvbjoNCiAgICAgICAgeGJtYy5leGVjdXRlYnVpbHRpbigiWEJNQy5Ob3RpZmljYXRpb24oU2t5bmV0LFBsZWFzZSBbQ09MT1IgeWVsbG93XWluc3RhbGwgdGhlIFlvdXR1YmUgQWRkb25bL0NPTE9SXSBtb2R1bGUgLDEwMDAwLCIiKSIpDQogICAgc3RyZWFtX3VybD15b3V0dWJlZGwuc2luZ2xlX1lEKHVybCkNCiAgICBwbGF5c2V0cmVzb2x2ZWQoc3RyZWFtX3VybCxuYW1lLGljb25pbWFnZSkNCmVsaWYgbW9kZT09MTk6DQoJYWRkb25fbG9nKCJHZW5lc2lzY29tbW9ucmVzb2x2ZXJzIikNCglwbGF5c2V0cmVzb2x2ZWQgKHVybHNvbHZlcih1cmwpLG5hbWUsaWNvbmltYWdlLFRydWUpCQ0KDQplbGlmIG1vZGU9PTIxOg0KICAgIGFkZG9uX2xvZygiZG93bmxvYWQgY3VycmVudCBmaWxlIHVzaW5nIHlvdXR1YmUtZGwgc2VydmljZSIpDQogICAgeXRkbF9kb3dubG9hZCgnJyxuYW1lLCd2aWRlbycpDQplbGlmIG1vZGU9PTIzOg0KICAgIGFkZG9uX2xvZygiZ2V0IGluZm8gdGhlbiBkb3dubG9hZCIpDQogICAgeXRkbF9kb3dubG9hZCh1cmwsbmFtZSwndmlkZW8nKSANCmVsaWYgbW9kZT09MjQ6DQogICAgYWRkb25fbG9nKCJBdWRpbyBvbmx5IHlvdXR1YmUgZG93bmxvYWQiKQ0KICAgIHl0ZGxfZG93bmxvYWQodXJsLG5hbWUsJ2F1ZGlvJykNCmVsaWYgbW9kZT09MjU6DQogICAgYWRkb25fbG9nKCJZb3VUdWJlL0RNb3Rpb24iKQ0KICAgIHNlYXJjaCh1cmwpDQogICAgeGJtY3BsdWdpbi5lbmRPZkRpcmVjdG9yeShpbnQoc3lzLmFyZ3ZbMV0pKQ0KZWxpZiBtb2RlPT0yNjoNCiAgICBhZGRvbl9sb2coIllvdVR1YmUvRE1vdGlvbiBGcm9tIFNlYXJjaCBIaXN0b3J5IikNCiAgICBuYW1lID0gbmFtZS5zcGxpdCgnOicpDQogICAgc2VhcmNoKHVybCxzZWFyY2hfdGVybT1uYW1lWzFdKQ0KICAgIHhibWNwbHVnaW4uZW5kT2ZEaXJlY3RvcnkoaW50KHN5cy5hcmd2WzFdKSkNCmVsaWYgbW9kZT09Mjc6DQogICAgYWRkb25fbG9nKCJVc2luZyBJTURCIGlkIHRvIHBsYXkgaW4gUHVsc2FyIikNCiAgICBwdWxzYXJJTURCPXNlYXJjaCh1cmwpDQogICAgeGJtYy5QbGF5ZXIoKS5wbGF5KHB1bHNhcklNREIpIA0KZWxpZiBtb2RlPT0zMDoNCiAgICBHZXRTdWJsaW5rcyhuYW1lLHVybCxpY29uaW1hZ2UsZmFuYXJ0KQ0KCQ0KZWxpZiBtb2RlPT00MDoNCiAgICBTZWFyY2hDaGFubmVscygpDQogICAgU2V0Vmlld1RodW1ibmFpbCgpDQogICAgeGJtY3BsdWdpbi5lbmRPZkRpcmVjdG9yeShpbnQoc3lzLmFyZ3ZbMV0pKQ0KZWxpZiBtb2RlID09IDQxIDogDQogICAgU2VhcmNoX2lucHV0KHVybCkNCiAgICB4Ym1jcGx1Z2luLmVuZE9mRGlyZWN0b3J5KGludChzeXMuYXJndlsxXSkpDQoJDQplbGlmIG1vZGU9PTUzOg0KICAgIGFkZG9uX2xvZygiUmVxdWVzdGluZyBKU09OLVJQQyBJdGVtcyIpDQogICAgcGx1Z2lucXVlcnlieUpTT04odXJsKQ0KICAgIHhibWNwbHVnaW4uZW5kT2ZEaXJlY3RvcnkoaW50KHN5cy5hcmd2WzFdKSkNCg0KZWxpZiBtb2RlPT02OToNCiAgICBnZXRfcG9ybl9kYXRhKHVybCkNCiAgICB4Ym1jcGx1Z2luLmVuZE9mRGlyZWN0b3J5KGludChzeXMuYXJndlsxXSkpDQplbGlmIG1vZGU9PTkwNzoNCiAgICBhcmNvbnR2KCkNCiAgICB4Ym1jcGx1Z2luLmVuZE9mRGlyZWN0b3J5KGludChzeXMuYXJndlsxXSkpDQplbGlmIG1vZGU9PTkwNjoNCiAgICBCaWdfUmVzb2x2ZShuYW1lLHVybCkNCiAgICB4Ym1jcGx1Z2luLmVuZE9mRGlyZWN0b3J5KGludChzeXMuYXJndlsxXSkpDQplbGlmIG1vZGU9PTkwNToNCiAgICBhYzI0NygpDQogICAgeGJtY3BsdWdpbi5lbmRPZkRpcmVjdG9yeShpbnQoc3lzLmFyZ3ZbMV0pKQ0KZWxpZiBtb2RlPT05MDg6DQogICAgYWN0dnNob3dzKCkNCiAgICB4Ym1jcGx1Z2luLmVuZE9mRGlyZWN0b3J5KGludChzeXMuYXJndlsxXSkpDQplbGlmIG1vZGU9PTkwOToNCiAgICBhY3R2bW92aWVzKCkNCiAgICB4Ym1jcGx1Z2luLmVuZE9mRGlyZWN0b3J5KGludChzeXMuYXJndlsxXSkpDQplbGlmIG1vZGU9PTkxMDoNCiAgICBhY3R2Y2FibGUoKQ0KICAgIHhibWNwbHVnaW4uZW5kT2ZEaXJlY3RvcnkoaW50KHN5cy5hcmd2WzFdKSkNCmVsaWYgbW9kZT09OTExOg0KICAgIGFjdHZyYW5kKCkNCiAgICB4Ym1jcGx1Z2luLmVuZE9mRGlyZWN0b3J5KGludChzeXMuYXJndlsxXSkpDQplbGlmIG1vZGUgPT0gOTk5OTk5OiANCiAgICByZWdfbmFuKHVybCkNCiAgICB4Ym1jcGx1Z2luLmVuZE9mRGlyZWN0b3J5KGludChzeXMuYXJndlsxXSkpDQplbGlmIG1vZGUgPT0gOTk5OTk4OiANCiAgICBzZW5kX3RvX21vdmllX3NlYXJjaF9weXJhbWlkKG5hbWUsdXJsKQ0KICAgIHhibWNwbHVnaW4uZW5kT2ZEaXJlY3RvcnkoaW50KHN5cy5hcmd2WzFdKSkNCmVsaWYgbW9kZSA9PSA5OTk5OTc6IA0KICAgIE1vdl9zYygpDQogICAgeGJtY3BsdWdpbi5lbmRPZkRpcmVjdG9yeShpbnQoc3lzLmFyZ3ZbMV0pKQ0KZWxpZiBtb2RlID09IDk5OTk5NjogDQogICAgTXBvcCh1cmwpDQogICAgeGJtY3BsdWdpbi5lbmRPZkRpcmVjdG9yeShpbnQoc3lzLmFyZ3ZbMV0pKQ0KZWxpZiBtb2RlID09IDk5OTk5NTogDQogICAgTXBvcGdlbih1cmwpDQogICAgeGJtY3BsdWdpbi5lbmRPZkRpcmVjdG9yeShpbnQoc3lzLmFyZ3ZbMV0pKQ0KZWxpZiBtb2RlID09IDk5OTk5NDogDQogICAgTXBvcGdlbnJlcyh1cmwpDQogICAgeGJtY3BsdWdpbi5lbmRPZkRpcmVjdG9yeShpbnQoc3lzLmFyZ3ZbMV0pKQ0KZWxpZiBtb2RlID09IDMwMToNCiAgICBjYXRjaHVwdHYodXJsKQ0KICAgIHhibWNwbHVnaW4uZW5kT2ZEaXJlY3RvcnkoaW50KHN5cy5hcmd2WzFdKSkNCmVsaWYgbW9kZSA9PSAzMDI6DQogICAgY2F0Y2h1cHR2MSh1cmwpDQogICAgeGJtY3BsdWdpbi5lbmRPZkRpcmVjdG9yeShpbnQoc3lzLmFyZ3ZbMV0pKQ0KZWxpZiBtb2RlID09IDQwMDoNCiAgICB0dl9zaG93KCkNCiAgICB4Ym1jcGx1Z2luLmVuZE9mRGlyZWN0b3J5KGludChzeXMuYXJndlsxXSkpDQplbGlmIG1vZGUgPT0gNDAxOg0KICAgIG1wb3AoKQ0KICAgIHhibWNwbHVnaW4uZW5kT2ZEaXJlY3RvcnkoaW50KHN5cy5hcmd2WzFdKSkNCmVsaWYgbW9kZSA9PSA0MDI6DQogICAgc2hvd19tYWluKHVybCkNCiAgICB4Ym1jcGx1Z2luLmVuZE9mRGlyZWN0b3J5KGludChzeXMuYXJndlsxXSkpDQplbGlmIG1vZGUgPT0gNDAzOg0KICAgIGdldF9lcHModXJsLG5hbWUsaWNvbmltYWdlKQ0KICAgIHhibWNwbHVnaW4uZW5kT2ZEaXJlY3RvcnkoaW50KHN5cy5hcmd2WzFdKSkNCmVsaWYgbW9kZSA9PSA0MDQ6IA0KICAgIHNlbmRfdG9fc2VhcmNoMihuYW1lLGV4dHJhKQ0KICAgIHhibWNwbHVnaW4uZW5kT2ZEaXJlY3RvcnkoaW50KHN5cy5hcmd2WzFdKSkNCmVsaWYgbW9kZSA9PSA0MDU6IA0KICAgIG5hbnR2c2VhcmNoKCkNCiAgICB4Ym1jcGx1Z2luLmVuZE9mRGlyZWN0b3J5KGludChzeXMuYXJndlsxXSkpDQplbGlmIG1vZGUgPT0gNDA2OiANCiAgICBnZXRzZWFzZXBzKG5hbWUsdXJsKQ0KICAgIHhibWNwbHVnaW4uZW5kT2ZEaXJlY3RvcnkoaW50KHN5cy5hcmd2WzFdKSkNCmVsaWYgbW9kZSA9PSA0MDc6IA0KICAgIGVwcyhuYW1lLHVybCkNCiAgICB4Ym1jcGx1Z2luLmVuZE9mRGlyZWN0b3J5KGludChzeXMuYXJndlsxXSkpDQplbGlmIG1vZGUgPT0gNDEwOiANCiAgICByZWdfbmFuX3R2KHVybCkNCiAgICB4Ym1jcGx1Z2luLmVuZE9mRGlyZWN0b3J5KGludChzeXMuYXJndlsxXSkpDQplbGlmIG1vZGUgPT0gNTEwOiANCiAgICBwcm94eSgpDQogICAgeGJtY3BsdWdpbi5lbmRPZkRpcmVjdG9yeShpbnQoc3lzLmFyZ3ZbMV0pKQ0KDQo=')